# 1C AI MCP Code Generation System

Система генерации кода 1С с использованием искусственного интеллекта для платформы 1C AI MCP.

## 📋 Обзор

Данная система предоставляет инструменты для автоматической генерации кода 1С с помощью AI, включая:

- **Генерация кода по описанию** - Создание модулей 1С на основе текстового описания
- **Валидация кода** - Проверка синтаксиса, безопасности и соответствия стандартам
- **Система шаблонов** - Управление библиотекой готовых шаблонов
- **Интеграция с IDE** - Поддержка 1С Конфигуратора и VS Code
- **Мониторинг и аудит** - Отслеживание всех операций генерации

## 🏗️ Архитектура

### Основные компоненты

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   IDE Clients   │    │   MCP Layer     │    │   1С Core       │
│                 │    │                 │    │                 │
│ ┌─────────────┐ │    │ ┌─────────────┐ │    │ ┌─────────────┐ │
│ │VS Code Ext  │ │    │ │Claude Desk  │ │    │ │Generators   │ │
│ │BSL Language │ │◄──►│ │Integration  │ │◄──►│ │Tools        │ │
│ │IntelliSense │ │    │ │Code Prompts │ │    │ │             │ │
│ └─────────────┘ │    │ └─────────────┘ │    │ │ ┌─────────┐ │ │
│                 │    │                 │    │ │ │Template │ │ │
│ ┌─────────────┐ │    │ ┌─────────────┐ │    │ │ │Manager  │ │ │
│ │1С Config    │ │    │ │Cursor IDE   │ │    │ │ └─────────┘ │ │
│ │Plugin       │ │◄──►│ │Integration  │ │    │ │             │ │
│ │CLI Tools    │ │    │ │Live Generate│ │    │ │ ┌─────────┐ │ │
│ └─────────────┘ │    │ └─────────────┘ │    │ │ │Validator│ │ │
└─────────────────┘    └─────────────────┘    │ │ └─────────┘ │ │
                                               └─────────────┘ │
                                                         │
┌─────────────────┐                                   │
│AI/LLM Services  │    ┌─────────────────┐             │
│                 │    │Template Engine  │             │
│ ┌─────────────┐ │    │                 │             │
│ │OpenAI GPT   │ │    │ ┌─────────────┐ │             │
│ │Claude API   │ │◄──►│ │Prompt Lib   │ │             │
│ │Local LLMs   │ │    │ │Code Samples │ │             │
│ └─────────────┘ │    │ │Best Practices│ │             │
└─────────────────┘    │ └─────────────┘ │             │
                       └─────────────────┘             │
                                          ┌─────────────────┐
                                          │Security Layer   │
                                          │                 │
                                          │ ┌─────────────┐ │
                                          │ │Code Review  │ │
                                          │ │Access Control│ │
                                          │ │Audit Trail  │ │
                                          │ └─────────────┘ │
                                          └─────────────────┘
```

## 🚀 Установка и запуск

### Требования

- Python 3.8+
- 1С:Предприятие 8.3+
- MCP сервер (для интеграции)

### Быстрый старт

1. **Клонирование репозитория**
```bash
git clone <repository-url>
cd 1c_mcp_code_generation
```

2. **Установка зависимостей**
```bash
pip install -r requirements.txt
```

3. **Конфигурация**
```bash
# Копирование и редактирование конфигурации
cp config/generation_config.yaml config/local_config.yaml
# Отредактируйте config/local_config.yaml согласно вашим настройкам
```

4. **Запуск системы**
```bash
python -m src.py_server.code_generation
```

## 📚 Использование

### Генерация кода через Python API

```python
from src.py_server.code_generation import create_engine, CodeGenerationRequest

# Создание движка
config = {
    'llm': {'provider': 'mock'},
    'templates': {'enabled': True},
    'validation': {'enabled': True},
    'security': {'enabled': True}
}
engine = create_engine(config)

# Создание запроса
request = CodeGenerationRequest(
    prompt="Создать обработку для массового изменения цен товаров",
    object_type="processing",
    code_style="standard",
    include_comments=True,
    use_standards=True
)

# Генерация кода
result = await engine.generate_code(request)
print(f"Код сгенерирован: {result.success}")
print(f"Балл качества: {result.validation_score}")
```

### Интеграция с 1С

1. **Импорт обработки**
```bsl
// В 1С Конфигураторе
// Добавьте обработку mcp_ГенераторыКода из папки src/1c_ext/обработки/

// Использование
Обработка = Обработки.mcp_ГенераторыКода.Создать();
Результат = Обработка.СгенерироватьКодЧерезMCP(
    "Создать справочник для хранения контактов",
    "Справочник",
    "Стандартный"
);
```

2. **Вызов MCP инструментов**
```json
{
  "method": "tools/call",
  "params": {
    "name": "generate_1c_code",
    "arguments": {
      "описание": "Создать отчет по продажам с группировкой по регионам",
      "типОбъекта": "Отчет",
      "стильКода": "Стандартный"
    }
  }
}
```

## 🔧 Конфигурация

### Основные настройки

```yaml
# config/generation_config.yaml

# LLM провайдер
llm:
  provider: "mock"  # mock, openai, anthropic
  model: "gpt-4"
  temperature: 0.3

# Валидация
validation:
  enabled: true
  enabled_checks: ["syntax", "standards", "security", "performance"]
  strict_mode: false

# Безопасность
security:
  enabled: true
  max_code_size: 50000
  blocked_patterns: ["eval(", "exec(", "os.system"]
```

### Настройка LLM

Для production использования настройте реальные LLM провайдеры:

```yaml
llm:
  provider: "openai"
  model: "gpt-4"
  api_keys:
    openai: "sk-your-api-key-here"
```

## 📋 Функции

### ✅ Реализованные возможности

- [x] **Генерация кода по описанию**
- [x] **Синтаксическая валидация**
- [x] **Проверка стандартов разработки**
- [x] **Анализ безопасности**
- [x] **Система шаблонов**
- [x] **LLM интеграция (mock)**
- [x] **Аудит операций**
- [x] **Кэширование контекста**

### 🚧 В разработке

- [ ] **VS Code расширение**
- [ ] **1С Конфигуратор плагин (.NET)**
- [ ] **Интеграция с OpenAI/Anthropic**
- [ ] **ML адаптивные шаблоны**
- [ ] **Production развертывание**

## 🔍 API Документация

### MCP Инструменты

#### generate_1c_code
Генерация кода 1С по описанию.

**Параметры:**
- `описание` (string, обязательный): Описание требуемого кода
- `типОбъекта` (string): Тип объекта (Обработка, Отчет, Справочник, Документ, Регистр)
- `стильКода` (string): Стиль кода (Стандартный, Краткий, Подробный, Функциональный)
- `включитьКомментарии` (boolean): Включить комментарии в код
- `использоватьСтандарты` (boolean): Следовать стандартам разработки 1С

**Ответ:**
```json
{
  "успех": true,
  "сгенерированныйКод": {
    "модульМенеджера": "// Код модуля менеджера",
    "модульОбъекта": "// Код модуля объекта",
    "форма": "// Код формы",
    "макеты": ["ОсновнаяФорма", "Результат"]
  },
  "метаданные": {
    "времяГенерации": 2.34,
    "количествоСтрок": 247,
    "сложность": "Средняя"
  },
  "рекомендации": ["Рекомендуется протестировать код"],
  "ошибки": []
}
```

#### validate_1c_code
Валидация кода 1С.

**Параметры:**
- `код` (string, обязательный): Код для валидации
- `уровеньПроверки` (string): Уровень проверки (Базовый, Стандартный, Полный, Строгий)

## 🧪 Тестирование

### Запуск тестов

```bash
# Unit тесты
python -m pytest tests/unit/

# Интеграционные тесты
python -m pytest tests/integration/

# Все тесты
python -m pytest tests/
```

### Создание собственных тестов

```python
import pytest
from src.py_server.code_generation import create_engine

@pytest.mark.asyncio
async def test_basic_generation():
    config = {'llm': {'provider': 'mock'}}
    engine = create_engine(config)
    
    request = CodeGenerationRequest(
        prompt="Простая процедура",
        object_type="common_module"
    )
    
    result = await engine.generate_code(request)
    assert result.success == True
    assert len(result.generated_code) > 0
```

## 📊 Мониторинг

### Метрики системы

- **Статистика генерации**: количество успешных/неуспешных запросов
- **Производительность**: время ответа, использование ресурсов
- **Качество кода**: средний балл валидации, количество предупреждений
- **Безопасность**: обнаруженные угрозы, заблокированные запросы

### Логирование

Логи сохраняются в:
- `./logs/audit.log` - аудит операций
- `./logs/generation.log` - процесс генерации
- `./logs/security.log` - события безопасности

## 🔒 Безопасность

### Меры безопасности

- **Валидация входных данных** - проверка промптов на корректность
- **Анализ безопасности кода** - обнаружение уязвимостей
- **Блокировка опасных паттернов** - запрет выполнения произвольного кода
- **Аудит операций** - запись всех действий для анализа
- **Ограничение размера кода** - защита от DoS атак

### Соответствие стандартам

- **OWASP Top 10** - защита от основных веб-уязвимостей
- **NIST Framework** - соответствие требованиям кибербезопасности
- **ISO 27001** - управление рисками информационной безопасности

## 🤝 Вклад в проект

### Разработка

1. Форкните репозиторий
2. Создайте ветку для новой функции (`git checkout -b feature/amazing-feature`)
3. Закоммитьте изменения (`git commit -m 'Add amazing feature'`)
4. Отправьте в ветку (`git push origin feature/amazing-feature`)
5. Создайте Pull Request

### Стандарты кода

- Следуйте PEP 8 для Python кода
- Используйте типизацию Python
- Добавляйте docstrings к функциям
- Пишите тесты для новой функциональности

## 📄 Лицензия

Данный проект распространяется под лицензией [Указать лицензию].

## 📞 Поддержка

- **Документация**: [ссылка на документацию]
- **Issues**: [ссылка на GitHub Issues]
- **Email**: support@example.com

## 🗺️ Roadmap

### Q4 2025
- [ ] VS Code расширение
- [ ] Интеграция с реальными LLM
- [ ] Улучшенная система валидации

### Q1 2026
- [ ] 1С Конфигуратор плагин
- [ ] ML адаптивные шаблоны
- [ ] Production развертывание

### Q2 2026
- [ ] Расширенная аналитика
- [ ] Поддержка 1С 8.4
- [ ] Marketplace шаблонов

---

**Версия:** 1.0.0  
**Дата:** 30.10.2025