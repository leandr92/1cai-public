# PostgreSQL Client Authentication Configuration File
# TYPE  DATABASE        USER            ADDRESS                 METHOD

# "local" is for Unix domain socket connections only
local   all             postgres                                peer
local   all             all                                     peer

# IPv4 local connections:
host    all             postgres        127.0.0.1/32            scram-sha-256
host    all             all             127.0.0.1/32            scram-sha-256

# IPv6 local connections:
host    all             postgres        ::1/128                 scram-sha-256
host    all             all             ::1/128                 scram-sha-256

# Docker containers on the same network
host    all             all             172.21.0.0/16          scram-sha-256

# Application connections (AI Assistants)
host    ai_assistants   ai_assistants_prod_user    172.21.0.0/16    scram-sha-256
host    ai_assistants   ai_assistants_staging_user 172.21.0.0/16    scram-sha-256

# MLflow connections
host    ai_assistants_mlflow ai_assistants_prod_user 172.21.0.0/16   scram-sha-256

# Monitoring connections
host    all             grafana         172.21.0.0/16          scram-sha-256
host    all             prometheus      172.21.0.0/16          scram-sha-256

# Replication connections (if setting up streaming replication)
# host    replication     replicator      172.21.0.0/16          scram-sha-256

# Connections from outside Docker network (for development)
# host    all             all             192.168.1.0/24         scram-sha-256
# host    all             all             10.0.0.0/8             scram-sha-256

# Deny all other connections by default
host    all             all             0.0.0.0/0               reject