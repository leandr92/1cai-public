{
  "dashboard": {
    "title": "Celery Tasks Monitoring",
    "uid": "celery-monitoring",
    "tags": ["celery", "tasks", "ml", "workers"],
    "timezone": "browser",
    "schemaVersion": 39,
    "version": 2,
    "refresh": "10s",
    "editable": true,
    "time": {
      "from": "now-6h",
      "to": "now"
    },
    "timepicker": {
      "refresh_intervals": ["5s", "10s", "30s", "1m", "5m", "15m"],
      "time_options": ["1h", "6h", "12h", "24h", "7d", "30d"]
    },
    "templating": {
      "list": [
        {
          "name": "datasource",
          "type": "datasource",
          "label": "Prometheus",
          "query": "prometheus",
          "refresh": 1,
          "current": {
            "text": "Prometheus",
            "value": "Prometheus"
          }
        },
        {
          "name": "queue",
          "label": "Queue",
          "type": "query",
          "datasource": "$datasource",
          "definition": "label_values(celery_queue_length, queue)",
          "refresh": 2,
          "multi": true,
          "includeAll": true,
          "current": {
            "text": "All",
            "value": "$__all"
          }
        },
        {
          "name": "task",
          "label": "Task",
          "type": "query",
          "datasource": "$datasource",
          "definition": "label_values(celery_tasks_total, name)",
          "refresh": 2,
          "multi": true,
          "includeAll": true,
          "current": {
            "text": "All",
            "value": "$__all"
          }
        }
      ]
    },
    "annotations": {
      "list": [
        {
          "builtIn": 1,
          "datasource": "-- Grafana --",
          "enable": true,
          "hide": false,
          "iconColor": "rgba(0, 211, 255, 1)",
          "name": "Annotations & Alerts",
          "type": "dashboard"
        }
      ]
    },
    "panels": [
      {
        "id": 1,
        "title": "Active Workers",
        "type": "stat",
        "datasource": "$datasource",
        "targets": [
          {
            "expr": "sum(celery_workers)",
            "legendFormat": "workers",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "red",
                  "value": null
                },
                {
                  "color": "yellow",
                  "value": 1
                },
                {
                  "color": "green",
                  "value": 2
                }
              ]
            }
          }
        },
        "gridPos": {
          "x": 0,
          "y": 0,
          "w": 6,
          "h": 4
        }
      },
      {
        "id": 2,
        "title": "Tasks Received (5m)",
        "type": "stat",
        "datasource": "$datasource",
        "targets": [
          {
            "expr": "sum(increase(celery_tasks_total{state=\"received\"}[5m]))",
            "legendFormat": "received",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "blue",
                  "value": null
                },
                {
                  "color": "green",
                  "value": 10
                },
                {
                  "color": "orange",
                  "value": 100
                }
              ]
            }
          }
        },
        "gridPos": {
          "x": 6,
          "y": 0,
          "w": 6,
          "h": 4
        }
      },
      {
        "id": 3,
        "title": "Failed Tasks (5m)",
        "type": "stat",
        "datasource": "$datasource",
        "targets": [
          {
            "expr": "sum(increase(celery_tasks_total{state=\"failed\"}[5m]))",
            "legendFormat": "failed",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "yellow",
                  "value": 1
                },
                {
                  "color": "red",
                  "value": 5
                }
              ]
            }
          }
        },
        "gridPos": {
          "x": 12,
          "y": 0,
          "w": 6,
          "h": 4
        }
      },
      {
        "id": 4,
        "title": "Success Rate %",
        "type": "gauge",
        "datasource": "$datasource",
        "targets": [
          {
            "expr": "sum(rate(celery_tasks_total{state=\"succeeded\"}[5m])) / clamp_min(sum(rate(celery_tasks_total{state=\"received\"}[5m])), 0.001) * 100",
            "legendFormat": "success",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "min": 0,
            "max": 100,
            "unit": "percent",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "red",
                  "value": null
                },
                {
                  "color": "yellow",
                  "value": 90
                },
                {
                  "color": "green",
                  "value": 97
                }
              ]
            }
          }
        },
        "gridPos": {
          "x": 18,
          "y": 0,
          "w": 6,
          "h": 4
        }
      },
      {
        "id": 5,
        "title": "Task Throughput (per minute)",
        "type": "graph",
        "datasource": "$datasource",
        "targets": [
          {
            "expr": "sum by (name) (rate(celery_tasks_total{state=\"received\", name=~\"$task\"}[$__rate_interval]) * 60)",
            "legendFormat": "{{ name }}",
            "refId": "A"
          }
        ],
        "yaxes": [
          {
            "format": "short",
            "label": "tasks/min"
          },
          {
            "format": "short"
          }
        ],
        "gridPos": {
          "x": 0,
          "y": 4,
          "w": 12,
          "h": 8
        }
      },
      {
        "id": 6,
        "title": "Task Duration p95",
        "type": "graph",
        "datasource": "$datasource",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, sum by (le, name) (rate(celery_task_runtime_seconds_bucket{name=~\"$task\"}[$__rate_interval])))",
            "legendFormat": "{{ name }}",
            "refId": "A"
          }
        ],
        "yaxes": [
          {
            "format": "s",
            "label": "seconds"
          },
          {
            "format": "short"
          }
        ],
        "gridPos": {
          "x": 12,
          "y": 4,
          "w": 12,
          "h": 8
        }
      },
      {
        "id": 7,
        "title": "Queue Length",
        "type": "graph",
        "datasource": "$datasource",
        "targets": [
          {
            "expr": "sum by (queue) (celery_queue_length{queue=~\"$queue\"})",
            "legendFormat": "{{ queue }}",
            "refId": "A"
          }
        ],
        "yaxes": [
          {
            "format": "short",
            "label": "tasks"
          },
          {
            "format": "short"
          }
        ],
        "gridPos": {
          "x": 0,
          "y": 12,
          "w": 12,
          "h": 8
        }
      },
      {
        "id": 8,
        "title": "Worker Availability",
        "type": "graph",
        "datasource": "$datasource",
        "targets": [
          {
            "expr": "sum by (instance) (max_over_time(up{job=~\"celery.*\"}[5m]))",
            "legendFormat": "{{ instance }}",
            "refId": "A"
          }
        ],
        "yaxes": [
          {
            "format": "short",
            "label": "up"
          },
          {
            "format": "short"
          }
        ],
        "gridPos": {
          "x": 12,
          "y": 12,
          "w": 12,
          "h": 8
        }
      },
      {
        "id": 9,
        "title": "Failures (per minute)",
        "type": "graph",
        "datasource": "$datasource",
        "targets": [
          {
            "expr": "sum by (name) (rate(celery_tasks_total{state=\"failed\", name=~\"$task\"}[$__rate_interval]) * 60)",
            "legendFormat": "{{ name }}",
            "refId": "A"
          }
        ],
        "yaxes": [
          {
            "format": "short",
            "label": "failures/min"
          },
          {
            "format": "short"
          }
        ],
        "gridPos": {
          "x": 0,
          "y": 20,
          "w": 12,
          "h": 8
        }
      },
      {
        "id": 10,
        "title": "Retries (per minute)",
        "type": "graph",
        "datasource": "$datasource",
        "targets": [
          {
            "expr": "sum by (name) (rate(celery_tasks_total{state=\"retried\", name=~\"$task\"}[$__rate_interval]) * 60)",
            "legendFormat": "{{ name }}",
            "refId": "A"
          }
        ],
        "yaxes": [
          {
            "format": "short",
            "label": "retries/min"
          },
          {
            "format": "short"
          }
        ],
        "gridPos": {
          "x": 12,
          "y": 20,
          "w": 12,
          "h": 8
        }
      },
      {
        "id": 11,
        "title": "Top Failed Tasks (6h)",
        "type": "table",
        "datasource": "$datasource",
        "targets": [
          {
            "expr": "topk(10, increase(celery_tasks_total{state=\"failed\"}[6h]))",
            "format": "table",
            "instant": true,
            "legendFormat": "{{ name }}",
            "refId": "A"
          }
        ],
        "gridPos": {
          "x": 0,
          "y": 28,
          "w": 12,
          "h": 8
        }
      },
      {
        "id": 12,
        "title": "Queue Share (6h)",
        "type": "piechart",
        "datasource": "$datasource",
        "targets": [
          {
            "expr": "sum by (queue) (increase(celery_tasks_total{state=\"received\", queue=~\"$queue\"}[6h]))",
            "legendFormat": "{{ queue }}",
            "refId": "A"
          }
        ],
        "gridPos": {
          "x": 12,
          "y": 28,
          "w": 12,
          "h": 8
        }
      }
    ],
    "links": []
  }
}




