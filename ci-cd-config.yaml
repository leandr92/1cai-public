# CI/CD Configuration for 1C AI Ecosystem

# Global CI/CD Settings
CI_CD:
  environment: staging
  deployment_strategy: blue-green
  rollback_strategy: immediate
  
# Quality Gates Configuration
quality_gates:
  minimum_test_coverage: 80
  maximum_security_score: medium
  performance_thresholds:
    response_time: 2.0s
    error_rate: 0.01
    throughput: 100 req/s
  
# Security Scanning Settings
security:
  snyk:
    enabled: true
    severity_threshold: high
  codeql:
    enabled: true
    languages: [python, javascript]
  trivy:
    enabled: true
    severity: [HIGH, CRITICAL]
  anchore:
    enabled: true
    
# Testing Configuration
testing:
  unit_tests:
    enabled: true
    parallel: true
    coverage_threshold: 80
    
  integration_tests:
    enabled: true
    parallel: true
    timeout: 300s
    
  e2e_tests:
    enabled: true
    browsers: [chrome, firefox]
    timeout: 600s
    
  performance_tests:
    enabled: true
    load_duration: 300s
    concurrent_users: 50
    ramp_up_time: 60s

# Deployment Environments
environments:
  staging:
    namespace: staging
    replicas: 2
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 1000m
        memory: 2Gi
        
    health_checks:
      liveness_probe:
        initial_delay_seconds: 30
        period_seconds: 10
      readiness_probe:
        initial_delay_seconds: 5
        period_seconds: 5
        
    monitoring:
      enabled: true
      metrics_collection_interval: 30s
      alert_thresholds:
        error_rate: 0.05
        response_time: 3.0s
        
  production:
    namespace: production
    replicas: 3
    resources:
      requests:
        cpu: 200m
        memory: 512Mi
      limits:
        cpu: 2000m
        memory: 4Gi
        
    health_checks:
      liveness_probe:
        initial_delay_seconds: 30
        period_seconds: 10
      readiness_probe:
        initial_delay_seconds: 5
        period_seconds: 5
        
    monitoring:
      enabled: true
      metrics_collection_interval: 15s
      alert_thresholds:
        error_rate: 0.01
        response_time: 2.0s
        
    approval_required: true
    approval_roles: [devops-leads, tech-leads]

# Blue-Green Deployment Settings
blue_green:
  health_check_timeout: 300s
  traffic_switch_timeout: 60s
  rollback_timeout: 180s
  
  phases:
    pre_deploy:
      checks:
        - component_health
        - database_connectivity
        - dependency_readiness
        
    deploy:
      strategy: rolling_update
      max_surge: 1
      max_unavailable: 0
      timeout: 600s
      
    validate:
      checks:
        - smoke_tests
        - performance_baseline
        - security_scan
      timeout: 300s
      
    switch_traffic:
      strategy: immediate
      timeout: 60s
      
    post_deploy:
      monitoring_duration: 300s
      validation_interval: 30s

# Canary Deployment Settings
canary:
  stages:
    - name: initial
      traffic_percentage: 5
      duration: 300s
      success_criteria:
        error_rate: < 0.01
        response_time: < 2.0s
        
    - name: gradual
      traffic_percentage: 25
      duration: 600s
      success_criteria:
        error_rate: < 0.005
        response_time: < 1.5s
        
    - name: final
      traffic_percentage: 100
      duration: 300s
      success_criteria:
        error_rate: < 0.001
        response_time: < 1.0s

# AI Model Deployment
ai_models:
  registry_url: https://mlflow.1c-ai-ecosystem.example.com
  model_stages: [Staging, Production]
  
  deployment_strategies:
    risk_assessment:
      strategy: blue_green
      health_check_duration: 300s
      
    code_generation:
      strategy: canary
      traffic_increments: [10, 50, 100]
      
    optimization:
      strategy: blue_green
      parallel_deployment: true
      
    prediction:
      strategy: canary
      validation_metrics: [accuracy, precision, recall]

# Monitoring and Alerting
monitoring:
  prometheus:
    enabled: true
    retention: 30d
    scrape_interval: 15s
    
  grafana:
    enabled: true
    dashboards:
      - deployment_health
      - performance_metrics
      - error_analysis
      
  alertmanager:
    enabled: true
    routes:
      - match:
          severity: critical
        receiver: slack-critical
      - match:
          severity: warning
        receiver: slack-warning
        
    receivers:
      - name: slack-critical
        slack_configs:
          - channel: '#alerts-critical'
            send_resolved: true
            
      - name: slack-warning
        slack_configs:
          - channel: '#alerts-warning'
            send_resolved: true

# Notification Settings
notifications:
  slack:
    enabled: true
    webhook_url_secret: SLACK_WEBHOOK
    channels:
      ci_cd: '#ci-cd'
      production: '#production'
      alerts: '#alerts'
      
  email:
    enabled: true
    smtp_server: smtp.company.com
    recipients:
      devops: devops@company.com
      tech_leads: tech-leads@company.com
      
  teams:
    enabled: false
    webhook_url_secret: TEAMS_WEBHOOK

# Rollback Configuration
rollback:
  automatic:
    enabled: true
    trigger_conditions:
      - error_rate > 0.05
      - response_time > 5.0s
      - health_check_failures > 3
      
  manual:
    approval_required: true
    approval_timeout: 300s
    
  procedures:
    emergency:
      timeout: 60s
      strategy: immediate
      
    planned:
      timeout: 300s
      strategy: gradual
      
  verification:
    health_checks: true
    performance_validation: true
    functional_tests: false

# Compliance and Audit
compliance:
  audit_logging: true
  retention_period: 1y
  
  required_approvals:
    production_deploy: [devops_lead, tech_lead]
    rollback: [devops_lead]
    
  change_tracking:
    enabled: true
    git_integration: true

# Container Registry Settings
registry:
  primary: ghcr.io
  backup: docker.io
  authentication:
    type: token
    secret_name: registry-token
    
  image_policies:
    - name: production
      require_signature: true
      allowed_domains: [ghcr.io]
      
    - name: staging
      require_signature: false
      allowed_domains: [ghcr.io, docker.io]

# Database Migration Settings
database_migrations:
  enabled: true
  backup_before_migration: true
  rollback_on_failure: true
  
  post_deployment_validation:
    enabled: true
    timeout: 300s
    checks:
      - schema_validation
      - data_integrity
      - performance_impact

# Documentation Generation
documentation:
  auto_generate: true
  include_performance_metrics: true
  include_security_reports: true
  
  outputs:
    - deployment_report
    - performance_analysis
    - security_assessment

# Artifact Management
artifacts:
  retention: 90d
  
  types:
    - test_reports
    - coverage_reports
    - security_scans
    - performance_reports
    - deployment_logs
    
  storage:
    primary: github_artifacts
    backup: s3_backup