#!/usr/bin/env python3
"""
Анализ плагина Language 1C (BSL) для VS Code
Версия: 1.0.0
"""

import sys
from pathlib import Path

sys.path.insert(0, str(Path(__file__).parent))


def analyze_bsl_extension():
    """Анализ возможностей Language 1C (BSL) extension"""
    
    print("=" * 70)
    print("АНАЛИЗ: Language 1C (BSL) для VS Code")
    print("=" * 70)
    
    print("\n[1] Информация о расширении:")
    print("-" * 70)
    print("""
    Название: Language 1C (BSL)
    Платформа: Visual Studio Code
    Назначение: Поддержка языка BSL для 1С:Предприятие
    
    Основные возможности:
    - Подсветка синтаксиса BSL
    - Автодополнение кода
    - Валидация синтаксиса
    - Навигация по коду
    - Поиск определений функций/процедур
    - Рефакторинг кода
    - Форматирование кода
    """)
    
    print("\n[2] Анализ применимости для парсинга:")
    print("-" * 70)
    print("""
    ПЛЮСЫ:
    - Умеет парсить BSL код
    - Понимает синтаксис BSL
    - Находит определения функций/процедур
    - Работает с AST (Abstract Syntax Tree)
    - Может извлекать структуру кода
    
    МИНУСЫ:
    - Работает с отдельными файлами модулей
    - Может не понимать структуру XML конфигураций
    - Возможно, закрытый исходный код
    """)
    
    print("\n[3] Структура BSL кода:")
    print("-" * 70)
    print("""
    BSL код состоит из:
    1. Области (#Область ... #КонецОбласти)
    2. Функций (Функция ... КонецФункции)
    3. Процедур (Процедура ... КонецПроцедуры)
    4. Переменных (Перем, Переменная)
    5. Комментариев (//, /* ... */)
    
    Функции и процедуры имеют:
    - Имя
    - Параметры
    - Экспорт/не экспорт
    - Возвращаемое значение (для функций)
    """)
    
    print("\n[4] Возможности парсера BSL:")
    print("-" * 70)
    print("""
    Что можно извлечь:
    - Все функции и процедуры
    - Параметры функций
    - Области кода
    - Комментарии к функциям
    - Использование API 1С
    - Вызовы других функций
    - Структура кода (AST)
    """)
    
    print("\n[5] Рекомендации:")
    print("-" * 70)
    print("""
    ВАРИАНТ 1: Использовать логику парсера (если доступен)
    - Найти исходный код расширения
    - Адаптировать парсер BSL для Python
    - Использовать для извлечения функций/процедур
    
    ВАРИАНТ 2: Улучшить текущий парсер на основе понимания BSL
    - Использовать знания о синтаксисе BSL
    - Улучшить регулярные выражения
    - Добавить поддержку областей
    - Правильно извлекать параметры
    
    ВАРИАНТ 3: Комбинировать подходы
    - Использовать логику парсера для BSL кода
    - XML парсер для структуры конфигурации
    - Объединить результаты
    """)
    
    print("\n" + "=" * 70)
    print("АНАЛИЗ ЗАВЕРШЕН")
    print("=" * 70)


def analyze_bsl_syntax():
    """Анализ синтаксиса BSL для улучшения парсера"""
    
    print("\n" + "=" * 70)
    print("АНАЛИЗ СИНТАКСИСА BSL")
    print("=" * 70)
    
    print("\n[1] Основные конструкции BSL:")
    print("-" * 70)
    
    bsl_examples = [
        {
            "name": "Простая функция",
            "code": """
Функция ПолучитьЗначение(Параметр)
\tВозврат Параметр;
КонецФункции
            """.strip()
        },
        {
            "name": "Экспортная функция",
            "code": """
Функция ПолучитьЗначение(Параметр) Экспорт
\tВозврат Параметр;
КонецФункции
            """.strip()
        },
        {
            "name": "Функция с несколькими параметрами",
            "code": """
Функция ВыполнитьДействие(Параметр1, Параметр2 = Неопределено, Параметр3 = 0)
\t// Код функции
\tВозврат Истина;
КонецФункции
            """.strip()
        },
        {
            "name": "Процедура",
            "code": """
Процедура ВыполнитьОбработку(Параметр) Экспорт
\t// Код процедуры
КонецПроцедуры
            """.strip()
        },
        {
            "name": "Область кода",
            "code": """
#Область ПрограммныйИнтерфейс

Функция ПубличнаяФункция() Экспорт
\tВозврат Истина;
КонецФункции

#КонецОбласти
            """.strip()
        }
    ]
    
    for example in bsl_examples:
        print(f"\n{example['name']}:")
        print(example['code'])
    
    print("\n[2] Паттерны для парсинга:")
    print("-" * 70)
    
    patterns = [
        {
            "name": "Функция",
            "pattern": r'(?:^|\n)\s*(?:Экспорт\s+)?Функция\s+(\w+)\s*\(([^)]*)\)',
            "description": "Находит функции с параметрами"
        },
        {
            "name": "Процедура",
            "pattern": r'(?:^|\n)\s*(?:Экспорт\s+)?Процедура\s+(\w+)\s*\(([^)]*)\)',
            "description": "Находит процедуры с параметрами"
        },
        {
            "name": "Область",
            "pattern": r'#Область\s+(\w+)',
            "description": "Находит области кода"
        },
        {
            "name": "Комментарий к функции",
            "pattern": r'//\s*(?:Функция|Процедура)\s+(\w+)[^\n]*\n(?:[^\n]*\n)*?(?:Функция|Процедура)',
            "description": "Находит комментарии перед функциями"
        }
    ]
    
    for pattern in patterns:
        print(f"\n{pattern['name']}:")
        print(f"  Паттерн: {pattern['pattern']}")
        print(f"  Описание: {pattern['description']}")
    
    print("\n" + "=" * 70)


if __name__ == "__main__":
    analyze_bsl_extension()
    analyze_bsl_syntax()





