name: Deploy Architecture Pages

on:
  push:
    branches: [ main ]
    paths:
      - 'docs/architecture/interactive-architecture.html'
      - 'docs/architecture/**/*.md'
      - 'docs/architecture/**/*.puml'
      - 'docs/architecture/**/*.png'
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Pages
        uses: actions/configure-pages@v4
        with:
          enablement: true

      - name: Prepare architecture documentation
        run: |
          mkdir -p _site/architecture
          # –ö–æ–ø–∏—Ä—É–µ–º HTML —Ñ–∞–π–ª
          cp docs/architecture/interactive-architecture.html _site/architecture/
          # –ö–æ–ø–∏—Ä—É–µ–º markdown —Ñ–∞–π–ª—ã
          cp -r docs/architecture/*.md _site/architecture/ 2>/dev/null || true
          # –ö–æ–ø–∏—Ä—É–µ–º PNG –¥–∏–∞–≥—Ä–∞–º–º—ã
          find docs/architecture -name "*.png" -exec cp --parents {} _site/ \; 2>/dev/null || true
          # –°–æ–∑–¥–∞—ë–º index.html –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –Ω–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –∫–∞—Ä—Ç—É
          cat > _site/architecture/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="ru">
          <head>
              <meta charset="UTF-8">
              <meta http-equiv="refresh" content="0; url=interactive-architecture.html">
              <title>–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ 1C AI Stack</title>
              <script>
                  window.location.href = "interactive-architecture.html";
              </script>
          </head>
          <body>
              <p>–ï—Å–ª–∏ –≤—ã –Ω–µ –±—ã–ª–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, <a href="interactive-architecture.html">–Ω–∞–∂–º–∏—Ç–µ –∑–¥–µ—Å—å</a>.</p>
          </body>
          </html>
          EOF
          # –°–æ–∑–¥–∞—ë–º –≥–ª–∞–≤–Ω—ã–π index.html
          cat > _site/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="ru">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>1C AI Stack - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</title>
              <style>
                  body {
                      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                      max-width: 800px;
                      margin: 50px auto;
                      padding: 20px;
                      line-height: 1.6;
                  }
                  h1 { color: #667eea; }
                  .link-box {
                      background: #f5f5f5;
                      padding: 20px;
                      border-radius: 8px;
                      margin: 20px 0;
                  }
                  a {
                      color: #667eea;
                      text-decoration: none;
                      font-weight: 600;
                  }
                  a:hover { text-decoration: underline; }
              </style>
          </head>
          <body>
              <h1>üèóÔ∏è 1C AI Stack - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</h1>
              <div class="link-box">
                  <h2>üìä –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã</h2>
                  <p><a href="architecture/interactive-architecture.html">–û—Ç–∫—Ä—ã—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –∫–∞—Ä—Ç—É ‚Üí</a></p>
                  <p>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, –ø–æ–∏—Å–∫–∞ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.</p>
              </div>
              <div class="link-box">
                  <h2>üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</h2>
                  <ul>
                      <li><a href="https://github.com/DmitrL-dev/1cai-public/tree/main/docs/architecture">–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ GitHub</a></li>
                      <li><a href="architecture/01-high-level-design.md">High-Level Design</a></li>
                      <li><a href="architecture/HOW_TO_VIEW_INTERACTIVE_MAP.md">–ö–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –∫–∞—Ä—Ç—É</a></li>
                  </ul>
              </div>
          </body>
          </html>
          EOF

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: _site

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
        with:
          enablement: true

