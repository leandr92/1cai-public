&НаКлиенте
Процедура РасчетИтоговойСуммы(Сумма, СтавкаНалога, Скидка) Экспорт
	
	Если СтавкаНалога <= 0 Тогда
		ВызватьИсключение "Ставка налога должна быть больше нуля";
	КонецЕсли;
	
	Налог = РассчитатьНалог(Сумма, СтавкаНалога);
	Итог = Сумма + Налог - Скидка;
	
	Если Итог < 0 Тогда
		Итог = 0;
	КонецЕсли;
	
	ЗаписатьВЖурналРегистрации("Расчет суммы", Итог);
	
	Возврат Итог;
	
КонецПроцедуры

&НаКлиенте
Функция РассчитатьНалог(Сумма, СтавкаНалога) Экспорт
	
	Курс = ПолучитьКурсВалюты("RUB");
	
	Возврат (Сумма * СтавкаНалога / 100) * Курс;
	
КонецФункции

&НаКлиенте
Функция ПолучитьКурсВалюты(КодВалюты)
	
	// Имитация внешнего запроса
	Сообщить("Выполняется получение курса валюты " + КодВалюты);
	
	Если КодВалюты = "USD" Тогда
		Возврат 98;
	ИначеЕсли КодВалюты = "EUR" Тогда
		Возврат 104;
	Иначе
		Возврат 1;
	КонецЕсли;
	
КонецФункции

&НаКлиенте
Процедура ОчиститьИсторию() Экспорт
	
	Сообщить("Очистка журнала регистрации выполнена");
	
КонецПроцедуры

