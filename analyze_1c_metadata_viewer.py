#!/usr/bin/env python3
"""
Анализ возможностей расширения 1C Metadata Viewer для разбора конфигураций
Версия: 1.0.0
"""

import sys
from pathlib import Path

sys.path.insert(0, str(Path(__file__).parent))


def analyze_metadata_viewer():
    """Анализ возможностей 1C Metadata Viewer"""
    
    print("=" * 70)
    print("АНАЛИЗ: 1C Metadata Viewer для VS Code")
    print("=" * 70)
    
    print("\n[1] Информация о расширении:")
    print("-" * 70)
    print("""
    Название: 1C Metadata Viewer
    Платформа: Visual Studio Code
    Назначение: Просмотр структуры конфигураций 1С
    
    Основные возможности:
    ✅ Просмотр дерева конфигурации
    ✅ Отображение иерархии объектов (справочники, документы, регистры)
    ✅ Предпросмотр форм
    ✅ Интеграция с Language 1C (BSL)
    """)
    
    print("\n[2] Анализ применимости для парсинга:")
    print("-" * 70)
    print("""
    ПЛЮСЫ:
    ✅ Умеет читать структуру конфигураций 1С
    ✅ Понимает формат метаданных 1С
    ✅ Работает с VS Code (JavaScript/TypeScript)
    ✅ Может быть интегрирован
    
    МИНУСЫ:
    ❌ Предназначен для просмотра, а не для автоматизации
    ❌ Возможно, не предоставляет API для программного доступа
    ❌ Может быть закрытым расширением
    """)
    
    print("\n[3] Альтернатива: 1C Metacode MCP Server")
    print("-" * 70)
    print("""
    Более подходящий инструмент:
    
    Название: 1C Metacode MCP Server
    Возможности:
    ✅ Загружает метаданные конфигураций 1С
    ✅ Использует графовую БД Neo4j
    ✅ Предоставляет инструменты для графовых запросов
    ✅ Более подходит для автоматизации
    
    Оценка:
    ⭐⭐⭐⭐⭐ - Отлично подходит для автоматизации
    """)
    
    print("\n[4] Рекомендации:")
    print("-" * 70)
    print("""
    ВАРИАНТ 1: Использовать логику из исходников (если доступны)
    - Найти исходный код расширения на GitHub
    - Адаптировать парсер для Python
    - Использовать понимание структуры XML
    
    ВАРИАНТ 2: Интегрировать 1C Metacode MCP Server
    - Если сервер доступен и работает
    - Использовать его API для получения метаданных
    - Загружать данные в базу знаний
    
    ВАРИАНТ 3: Улучшить текущий парсер
    - Изучить структуру XML файлов из конфигураций
    - Улучшить парсинг на основе понимания структуры 1С
    - Использовать знания о формате из расширения
    """)
    
    print("\n[5] План действий:")
    print("-" * 70)
    print("""
    1. Найти исходный код расширения (GitHub/Marketplace)
    2. Проанализировать логику парсинга
    3. Адаптировать для Python или использовать напрямую
    4. Интегрировать в текущий парсер конфигураций
    
    ИЛИ
    
    1. Проверить доступность 1C Metacode MCP Server
    2. Изучить его API и возможности
    3. Интегрировать в систему
    4. Использовать для автоматического извлечения метаданных
    """)
    
    print("\n" + "=" * 70)
    print("АНАЛИЗ ЗАВЕРШЕН")
    print("=" * 70)


def check_existing_mcp():
    """Проверка существующих MCP серверов в проекте"""
    print("\n" + "=" * 70)
    print("ПРОВЕРКА СУЩЕСТВУЮЩИХ MCP СЕРВЕРОВ")
    print("=" * 70)
    
    mcp_dirs = ["1c_mcp", "1c_mcp_code_generation"]
    
    for mcp_dir in mcp_dirs:
        mcp_path = Path(mcp_dir)
        if mcp_path.exists():
            print(f"\n[OK] Найдена директория: {mcp_dir}")
            
            # Список файлов
            files = list(mcp_path.glob("*.py")) + list(mcp_path.glob("*.js")) + list(mcp_path.glob("*.ts"))
            
            if files:
                print(f"  Найдено файлов: {len(files)}")
                for file in files[:5]:
                    print(f"    - {file.name}")
                if len(files) > 5:
                    print(f"    ... и еще {len(files) - 5} файлов")
            else:
                print(f"  [INFO] Файлы не найдены или директория пуста")
        else:
            print(f"\n[SKIP] Директория не найдена: {mcp_dir}")


if __name__ == "__main__":
    analyze_metadata_viewer()
    check_existing_mcp()





