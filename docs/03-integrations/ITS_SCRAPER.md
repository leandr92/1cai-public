# –°–∫—Ä–µ–π–ø–µ—Ä 1–° –ò–¢–° (`integrations/its_scraper`)

## üìå –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π –≤—ã–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–µ–π —Å –ø–æ—Ä—Ç–∞–ª–∞ 1–°:–ò–¢–°, –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∏—Ö –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ä–º–∞—Ç–æ–≤ (JSON, Markdown, TXT) –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ ML/RAG-–ø–∞–π–ø–ª–∞–π–Ω–∞—Ö. –°–∫—Ä–µ–π–ø–µ—Ä –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ `httpx` + `BeautifulSoup`, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–µ—Ç—Ä–∞–∏ –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ CSS-—Å–µ–ª–µ–∫—Ç–æ—Ä—ã.

> –û—Å–Ω–æ–≤–∞ –≤–∑—è—Ç–∞ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ [hawkxtreme/scraping_its](https://github.com/hawkxtreme/scraping_its).  
> –û–≥—Ä–æ–º–Ω–æ–µ —Å–ø–∞—Å–∏–±–æ –∞–≤—Ç–æ—Ä—É –∑–∞ –æ—Ç–ª–∏—á–Ω—É—é –±–∞–∑—É: –º—ã –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–ª–∏ —Ä–µ—à–µ–Ω–∏—è –ø–æ–¥ –Ω–∞—à–∏ –ø–∞–π–ø–ª–∞–π–Ω—ã, –¥–æ–±–∞–≤–∏–≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.

## üöÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–≥—Ä—É–∑—á–∏–∫ (`httpx.AsyncClient`) + —Å–µ–º–∞—Ñ–æ—Ä –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞.
- ‚úÖ –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–µ—Ç—Ä–∞–∏ (`tenacity`), –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ —á–∏—Å–ª–æ –ø–æ–ø—ã—Ç–æ–∫, —Ç–∞–π–º–∞—É—Ç—ã –∏ –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏.
- ‚úÖ –ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (CSS-—Å–µ–ª–µ–∫—Ç–æ—Ä—ã, –ª–∏–º–∏—Ç—ã, user-agent rotation, concurrency, sleep, proxy) —á–µ—Ä–µ–∑ JSON.
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤: JSON/Markdown/TXT + RAG-–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (`output/<slug>/metadata.json`) —Å `content_hash`, `word_count`, `excerpt`, `previous_version`.
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ (`--update`), –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞—Ä—Ö–∏–≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ä–µ–≤–∏–∑–∏–π (`versions/<timestamp>/`).
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ –ø–∞–π–ø–ª–∞–π–Ω—ã (Typer CLI, Python API, Makefile-—Ç–∞—Ä–≥–µ—Ç).

## üß© –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `httpx`, `tenacity`, `beautifulsoup4`, `markdownify`, `typer`, `pydantic`.

## üõ† CLI

```bash
python -m integrations.its_scraper scrape \
  https://its.1c.ru/db/cabinetdoc \
  --format json --format markdown \
  --limit 25 \
  --output data/its-dump
```

–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–ª–∞–≥–∏:

| –ü–∞—Ä–∞–º–µ—Ç—Ä         | –û–ø–∏—Å–∞–Ω–∏–µ                                                                   |
|------------------|----------------------------------------------------------------------------|
| `start_url`      | URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–æ —Å–ø–∏—Å–∫–æ–º —Å—Ç–∞—Ç–µ–π                                            |
| `--format, -f`   | –§–æ—Ä–º–∞—Ç—ã (`json`, `markdown`, `txt`)                                        |
| `--limit`        | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–∞—Ç–µ–π                                          |
| `--config, -c`   | –ü—É—Ç—å –∫ JSON-–∫–æ–Ω—Ñ–∏–≥—É (`ScrapeConfig`)                                      |
| `--update`       | –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å—Ç–∞—Ç—å–∏ —Å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º `metadata.json` –≤ –ø–∞–ø–∫–µ —Å—Ç–∞—Ç—å–∏       |
| `--concurrency, -n` | –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º                                             |
| `--sleep, -s`    | –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É HTTP-–∑–∞–ø—Ä–æ—Å–∞–º–∏ (—Å–µ–∫—É–Ω–¥—ã)                                   |
| `--user-agent`   | –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å User-Agent (–º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑)                   |
| `--user-agent-file` | –§–∞–π–ª —Å–æ —Å–ø–∏—Å–∫–æ–º User-Agent –¥–ª—è —Ä–æ—Ç–∞—Ü–∏–∏                               |
| `--proxy`        | –ü—Ä–æ–∫—Å–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ò–¢–°                                                 |
| `--output, -o`   | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è                                                 |

–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥:

```bash
python -m integrations.its_scraper generate-config ./its.config.json
```

## üß± –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

`ScrapeConfig` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –ü—Ä–∏–º–µ—Ä (`its.config.json`):

```json
{
  "start_url": "https://its.1c.ru/db/cabinetdoc",
  "article_link_selector": "a.article-list__item",
  "article_title_selector": "h1",
  "article_content_selector": "[data-role='content']",
  "next_page_selector": "a.pagination__next",
  "formats": ["json", "markdown"],
  "concurrency": 5,
  "retry_attempts": 4,
  "request_timeout": 45,
  "output_directory": "output/its-scraper",
  "rag_metadata": true,
  "user_agents": [
    "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123 Safari/537.36",
    "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Firefox/125.0"
  ],
  "proxy": null,
  "delay_between_requests": 0.5
}
```

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–∞–π–ø–ª–∞–π–Ω–∞–º–∏

- **Makefile**: –¥–æ–±–∞–≤–ª–µ–Ω —Ç–∞—Ä–≥–µ—Ç `make scrape-its` (—Å–º. –∫–æ—Ä–Ω–µ–≤–æ–π `Makefile`, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `ITS_START_URL`, `ITS_OUTPUT`, `ITS_FORMATS`, `ITS_CONCURRENCY`, `ITS_SLEEP`, `ITS_PROXY`, `ITS_USER_AGENT_FILE`).
- **Orchestrator**: –º–æ–¥—É–ª—å –º–æ–∂–Ω–æ –¥–µ—Ä–≥–∞—Ç—å –∫–∞–∫ Python API:

```python
from integrations.its_scraper import ITSScraper, DEFAULT_CONFIG, persist_article

config = DEFAULT_CONFIG.copy(update={"start_url": "https://its.1c.ru/db/cabinetdoc"})
async with ITSScraper(config) as scraper:
    for article in await scraper.scrape():
        persist_article(article, config)
```

## ‚úÖ –¢–µ—Å—Ç—ã

–Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã `tests/unit/test_its_scraper.py` —ç–º—É–ª–∏—Ä—É—é—Ç –æ—Ç–≤–µ—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ `httpx.MockTransport`. –ó–∞–ø—É—Å–∫:

```bash
pytest tests/unit/test_its_scraper.py
```

CI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≥–æ–Ω—è–µ—Ç —Ç–µ—Å—Ç—ã –±–ª–∞–≥–æ–¥–∞—Ä—è –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º.

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ò–¢–° –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–∞—Å—Å–æ–≤—É—é –≤—ã–≥—Ä—É–∑–∫—É –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.
- –ù–µ –ø–æ–¥–Ω–∏–º–∞–π—Ç–µ `concurrency` —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–æ: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ 5 —â–∞–¥–∏—Ç —Å–µ—Ä–≤–µ—Ä.
- –î–ª—è –±–æ–ª—å—à–∏—Ö –≤—ã–≥—Ä—É–∑–æ–∫ –¥–æ–±–∞–≤—å—Ç–µ –ø–∞—É–∑—ã –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏ –∏ –≤–µ–¥–∏—Ç–µ —É—á—ë—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π —á–µ—Ä–µ–∑ `metadata.json`.
- –ï—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –º–µ–Ω—è–µ—Ç—Å—è, —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –≤ –∫–æ–Ω—Ñ–∏–≥–µ –∏ —Ä–∞—Å–ø–∏—à–∏—Ç–µ —ç—Ç–æ –≤ README.

## üìö –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä—è–º—É—é –≤—ã–≥—Ä—É–∑–∫—É –≤ MinIO/S3.
- –•—Ä–∞–Ω–∏—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –≤ Qdrant/Neo4j —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞.
- –†–∞—Å—à–∏—Ä–∏—Ç—å —Ç–µ—Å—Ç—ã –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º —Å—Ç–µ–Ω–¥–æ–º (–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π –≤–µ—Ç–∫–µ).

