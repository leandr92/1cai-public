# üìä BA-04 Analytics & KPI Toolkit Guide

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** –Ø–Ω–≤–∞—Ä—å 2025  
**–°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:** 
- `src/ai/agents/business_analyst_agent_extended.py`
- `src/ai/agents/analytics_kpi_with_graph.py`
- `src/api/ba_sessions.py`

---

## 1. –¶–µ–ª—å BA-04

–î–∞—Ç—å BA‚Äë–∞–≥–µ–Ω—Ç—É ¬´–≤—Ç–æ—Ä–æ–π –º–æ–∑–≥¬ª –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ KPI:

- —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ —É—Å–ø–µ—Ö–∞ –¥–ª—è —Ñ–∏—á/–∏–Ω–∏—Ü–∏–∞—Ç–∏–≤ (OKR, KPI, North Star);
- –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ SQL/BI‚Äë–∑–∞–ø—Ä–æ—Å—ã –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É (PostgreSQL / ClickHouse);
- —Å–≤—è–∑–∫–∞ —Å Observability (SLO, error budgets) –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –≤–ª–∏—è–Ω–∏—è —Ä–µ–ª–∏–∑–æ–≤.

---

## 2. –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

1. **KPI Designer**
   - –∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è —Ñ–∏—á–∏/–ø—Ä–æ—Ü–µ—Å—Å–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç:
     - –∫–ª—é—á–µ–≤—ã–µ –±–∏–∑–Ω–µ—Å‚Äë–º–µ—Ç—Ä–∏–∫–∏ (revenue, churn, NPS, lead time –∏ —Ç.–ø.),
     - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ (latency, error rate, deployment frequency);
   - –≤—ã–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É KPI —Å:
     - —Ñ–æ—Ä–º—É–ª–æ–π,
     - –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –¥–∞–Ω–Ω—ã—Ö,
     - –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å—é.

2. **SQL / BI Helper**
   - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —á–µ—Ä–Ω–æ–≤–∏–∫–∏ SQL‚Äë–∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–¥ PostgreSQL:
     - –æ—Ç—á—ë—Ç—ã –ø–æ –≤–æ—Ä–æ–Ω–∫–µ, retention, cohort analysis;
   - –¥–∞—ë—Ç –ø—Ä–∏–º–µ—Ä—ã –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π –¥–ª—è Power BI / DataLens:
     - —Ç–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞,
     - –∫–∞–∫–∏–µ –ø–æ–ª—è –≤—ã–≤–µ—Å—Ç–∏ –∏ –∫–∞–∫ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å.

3. **SLO & Business Impact Bridge**
   - –Ω–∞ –æ—Å–Ω–æ–≤–µ SLO/–∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ (–∏–∑ `docs/observability/SLO.md`, DORA) –ø–æ–º–æ–≥–∞–µ—Ç:
     - —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ —Å –±–∏–∑–Ω–µ—Å‚Äë—ç—Ñ—Ñ–µ–∫—Ç–æ–º,
     - —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å ¬´Story¬ª –¥–ª—è executive‚Äë–æ—Ç—á—ë—Ç–∞.

---

## 3. –ö–∞–∫ —ç—Ç–æ –±—É–¥–µ—Ç –≤—Å—Ç—Ä–∞–∏–≤–∞—Ç—å—Å—è

- BA‚Äë–∞–≥–µ–Ω—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç:
  - –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ–∏—á–∏ / –ø—Ä–æ—Ü–µ—Å—Å–∞ / –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞,
  - –∫–æ–Ω—Ç–µ–∫—Å—Ç (–ø—Ä–æ–¥—É–∫—Ç, —Å–µ–≥–º–µ–Ω—Ç, –∫–ª—é—á–µ–≤—ã–µ —Å—Ç–µ–π–∫—Ö–æ–ª–¥–µ—Ä—ã),
  - –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL/ClickHouse, BI‚Äë—Å–∏—Å—Ç–µ–º—ã).
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
  - —Å–ø–∏—Å–æ–∫ KPI/OKR,
  - –ø—Ä–∏–º–µ—Ä—ã SQL/–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π,
  - –∫—Ä–∞—Ç–∫–∏–π –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π summary (–¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –∏–ª–∏ –æ—Ç—á—ë—Ç–∞).

---

## 4. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### ‚úÖ KPI Generator —Å Unified Change Graph

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω `KPIGeneratorWithGraph` (`src/ai/agents/analytics_kpi_with_graph.py`), –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç—Ä–æ–∏—Ç KPI –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –∏–∑ –≥—Ä–∞—Ñ–∞:

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ KPI:**
- **Code Coverage** ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç –∫–æ–¥–∞, –ø–æ–∫—Ä—ã—Ç–æ–≥–æ —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è —Ñ–∏—á–∏
- **Test Coverage** ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π, –ø–æ–∫—Ä—ã—Ç—ã—Ö —Ç–µ—Å—Ç–∞–º–∏
- **Incident Rate** ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –Ω–∞ –º–æ–¥—É–ª—å
- **Change Failure Rate** ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π, –ø—Ä–∏–≤–æ–¥—è—â–∏—Ö –∫ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞–º (DORA metric)

**–ë–∏–∑–Ω–µ—Å KPI (—à–∞–±–ª–æ–Ω—ã):**
- **Revenue Impact** ‚Äî –≤–ª–∏—è–Ω–∏–µ —Ñ–∏—á–∏ –Ω–∞ –≤—ã—Ä—É—á–∫—É
- **User Adoption** ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö —Ñ–∏—á—É
- **Time to Value** ‚Äî –≤—Ä–µ–º—è –æ—Ç —Ä–µ–ª–∏–∑–∞ –¥–æ –ø–µ—Ä–≤–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### ‚úÖ SQL Query Builder

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è KPI:
- SQL –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö KPI –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥—Ä–∞—Ñ–∞ (code coverage, incident rate)
- SQL —à–∞–±–ª–æ–Ω—ã –¥–ª—è –±–∏–∑–Ω–µ—Å KPI (—Ç—Ä–µ–±—É—é—Ç –≤–Ω–µ—à–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö)

### ‚úÖ Visualizations

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è–º:
- –¢–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞ (gauge –¥–ª—è coverage, bar –¥–ª—è rate, line –¥–ª—è —Ç—Ä–µ–Ω–¥–æ–≤)
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (Grafana –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö, Power BI –¥–ª—è –±–∏–∑–Ω–µ—Å)

### ‚úÖ API Endpoints

–î–æ–±–∞–≤–ª–µ–Ω REST API endpoint –≤ `src/api/ba_sessions.py`:

- `POST /ba-sessions/analytics/kpi` ‚Äî —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å KPI –¥–ª—è –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã/—Ñ–∏—á–∏

## 5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### Python API

```python
from src.ai.agents.business_analyst_agent_extended import BusinessAnalystAgentExtended

agent = BusinessAnalystAgentExtended()

# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å KPI —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≥—Ä–∞—Ñ–∞
result = await agent.design_kpi_blueprint(
    initiative_name="–ù–æ–≤–∞—è —Ñ–∏—á–∞",
    feature_id="FEATURE001",
    use_graph=True,  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Unified Change Graph
)

# –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç:
# - kpis: —Å–ø–∏—Å–æ–∫ KPI —Å —Ñ–æ—Ä–º—É–ª–∞–º–∏, –∑–Ω–∞—á–µ–Ω–∏—è–º–∏, —Ü–µ–ª—è–º–∏
# - sql_queries: SQL-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ KPI
# - visualizations: —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è–º
```

### REST API

```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å KPI
curl -X POST http://localhost:8000/ba-sessions/analytics/kpi \
    -H "Content-Type: application/json" \
    -d '{
        "initiative_name": "–ù–æ–≤–∞—è —Ñ–∏—á–∞",
        "feature_id": "FEATURE001",
        "include_technical": true,
        "include_business": true,
        "use_graph": true
    }'
```

## 6. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Unified Change Graph

BA-04 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Unified Change Graph –¥–ª—è:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö KPI –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ (code, tests, incidents)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≥—Ä–∞—Ñ–∞
- –†–∞—Å—á—ë—Ç–∞ DORA –º–µ—Ç—Ä–∏–∫ (Change Failure Rate)

–ï—Å–ª–∏ –≥—Ä–∞—Ñ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∞–∑–æ–≤—ã–π `design_kpi_blueprint` —Å —à–∞–±–ª–æ–Ω–Ω—ã–º–∏ KPI.

## 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å unit-—Ç–µ—Å—Ç—ã
pytest tests/unit/test_analytics_kpi_with_graph.py -v
```

## 8. –°–º. —Ç–∞–∫–∂–µ

- [`BUSINESS_ANALYST_GUIDE.md`](BUSINESS_ANALYST_GUIDE.md) ‚Äî –æ–±—â–∏–π –≥–∞–π–¥ –ø–æ BA –∞–≥–µ–Ω—Ç—É
- [`BA_TRACEABILITY_COMPLIANCE_GUIDE.md`](BA_TRACEABILITY_COMPLIANCE_GUIDE.md) ‚Äî BA-05 Traceability & Compliance
- [`CODE_GRAPH_REFERENCE.md`](../architecture/CODE_GRAPH_REFERENCE.md) ‚Äî —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è Unified Change Graph


