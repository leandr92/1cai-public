@startuml
title 1C AI Stack - Core Data Flows

skinparam backgroundColor #FFFFFF
skinparam componentStyle rectangle

participant "EDT Plugin" as EDT
participant "Graph API" as API
participant "Workers" as Workers
participant "Neo4j" as Neo4j
participant "Qdrant" as Qdrant
participant "PostgreSQL" as Postgres
participant "Prometheus/Grafana" as Monitoring

== Analysis Request ==
EDT -> API : Request QuickAnalysis(ModX)
API -> Workers : enqueue_analysis(ModX)
Workers -> Postgres : Fetch metadata / config
Workers -> Neo4j : Update dependency graph
Workers -> Qdrant : Update embeddings\n(similarity search)
Workers -> API : analysis_result
API -> EDT : metrics + dependencies
Workers -> Monitoring : exporter metrics/logs

== Knowledge Search ==
participant "ITS Scraper" as Scraper
participant "S3/MinIO" as Minio

Scraper -> ITS : Fetch HTML pages
Scraper -> Minio : Store JSON/Markdown/TXT
Scraper -> Qdrant : Push embeddings
Scraper -> Postgres : Update metadata
Scraper -> Monitoring : its_scraper_* metrics

== AI Assisted Development ==
participant "AI Models" as Models

API -> Models : prompt/code request
Models --> API : generated code / explanation
API -> Postgres : Store conversation / audit
API -> Monitoring : inference metrics

@enduml

