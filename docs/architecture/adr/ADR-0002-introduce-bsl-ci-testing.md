# ADR-0002: Introduce YAxUnit-backed BSL testing in CI

- **Date:** 2025-11-10
- **Status:** Proposed
- **Supersedes:** None
- **Superseded by:** _n/a_

## Context

Python- и API-уровень проекта покрыт автотестами и аудитами, однако для BSL-кода (конфигурации, EDT-проектов, плагина) отсутствует единый механизм регрессионного тестирования. Это создаёт риски:

- изменения в `edt-plugin/test-fixtures` или новых конфигурациях могут ломать сценарии без обнаружения до ручного тестирования;
- Security Agent Framework и ML-пайплайны опираются на корректную работу BSL хелперов, но нет проверки обратной совместимости;
- CI/CD не даёт гарантии, что интеграция YAxUnit и Vanessa тестов проходит перед публикацией.

Экосистема `alkoleft` предоставляет открытый фреймворк YAxUnit, CLI-раннеры и MCP-инструменты, что позволяет формализовать тестовый процесс.

## Decision

1. В репозитории добавляется унифицированный тест-план `tests/bsl/testplan.json` с описанием BSL- и Vanessa-сценариев.
2. Создаётся утилита `scripts/tests/run_bsl_tests.py`, которая:
   - синхронизирует/проверяет наличие YAxUnit (или указанного runner'а),
   - выполняет тесты по манифесту и формирует артефакты (JUnit/XML),
   - отдаёт код возврата, пригодный для CI.
3. В `Makefile` появится цель `test-bsl`, вызывающая скрипт с дефолтным манифестом.
4. GitHub Actions `comprehensive-testing.yml` получит job `bsl-tests` на Windows runner:
   - установка требуемых зависимостей (OneScript/YAxUnit),
   - запуск `python scripts/tests/run_bsl_tests.py`,
   - публикация артефактов (reports/coverage) при наличии.
5. Документация (HLD, README, CASE_STUDIES) фиксирует наличие BSL-тестов и требования к окружению.

## Consequences

- ✅ BSL-слой покрыт автоматизированным регрессом; предотвращаются регрессии в EDT/конфигурациях.
- ✅ Единый интерфейс (`test-bsl`, GitHub Action) позволяет быстро прикручивать новые проекты или модули.
- ✅ Результаты попадают в CI-отчёты, метрики и Grafana (после интеграции).
- ⛏ Требуется Windows runner / OneScript CLI; full run возможен только в соответствующей среде.
- ⛏ Поддержка YAxUnit версий и артефактов (скачивание, кэш) ложится на нашу сборочную инфраструктуру.

## Notes

- После обкатки на YAxUnit рассмотреть добавление Vanessa Automation и MCP тест-раннера (`mcp-onec-test-runner`).
- Для on-prem команд актуально документировать локальный запуск (`make test-bsl` + инструкции по установке OneScript).

