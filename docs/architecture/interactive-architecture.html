<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã - 1C AI Stack</title>
    <script type="text/javascript" src="https://unpkg.com/vis-network@latest/standalone/umd/vis-network.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.3rem;
        }

        .header p {
            opacity: 0.9;
            font-size: 1rem;
        }

        .controls {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .controls label {
            font-weight: 600;
            color: #555;
            font-size: 0.9rem;
        }

        .controls input {
            padding: 0.5rem;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .controls input:focus {
            outline: none;
            border-color: #667eea;
        }

        .filter-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border: 2px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85rem;
        }

        .filter-btn:hover {
            background: #f0f0f0;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .diagram-wrapper {
            background: white;
            margin: 1rem auto;
            max-width: 100%;
            height: 80vh;
            min-height: 600px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            position: relative;
        }

        #network-container {
            width: 100%;
            height: 100%;
        }

        .info-panel {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem auto;
            max-width: 1400px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
        }

        .info-panel.visible {
            display: block;
        }

        .info-panel h2 {
            color: #667eea;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .info-panel h3 {
            color: #333;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }

        .info-panel p {
            color: #666;
            margin-bottom: 0.5rem;
        }

        .info-panel a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .info-panel a:hover {
            text-decoration: underline;
        }

        .close-btn {
            float: right;
            background: #667eea;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .close-btn:hover {
            background: #5568d3;
        }

        .legend {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
            padding: 1rem;
            background: #f9f9f9;
            border-radius: 4px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            border: 1px solid #ccc;
        }

        .instructions {
            background: #e8f4ff;
            padding: 1rem;
            margin: 1rem auto;
            max-width: 1400px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            font-size: 0.9rem;
        }

        .instructions strong {
            color: #667eea;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-buttons {
                justify-content: center;
            }

            .diagram-wrapper {
                height: 60vh;
                min-height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèóÔ∏è –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã</h1>
        <p>1C AI Stack - –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã –º—ã—à–∫–æ–π, –∫–ª–∏–∫–∞–π—Ç–µ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏</p>
    </div>

    <div class="instructions">
        <strong>üí° –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</strong> –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ —É–∑–ª—ã –º—ã—à–∫–æ–π ‚Ä¢ –ö–ª–∏–∫–∞–π—Ç–µ –Ω–∞ —É–∑–µ–ª –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–ª–µ—Å–∏–∫–æ –º—ã—à–∏ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è ‚Ä¢ –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –¥–ª—è —Å–±—Ä–æ—Å–∞ –º–∞—Å—à—Ç–∞–±–∞
        <br><strong>üìå –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> –ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª –∫–∞–∫ –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –≤ GitHub, –æ—Ç–∫—Ä–æ–π—Ç–µ –µ–≥–æ —á–µ—Ä–µ–∑ <a href="https://cdn.jsdelivr.net/gh/DmitrL-dev/1cai-public@main/docs/architecture/interactive-architecture.html" target="_blank" style="color: #667eea; font-weight: 600;">JSDelivr</a> –∏–ª–∏ <a href="https://raw.githack.com/DmitrL-dev/1cai-public/main/docs/architecture/interactive-architecture.html" target="_blank" style="color: #667eea; font-weight: 600;">RawGit</a>
    </div>

    <div class="controls">
        <label>–§–∏–ª—å—Ç—Ä:</label>
        <div class="filter-buttons">
            <button class="filter-btn active" data-filter="all">–í—Å–µ</button>
            <button class="filter-btn" data-filter="core">Core</button>
            <button class="filter-btn" data-filter="workers">Workers</button>
            <button class="filter-btn" data-filter="data">Data</button>
            <button class="filter-btn" data-filter="integration">Integrations</button>
            <button class="filter-btn" data-filter="ops">Operations</button>
        </div>
        <label style="margin-left: auto;">–ü–æ–∏—Å–∫:</label>
        <input type="text" id="search" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞..." style="flex: 1; max-width: 300px;">
        <button class="filter-btn" id="reset-view" style="background: #f0f0f0;">–°–±—Ä–æ—Å–∏—Ç—å –≤–∏–¥</button>
    </div>

    <div class="diagram-wrapper">
        <div id="network-container"></div>
    </div>

    <div class="info-panel" id="info-panel">
        <button class="close-btn" onclick="closeInfoPanel()">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
        <div id="info-content"></div>
    </div>

    <div class="info-panel">
        <h2>üìã –õ–µ–≥–µ–Ω–¥–∞</h2>
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #e8f4ff; border-color: #0066cc;"></div>
                <span>Core Services</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #fff4e6; border-color: #ff9900;"></div>
                <span>Integrations</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f0f7ff; border-color: #0066cc;"></div>
                <span>Data Stores</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f6fdf3; border-color: #00cc66;"></div>
                <span>Operations</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f9f9f9; border-color: #666666;"></div>
                <span>Users</span>
            </div>
        </div>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
        const components = {
            'Developer': { 
                category: 'user', 
                label: 'üë®‚Äçüíª 1C Developers', 
                description: '–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç IDE –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é',
                doc: null
            },
            'Operator': { 
                category: 'user', 
                label: 'üëî Business Stakeholders', 
                description: '–ë–∏–∑–Ω–µ—Å-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ—Ç—Ä–µ–±–ª—è—é—Ç –¥–∞—à–±–æ—Ä–¥—ã –∏ –æ—Ç—á–µ—Ç—ã',
                doc: null
            },
            'API': { 
                category: 'core', 
                label: 'üåê Graph API', 
                description: 'FastAPI —Å–µ—Ä–≤–∏—Å —Å GraphQL, REST –∏ MCP endpoints',
                doc: 'docs/06-features/MCP_SERVER_GUIDE.md'
            },
            'RestGateway': { 
                category: 'core', 
                label: '‚ö° Realtime Gateway', 
                description: 'Starlette WebSocket gateway –¥–ª—è realtime streaming –∏ MCP —Å–µ—Å—Å–∏–π',
                doc: 'docs/06-features/MCP_SERVER_GUIDE.md'
            },
            'Auth': { 
                category: 'core', 
                label: 'üîê Auth and RBAC', 
                description: 'OAuth2, JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è',
                doc: 'docs/security/policy_as_code.md'
            },
            'AdminPortal': { 
                category: 'core', 
                label: 'üõ°Ô∏è Admin Portal', 
                description: 'React + FastAPI –ø–æ—Ä—Ç–∞–ª –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é',
                doc: 'docs/security/policy_as_code.md'
            },
            'EventBus': { 
                category: 'core', 
                label: 'üöÄ Event Bus', 
                description: 'NATS Event-Driven Architecture –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏',
                doc: 'docs/06-features/REVOLUTIONARY_TECHNOLOGIES_GUIDE.md'
            },
            'EventWorkers': { 
                category: 'workers', 
                label: 'üîç Analysis Workers', 
                description: 'Event-Driven workers (NATS) –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ BSL –∫–æ–¥–∞ –∏ –∞—É–¥–∏—Ç–æ–≤',
                doc: 'docs/06-features/EDT_PARSER_GUIDE.md'
            },
            'YAxUnit': { 
                category: 'workers', 
                label: 'üß™ YAxUnit Test Runner', 
                description: '–§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è unit-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è BSL –∫–æ–¥–∞ (BIA-Technologies)',
                doc: 'docs/06-features/YAXUNIT_INTEGRATION_GUIDE.md'
            },
            'MLPipelines': { 
                category: 'workers', 
                label: 'ü§ñ ML Pipelines', 
                description: 'Prefect pipelines –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∏ –æ—Ü–µ–Ω–∫–∏ ML –º–æ–¥–µ–ª–µ–π',
                doc: 'docs/06-features/ML_DATASET_GENERATOR_GUIDE.md'
            },
            'ITSScraper': { 
                category: 'workers', 
                label: 'üì∞ ITS Scraper', 
                description: '–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–∞—Ä—Å–µ—Ä —Å—Ç–∞—Ç–µ–π ITS',
                doc: 'docs/03-integrations/ITS_SCRAPER.md'
            },
            'Orchestrator': { 
                category: 'workers', 
                label: 'üéØ Task Orchestrator', 
                description: 'Bash —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ç–Ω—ã—Ö –ø–∞–π–ø–ª–∞–π–Ω–æ–≤',
                doc: 'docs/scripts/README.md'
            },
            'Postgres': { 
                category: 'data', 
                label: 'üêò PostgreSQL', 
                description: '–†–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –ë–î –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –∏ –∞—É–¥–∏—Ç–∞',
                doc: 'docs/04-deployment/PRODUCTION_DEPLOYMENT.md'
            },
            'Neo4j': { 
                category: 'data', 
                label: 'üï∏Ô∏è Neo4j', 
                description: '–ì—Ä–∞—Ñ–æ–≤–∞—è –ë–î –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–¥–∞ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π',
                doc: 'docs/architecture/README.md'
            },
            'Qdrant': { 
                category: 'data', 
                label: 'üîç Qdrant', 
                description: '–í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞',
                doc: 'docs/architecture/README.md'
            },
            'Redis': { 
                category: 'data', 
                label: '‚ö° Redis', 
                description: 'In-memory –∫—ç—à –∏ –æ—á–µ—Ä–µ–¥–∏',
                doc: 'docs/04-deployment/PRODUCTION_DEPLOYMENT.md'
            },
            'Minio': { 
                category: 'data', 
                label: 'üì¶ MinIO', 
                description: 'Object storage –¥–ª—è –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ –∏ –º–æ–¥–µ–ª–µ–π',
                doc: 'docs/04-deployment/PRODUCTION_DEPLOYMENT.md'
            },
            'ClickHouse': { 
                category: 'data', 
                label: 'üìä ClickHouse', 
                description: 'Column store –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫',
                doc: 'docs/observability/SLO.md'
            },
            'EDTPlugin': { 
                category: 'integration', 
                label: 'üîå EDT Plugin', 
                description: 'Java –ø–ª–∞–≥–∏–Ω –¥–ª—è IDE',
                doc: 'docs/05-development/edt-plugin/README.md'
            },
            'n8nNode': { 
                category: 'integration', 
                label: 'üîÑ n8n Node', 
                description: 'TypeScript –Ω–æ–¥–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏',
                doc: 'docs/06-features/n8n-integration.md'
            },
            'TelegramBot': { 
                category: 'integration', 
                label: 'üí¨ Telegram Bot', 
                description: 'Python –±–æ—Ç –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤ –∏ chatops',
                doc: 'docs/01-getting-started/telegram-setup.md'
            },
            'Marketplace': { 
                category: 'integration', 
                label: 'üè™ Marketplace', 
                description: 'BSL –ø–∞–∫–µ—Ç—ã –∏ —à–∞–±–ª–æ–Ω—ã',
                doc: null
            },
            'Prometheus': { 
                category: 'ops', 
                label: 'üìà Prometheus', 
                description: '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫',
                doc: 'docs/observability/SLO.md'
            },
            'Grafana': { 
                category: 'ops', 
                label: 'üìä Grafana', 
                description: '–î–∞—à–±–æ—Ä–¥—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞',
                doc: 'docs/observability/SLO.md'
            },
            'Alertmanager': { 
                category: 'ops', 
                label: 'üö® Alertmanager', 
                description: '–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∞–ª–µ—Ä—Ç–æ–≤',
                doc: 'docs/observability/SLO.md'
            },
            'GitHubActions': { 
                category: 'ops', 
                label: '‚öôÔ∏è CI/CD', 
                description: 'GitHub Actions –¥–ª—è CI/CD',
                doc: 'docs/ops/devops_platform.md'
            },
            'Faro': { 
                category: 'ops', 
                label: 'üîç Tracing/Logs', 
                description: 'Tempo/Loki –¥–ª—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ –∏ –ª–æ–≥–æ–≤',
                doc: 'docs/observability/SLO.md'
            }
        };

        // –°–æ–∑–¥–∞–Ω–∏–µ —É–∑–ª–æ–≤ –∏ —Å–≤—è–∑–µ–π
        const nodes = [];
        const edges = [];

        // –¶–≤–µ—Ç–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        const categoryColors = {
            'user': { background: '#f9f9f9', border: '#666666' },
            'core': { background: '#e8f4ff', border: '#0066cc' },
            'workers': { background: '#fff4e6', border: '#ff9900' },
            'data': { background: '#f0f7ff', border: '#0066cc' },
            'integration': { background: '#fff4e6', border: '#ff9900' },
            'ops': { background: '#f6fdf3', border: '#00cc66' }
        };

        // –°–æ–∑–¥–∞–Ω–∏–µ —É–∑–ª–æ–≤
        Object.keys(components).forEach((id, index) => {
            const comp = components[id];
            const color = categoryColors[comp.category] || categoryColors.core;
            
            nodes.push({
                id: id,
                label: comp.label,
                color: {
                    background: color.background,
                    border: color.border,
                    highlight: { background: '#ffd700', border: '#ff9900' }
                },
                shape: comp.category === 'data' ? 'database' : 'box',
                font: { size: 14 },
                widthConstraint: { maximum: 200 },
                category: comp.category
            });
        });

        // –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–µ–π
        const connections = [
            { from: 'Developer', to: 'API', label: 'Graph queries, MCP' },
            { from: 'Developer', to: 'EDTPlugin', label: 'IDE commands' },
            { from: 'Operator', to: 'Grafana', label: 'Dashboards' },
            { from: 'RestGateway', to: 'Redis', label: 'PubSub' },
            { from: 'API', to: 'Auth', label: 'Auth' },
            { from: 'API', to: 'Postgres', label: 'Persist' },
            { from: 'API', to: 'Neo4j', label: 'Graph' },
            { from: 'API', to: 'Qdrant', label: 'Vector search' },
            { from: 'API', to: 'Redis', label: 'Cache' },
            { from: 'API', to: 'EventBus', label: 'Publish events' },
            { from: 'API', to: 'ITSScraper', label: 'Trigger' },
            { from: 'EventBus', to: 'EventWorkers', label: 'Route events' },
            { from: 'EventWorkers', to: 'Postgres', label: 'Update' },
            { from: 'EventWorkers', to: 'Neo4j', label: 'Update' },
            { from: 'EventWorkers', to: 'Qdrant', label: 'Sync' },
            { from: 'EventWorkers', to: 'Minio', label: 'Store' },
            { from: 'EventWorkers', to: 'EventBus', label: 'Publish results' },
            { from: 'YAxUnit', to: 'Postgres', label: 'Store results' },
            { from: 'YAxUnit', to: 'EventBus', label: 'Publish events' },
            { from: 'MLPipelines', to: 'Minio', label: 'Store' },
            { from: 'MLPipelines', to: 'Qdrant', label: 'Embeddings' },
            { from: 'MLPipelines', to: 'Postgres', label: 'Metadata' },
            { from: 'ITSScraper', to: 'Minio', label: 'Store' },
            { from: 'ITSScraper', to: 'Postgres', label: 'Metadata' },
            { from: 'ITSScraper', to: 'Prometheus', label: 'Metrics' },
            { from: 'EDTPlugin', to: 'API', label: 'Analysis' },
            { from: 'n8nNode', to: 'API', label: 'Workflow' },
            { from: 'TelegramBot', to: 'API', label: 'Chatops' },
            { from: 'Marketplace', to: 'API', label: 'Listing' },
            { from: 'Marketplace', to: 'Minio', label: 'Artifacts' },
            { from: 'Prometheus', to: 'API', label: 'Scrape' },
            { from: 'Prometheus', to: 'EventWorkers', label: 'Scrape' },
            { from: 'Prometheus', to: 'EventBus', label: 'Scrape' },
            { from: 'Prometheus', to: 'ITSScraper', label: 'Scrape' },
            { from: 'Prometheus', to: 'YAxUnit', label: 'Scrape' },
            { from: 'Prometheus', to: 'Alertmanager', label: 'Alerts' },
            { from: 'Alertmanager', to: 'TelegramBot', label: 'Escalate' },
            { from: 'GitHubActions', to: 'API', label: 'Deploy' },
            { from: 'GitHubActions', to: 'EventWorkers', label: 'Deploy' },
            { from: 'GitHubActions', to: 'YAxUnit', label: 'Run tests' },
            { from: 'Faro', to: 'API', label: 'Traces' },
            { from: 'Faro', to: 'EventWorkers', label: 'Traces' },
            { from: 'Faro', to: 'EventBus', label: 'Traces' }
        ];

        connections.forEach(conn => {
            edges.push({
                from: conn.from,
                to: conn.to,
                label: conn.label,
                arrows: 'to',
                smooth: { type: 'curvedCW', roundness: 0.2 },
                font: { size: 10, align: 'middle' }
            });
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏
        const container = document.getElementById('network-container');
        const data = { nodes: nodes, edges: edges };
        
        const options = {
            nodes: {
                shape: 'box',
                font: {
                    size: 14,
                    face: 'Arial'
                },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                width: 2,
                color: { color: '#848484', highlight: '#ff9900' },
                smooth: {
                    type: 'curvedCW',
                    roundness: 0.2
                },
                arrows: {
                    to: { enabled: true, scaleFactor: 0.8 }
                },
                font: {
                    size: 10,
                    align: 'middle'
                }
            },
            physics: {
                enabled: true,
                stabilization: { iterations: 200 },
                barnesHut: {
                    gravitationalConstant: -2000,
                    centralGravity: 0.1,
                    springLength: 200,
                    springConstant: 0.04,
                    damping: 0.09
                }
            },
            interaction: {
                dragNodes: true,
                dragView: true,
                zoomView: true,
                hover: true,
                tooltipDelay: 100,
                navigationButtons: true,
                keyboard: true
            },
            layout: {
                improvedLayout: true,
                hierarchical: {
                    enabled: false
                }
            }
        };

        const network = new vis.Network(container, data, options);

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –Ω–∞ —É–∑–µ–ª
        network.on('click', function(params) {
            if (params.nodes.length > 0) {
                const nodeId = params.nodes[0];
                const comp = components[nodeId];
                if (comp) {
                    showInfoPanel(comp, nodeId);
                }
            } else {
                closeInfoPanel();
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞ –¥–ª—è —Å–±—Ä–æ—Å–∞ –º–∞—Å—à—Ç–∞–±–∞
        network.on('doubleClick', function(params) {
            if (params.nodes.length === 0) {
                network.fit();
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ
        function showInfoPanel(comp, nodeId) {
            const panel = document.getElementById('info-panel');
            const content = document.getElementById('info-content');
            
            let html = `<h2>${comp.label}</h2>`;
            html += `<p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${comp.description}</p>`;
            html += `<p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> ${comp.category}</p>`;
            
            if (comp.doc) {
                html += `<p><strong>–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:</strong> <a href="${comp.doc}" target="_blank">${comp.doc}</a></p>`;
                html += `<p><a href="${comp.doc}" target="_blank" style="display: inline-block; margin-top: 1rem; padding: 0.5rem 1rem; background: #667eea; color: white; border-radius: 4px; text-decoration: none;">üìñ –û—Ç–∫—Ä—ã—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é</a></p>`;
            } else {
                html += `<p><em>–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞</em></p>`;
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
            const related = edges.filter(e => e.from === nodeId || e.to === nodeId)
                .map(e => e.from === nodeId ? e.to : e.from);
            const uniqueRelated = [...new Set(related)];
            
            if (uniqueRelated.length > 0) {
                html += `<h3>–°–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:</h3><ul>`;
                uniqueRelated.forEach(relId => {
                    const relComp = components[relId];
                    if (relComp) {
                        html += `<li><a href="#" onclick="highlightNode('${relId}'); return false;">${relComp.label}</a></li>`;
                    }
                });
                html += `</ul>`;
            }
            
            content.innerHTML = html;
            panel.classList.add('visible');
        }

        function closeInfoPanel() {
            document.getElementById('info-panel').classList.remove('visible');
        }

        function highlightNode(nodeId) {
            network.selectNodes([nodeId]);
            network.focus(nodeId, {
                scale: 1.5,
                animation: {
                    duration: 1000,
                    easingFunction: 'easeInOutQuad'
                }
            });
            const comp = components[nodeId];
            if (comp) {
                showInfoPanel(comp, nodeId);
            }
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
        let currentFilter = 'all';
        let currentSearch = '';

        function applyFilters() {
            const filteredNodes = nodes.filter(node => {
                const comp = components[node.id];
                const matchesFilter = currentFilter === 'all' || node.category === currentFilter;
                const matchesSearch = comp.label.toLowerCase().includes(currentSearch.toLowerCase()) ||
                                    comp.description.toLowerCase().includes(currentSearch.toLowerCase());
                return matchesFilter && matchesSearch;
            });

            const filteredNodeIds = new Set(filteredNodes.map(n => n.id));
            const filteredEdges = edges.filter(e => 
                filteredNodeIds.has(e.from) && filteredNodeIds.has(e.to)
            );

            network.setData({
                nodes: filteredNodes,
                edges: filteredEdges
            });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        document.querySelectorAll('.filter-btn').forEach(btn => {
            if (btn.id !== 'reset-view') {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => {
                        if (b.id !== 'reset-view') b.classList.remove('active');
                    });
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    applyFilters();
                });
            }
        });

        // –ü–æ–∏—Å–∫
        document.getElementById('search').addEventListener('input', (e) => {
            currentSearch = e.target.value;
            applyFilters();
        });

        // –°–±—Ä–æ—Å –≤–∏–¥–∞
        document.getElementById('reset-view').addEventListener('click', () => {
            network.fit({
                animation: {
                    duration: 1000,
                    easingFunction: 'easeInOutQuad'
                }
            });
            closeInfoPanel();
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        applyFilters();
    </script>
</body>
</html>
