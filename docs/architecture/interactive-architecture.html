<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã - 1C AI Stack</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .controls {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .controls label {
            font-weight: 600;
            color: #555;
        }

        .controls select, .controls input {
            padding: 0.5rem;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .controls select:focus, .controls input:focus {
            outline: none;
            border-color: #667eea;
        }

        .filter-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border: 2px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .filter-btn:hover {
            background: #f0f0f0;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .diagram-container {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .info-panel {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .info-panel h2 {
            color: #667eea;
            margin-bottom: 1rem;
        }

        .component-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .component-card {
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            padding: 1rem;
            transition: all 0.2s;
        }

        .component-card:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .component-card h3 {
            color: #667eea;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .component-card p {
            font-size: 0.85rem;
            color: #666;
        }

        .legend {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid #333;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-buttons {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèóÔ∏è –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã</h1>
        <p>1C AI Stack - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ —Å–≤—è–∑–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã</p>
    </div>

    <div class="controls">
        <label>–§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:</label>
        <div class="filter-buttons">
            <button class="filter-btn active" data-filter="all">–í—Å–µ</button>
            <button class="filter-btn" data-filter="core">Core Services</button>
            <button class="filter-btn" data-filter="workers">Workers</button>
            <button class="filter-btn" data-filter="data">Data Stores</button>
            <button class="filter-btn" data-filter="integration">Integrations</button>
            <button class="filter-btn" data-filter="ops">Operations</button>
        </div>
        <label style="margin-left: auto;">–ü–æ–∏—Å–∫:</label>
        <input type="text" id="search" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞..." style="flex: 1; max-width: 300px;">
    </div>

    <div class="container">
        <div class="diagram-container">
            <div class="mermaid" id="architecture-diagram">
graph TB
    subgraph Users["üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"]
        Developer["üë®‚Äçüíª 1C Developers<br/>Use IDE and automation"]
        Operator["üëî Business Stakeholders<br/>Consume dashboards, reports"]
    end

    subgraph Core["üîµ Core Services"]
        API["üåê Graph API<br/>FastAPI<br/>GraphQL, REST, MCP endpoints"]
        RestGateway["‚ö° Realtime Gateway<br/>Starlette, WebSocket<br/>Realtime streaming, MCP sessions"]
        Auth["üîê Auth and RBAC<br/>OAuth2, JWT<br/>Identity, service tokens"]
        AdminPortal["üõ°Ô∏è Admin Portal<br/>React, FastAPI<br/>Security agent UI, audit management"]
    end

    subgraph Workers["‚öôÔ∏è Worker Tier"]
        Celery["üîç Analysis Workers<br/>Celery<br/>BSL code analysis, audits"]
        MLPipelines["ü§ñ ML Pipelines<br/>Prefect, PyTorch<br/>Training, evaluation, embeddings"]
        ITSScraper["üì∞ ITS Scraper<br/>Async Python<br/>Stateful ingestion pipeline"]
        Orchestrator["üéØ Task Orchestrator<br/>Bash, scripts<br/>Composite pipelines and CLI"]
    end

    subgraph DataStores["üíæ Data Stores"]
        Postgres[("üêò PostgreSQL<br/>Aurora / RDS<br/>Relational data, audit, configs")]
        Neo4j[("üï∏Ô∏è Neo4j<br/>Graph DB<br/>Code structure and dependencies")]
        Qdrant[("üîç Qdrant<br/>Vector DB<br/>Embeddings for semantic search")]
        Redis[("‚ö° Redis<br/>In-memory<br/>Cache, rate limit, queues")]
        Minio[("üì¶ MinIO<br/>Object Storage<br/>Datasets, models, documentation dumps")]
        ClickHouse[("üìä ClickHouse<br/>Column Store<br/>Observability long term metrics")]
    end

    subgraph Integrations["üîó Integration Channels"]
        EDTPlugin["üîå EDT Plugin<br/>Java<br/>IDE assistant and dashboards"]
        n8nNode["üîÑ n8n Node<br/>TypeScript<br/>Workflow automation"]
        TelegramBot["üí¨ Telegram Bot<br/>Python<br/>Alerting and chatops"]
        Marketplace["üè™ Marketplace Extensions<br/>BSL<br/>Delivered packages and templates"]
    end

    subgraph Ops["üìä Operations"]
        Prometheus["üìà Prometheus<br/>Monitoring<br/>Metrics scrape and alert rules"]
        Grafana["üìä Grafana<br/>Dashboards<br/>Observability and business analytics"]
        Alertmanager["üö® Alertmanager<br/>Alert routing"]
        GitHubActions["‚öôÔ∏è CI/CD<br/>GitHub Actions<br/>Build, test, deploy, docs"]
        Faro["üîç Tracing/Logs<br/>Tempo / Loki<br/>Distributed traces and logs"]
    end

    Developer -->|Graph queries, MCP requests| API
    Developer -->|IDE commands| EDTPlugin
    Developer -->|Trigger automations| n8nNode
    Operator -->|Dashboards, KPIs| Grafana

    RestGateway -->|PubSub channels| Redis
    API -->|Authenticate requests| Auth
    API -->|Persist configs, sessions| Postgres
    API -->|Read/write dependency graph| Neo4j
    API -->|Vector search| Qdrant
    API -->|Fast cache, rate limit| Redis
    API -->|Dispatch jobs| Celery
    API -->|Trigger ingestion| ITSScraper

    Celery -->|Read/write jobs, audit| Postgres
    Celery -->|Update graph| Neo4j
    Celery -->|Sync embeddings| Qdrant
    Celery -->|Store outputs| Minio
    MLPipelines -->|Datasets, models| Minio
    MLPipelines -->|Embeddings| Qdrant
    MLPipelines -->|Metadata| Postgres
    ITSScraper -->|Raw and processed dumps| Minio
    ITSScraper -->|Article metadata| Postgres
    ITSScraper -->|Exporter metrics| Prometheus

    EDTPlugin -->|Quick analysis, call graph| API
    n8nNode -->|Workflow actions| API
    TelegramBot -->|Chatops, notifications| API
    Marketplace -->|Package listing| API
    Marketplace -->|Artifacts hosting| Minio

    Prometheus -->|Scrape metrics| API
    Prometheus -->|Scrape metrics| Celery
    Prometheus -->|Scrape metrics| ITSScraper
    Prometheus -->|Push alerts| Alertmanager
    Alertmanager -->|Escalations| TelegramBot
    GitHubActions -->|Deploy, test| API
    GitHubActions -->|Deploy, test| Celery
    GitHubActions -->|Mock smoke tests| ITSScraper
    Faro -->|Traces/logs| API
    Faro -->|Traces/logs| Celery
    Faro -->|Logs| GitHubActions

    classDef coreStyle fill:#e8f4ff,stroke:#0066cc,stroke-width:2px
    classDef integrationStyle fill:#fff4e6,stroke:#ff9900,stroke-width:2px
    classDef storeStyle fill:#f0f7ff,stroke:#0066cc,stroke-width:2px
    classDef opsStyle fill:#f6fdf3,stroke:#00cc66,stroke-width:2px
    classDef userStyle fill:#f9f9f9,stroke:#666666,stroke-width:2px

    class API,RestGateway,Auth,AdminPortal coreStyle
    class EDTPlugin,n8nNode,TelegramBot,Marketplace integrationStyle
    class Postgres,Neo4j,Qdrant,Redis,Minio,ClickHouse storeStyle
    class Prometheus,Grafana,Alertmanager,GitHubActions,Faro opsStyle
    class Developer,Operator userStyle
            </div>
        </div>

        <div class="info-panel">
            <h2>üìã –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã</h2>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #e8f4ff; border-color: #0066cc;"></div>
                    <span>Core Services</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #fff4e6; border-color: #ff9900;"></div>
                    <span>Integrations</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f0f7ff; border-color: #0066cc;"></div>
                    <span>Data Stores</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f6fdf3; border-color: #00cc66;"></div>
                    <span>Operations</span>
                </div>
            </div>
            <div class="component-list" id="component-list">
                <!-- Components will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        const components = [
            { name: 'Graph API', category: 'core', description: 'FastAPI —Å–µ—Ä–≤–∏—Å —Å GraphQL, REST –∏ MCP endpoints' },
            { name: 'Realtime Gateway', category: 'core', description: 'Starlette WebSocket gateway –¥–ª—è realtime streaming' },
            { name: 'Auth and RBAC', category: 'core', description: 'OAuth2, JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è' },
            { name: 'Admin Portal', category: 'core', description: 'React + FastAPI –ø–æ—Ä—Ç–∞–ª –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é' },
            { name: 'Analysis Workers', category: 'workers', description: 'Celery workers –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ BSL –∫–æ–¥–∞' },
            { name: 'ML Pipelines', category: 'workers', description: 'Prefect pipelines –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∏ –æ—Ü–µ–Ω–∫–∏ ML –º–æ–¥–µ–ª–µ–π' },
            { name: 'ITS Scraper', category: 'workers', description: '–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–∞—Ä—Å–µ—Ä —Å—Ç–∞—Ç–µ–π ITS' },
            { name: 'Task Orchestrator', category: 'workers', description: 'Bash —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ç–Ω—ã—Ö –ø–∞–π–ø–ª–∞–π–Ω–æ–≤' },
            { name: 'PostgreSQL', category: 'data', description: '–†–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –ë–î –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –∏ –∞—É–¥–∏—Ç–∞' },
            { name: 'Neo4j', category: 'data', description: '–ì—Ä–∞—Ñ–æ–≤–∞—è –ë–î –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–¥–∞ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π' },
            { name: 'Qdrant', category: 'data', description: '–í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞' },
            { name: 'Redis', category: 'data', description: 'In-memory –∫—ç—à –∏ –æ—á–µ—Ä–µ–¥–∏' },
            { name: 'MinIO', category: 'data', description: 'Object storage –¥–ª—è –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ –∏ –º–æ–¥–µ–ª–µ–π' },
            { name: 'ClickHouse', category: 'data', description: 'Column store –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫' },
            { name: 'EDT Plugin', category: 'integration', description: 'Java –ø–ª–∞–≥–∏–Ω –¥–ª—è IDE' },
            { name: 'n8n Node', category: 'integration', description: 'TypeScript –Ω–æ–¥–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏' },
            { name: 'Telegram Bot', category: 'integration', description: 'Python –±–æ—Ç –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤ –∏ chatops' },
            { name: 'Marketplace Extensions', category: 'integration', description: 'BSL –ø–∞–∫–µ—Ç—ã –∏ —à–∞–±–ª–æ–Ω—ã' },
            { name: 'Prometheus', category: 'ops', description: '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫' },
            { name: 'Grafana', category: 'ops', description: '–î–∞—à–±–æ—Ä–¥—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞' },
            { name: 'Alertmanager', category: 'ops', description: '–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∞–ª–µ—Ä—Ç–æ–≤' },
            { name: 'CI/CD', category: 'ops', description: 'GitHub Actions –¥–ª—è CI/CD' },
            { name: 'Tracing/Logs', category: 'ops', description: 'Tempo/Loki –¥–ª—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ –∏ –ª–æ–≥–æ–≤' }
        ];

        function renderComponents(filter = 'all', search = '') {
            const list = document.getElementById('component-list');
            list.innerHTML = '';

            const filtered = components.filter(comp => {
                const matchesFilter = filter === 'all' || comp.category === filter;
                const matchesSearch = comp.name.toLowerCase().includes(search.toLowerCase()) ||
                                    comp.description.toLowerCase().includes(search.toLowerCase());
                return matchesFilter && matchesSearch;
            });

            filtered.forEach(comp => {
                const card = document.createElement('div');
                card.className = 'component-card';
                card.innerHTML = `
                    <h3>${comp.name}</h3>
                    <p>${comp.description}</p>
                `;
                list.appendChild(card);
            });
        }

        // Filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const filter = btn.dataset.filter;
                const search = document.getElementById('search').value;
                renderComponents(filter, search);
            });
        });

        // Search input
        document.getElementById('search').addEventListener('input', (e) => {
            const search = e.target.value;
            const activeFilter = document.querySelector('.filter-btn.active').dataset.filter;
            renderComponents(activeFilter, search);
        });

        // Initial render
        renderComponents();
    </script>
</body>
</html>

