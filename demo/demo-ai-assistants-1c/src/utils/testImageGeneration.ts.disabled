/**
 * –¢–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã –º–æ–¥—É–ª—è Image Generation API
 * –ó–∞–ø—É—Å–∫: npx ts-node src/utils/testImageGeneration.ts
 */

import { 
  generateDemoImage, 
  generateRoleExampleImage,
  getAvailableRoles,
  getRoleDescription,
  getRoleExamples,
  testImageGenerationModule,
  AssistantRole 
} from './imageGeneration';

async function runTests() {
  console.log('üß™ –ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–¥—É–ª—è Image Generation API\n');

  try {
    // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–æ–ª–µ–π
    console.log('1Ô∏è‚É£ –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Ä–æ–ª–µ–π:');
    const roles = getAvailableRoles();
    console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ —Ä–æ–ª–µ–π: ${roles.length}`);
    console.log(`   –†–æ–ª–∏: ${roles.join(', ')}\n`);

    // –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–∏—Å–∞–Ω–∏–π —Ä–æ–ª–µ–π
    console.log('2Ô∏è‚É£ –¢–µ—Å—Ç –æ–ø–∏—Å–∞–Ω–∏–π —Ä–æ–ª–µ–π:');
    for (const role of roles) {
      const description = getRoleDescription(role);
      console.log(`‚úÖ ${role}: ${description}`);
    }
    console.log('');

    // –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º–µ—Ä–æ–≤ –ø—Ä–æ–º–ø—Ç–æ–≤
    console.log('3Ô∏è‚É£ –¢–µ—Å—Ç –ø—Ä–∏–º–µ—Ä–æ–≤ –ø—Ä–æ–º–ø—Ç–æ–≤:');
    for (const role of roles) {
      const examples = getRoleExamples(role);
      console.log(`‚úÖ ${role}: ${examples.length} –ø—Ä–∏–º–µ—Ä–æ–≤`);
      console.log(`   –ü–µ—Ä–≤—ã–π –ø—Ä–∏–º–µ—Ä: ${examples[0]}`);
    }
    console.log('');

    // –¢–µ—Å—Ç 4: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞
    console.log('4Ô∏è‚É£ –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞:');
    const architectResult = await generateRoleExampleImage('architect');
    console.log(`‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: ${architectResult.success ? '–£—Å–ø–µ—Ö' : '–û—à–∏–±–∫–∞'}`);
    if (architectResult.success) {
      console.log(`   –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: ${architectResult.imageUrl}`);
    } else {
      console.log(`   –û—à–∏–±–∫–∞: ${architectResult.error}`);
    }
    console.log('');

    // –¢–µ—Å—Ç 5: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
    console.log('5Ô∏è‚É£ –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:');
    const developerResult = await generateDemoImage(
      'Modern dashboard UI for inventory management system', 
      'developer'
    );
    console.log(`‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: ${developerResult.success ? '–£—Å–ø–µ—Ö' : '–û—à–∏–±–∫–∞'}`);
    if (developerResult.success) {
      console.log(`   –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: ${developerResult.imageUrl}`);
    } else {
      console.log(`   –û—à–∏–±–∫–∞: ${developerResult.error}`);
    }
    console.log('');

    // –¢–µ—Å—Ç 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    console.log('6Ô∏è‚É£ –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–æ–≤:');
    const testPrompts = [
      { prompt: 'Clean architecture diagram', role: 'architect', valid: true },
      { prompt: '', role: 'architect', valid: false },
      { prompt: 'A'.repeat(501), role: 'architect', valid: false }
    ];

    for (const test of testPrompts) {
      const { validatePrompt } = await import('./imageGeneration');
      const isValid = validatePrompt(test.prompt, test.role as AssistantRole);
      console.log(`‚úÖ "${test.prompt.substring(0, 30)}...": ${isValid ? '–í–∞–ª–∏–¥–Ω–æ' : '–ù–µ–≤–∞–ª–∏–¥–Ω–æ'}`);
    }
    console.log('');

    console.log('üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!');

  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –≤–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
  }
}

// –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –µ—Å–ª–∏ —Ñ–∞–π–ª –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é
if (require.main === module) {
  runTests().then(() => {
    console.log('\nüèÅ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
    process.exit(0);
  }).catch((error) => {
    console.error('\nüí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', error);
    process.exit(1);
  });
}

export { runTests };