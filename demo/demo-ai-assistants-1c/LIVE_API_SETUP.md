# Live API Интеграция - Руководство по настройке

## Обзор

Обновленная система демонстрации AI-ассистентов теперь поддерживает:

- ✅ **Live API интеграция** - реальная генерация контента через Supabase Edge Functions
- ✅ **Мониторинг статуса API** - компонент `LiveAPIStatus` отслеживает доступность всех сервисов
- ✅ **Скачивание результатов** - все результаты можно скачать в различных форматах
- ✅ **Fallback режим** - система продолжает работать даже при недоступности API
- ✅ **Индикаторы загрузки** - визуальный прогресс выполнения в реальном времени

## Структура компонентов

### 1. LiveAPIStatus
Компонент мониторинга статуса всех Edge Functions:
- Автоматическая проверка каждые 30 секунд
- Индикация состояния: Онлайн/Оффлайн/Ошибка/Проверка
- Общий статус системы (Здоровый/Частично доступен/Недоступен)
- Визуальные уведомления о проблемах

### 2. LiveDemoButton
Компонент для запуска демонстраций с Live API:
- Кнопка "Live Demo" для каждого сценария
- Реальные API вызовы к Edge Functions
- Пошаговое отображение прогресса
- Обработка ошибок с fallback
- Кнопка скачивания результатов

### 3. Обновленная LiveDemoPage
Основная страница с интеграцией всех компонентов:
- Автоматический мониторинг API
- Переключение между ролями ассистентов
- История выполненных демонстраций
- Статистика и аналитика

## Edge Functions

Готовы к развертыванию 5 Edge Functions:

| Ассистент | Function | Возможности |
|-----------|----------|-------------|
| Архитектор | architect-demo | Диаграммы, архитектурные решения, анализ рисков |
| Разработчик | developer-demo | Генерация кода 1С, оптимизация, API |
| Тестировщик | tester-demo | Тест-кейсы, данные, анализ покрытия |
| PM | pm-demo | Планирование, риски, ресурсы |
| BA | ba-demo | Требования, процессы, User Stories |

## Настройка

### 1. Получение Supabase Credentials

```bash
# Используйте инструмент для получения credentials
ask_for_supabase_auth
```

### 2. Настройка Environment Variables

Скопируйте `.env.example` в `.env` и заполните:

```bash
cp .env.example .env
```

Отредактируйте `.env`:
```env
VITE_SUPABASE_URL=https://your-project-id.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key-here
```

### 3. Развертывание Edge Functions

```bash
# Используйте batch_deploy_edge_functions для развертывания всех функций
batch_deploy_edge_functions([
  {
    "slug": "architect-demo",
    "file_path": "/workspace/demo/demo-ai-assistants-1c/supabase/functions/architect-demo/index.ts",
    "type": "normal",
    "description": "Архитектор AI - проектирование архитектуры"
  },
  {
    "slug": "developer-demo", 
    "file_path": "/workspace/demo/demo-ai-assistants-1c/supabase/functions/developer-demo/index.ts",
    "type": "normal",
    "description": "Разработчик AI - генерация кода"
  },
  {
    "slug": "tester-demo",
    "file_path": "/workspace/demo/demo-ai-assistants-1c/supabase/functions/tester-demo/index.ts", 
    "type": "normal",
    "description": "Тестировщик AI - тестирование"
  },
  {
    "slug": "pm-demo",
    "file_path": "/workspace/demo/demo-ai-assistants-1c/supabase/functions/pm-demo/index.ts",
    "type": "normal", 
    "description": "Менеджер проектов AI - планирование"
  },
  {
    "slug": "ba-demo",
    "file_path": "/workspace/demo/demo-ai-assistants-1c/supabase/functions/ba-demo/index.ts",
    "type": "normal",
    "description": "Бизнес-аналитик AI - требования"
  }
])
```

### 4. Запуск разработки

```bash
cd /workspace/demo/demo-ai-assistants-1c
pnpm install
pnpm dev
```

### 5. Сборка и развертывание

```bash
pnpm build
# Разверните папку dist/ на ваш хостинг
```

## Тестирование

### Локальное тестирование

1. Запустите dev сервер: `pnpm dev`
2. Откройте http://localhost:5173
3. Проверьте статус API в компоненте LiveAPIStatus
4. Запустите демонстрации для каждой роли
5. Скачайте результаты

### Продакшн тестирование

```bash
# Полное тестирование через браузер
test_website(
  url="https://your-deployed-url.com",
  instruction="Проверить все 5 ролей ассистентов, запустить хотя бы одно демо для каждой роли, скачать результаты, проверить работу LiveAPIStatus"
)
```

## Форматы результатов

Система автоматически определяет тип результата и скачивает в соответствующем формате:

- **Диаграммы** (.md) - Mermaid диаграммы с инструкциями
- **Код** (.1s) - Код 1С с комментариями
- **Данные** (.json) - Структурированные данные и метаданные
- **Текст** (.txt) - Обычные текстовые результаты

## Обработка ошибок

### Fallback режим
Если Live API недоступен:
- Система автоматически переключается на fallback
- Пользователь получает уведомление
- Демонстрации работают в симуляционном режиме
- Результаты помечаются как "Fallback"

### Мониторинг
- LiveAPIStatus показывает состояние каждого API
- Автоматическая проверка каждые 30 секунд
- Визуальные индикаторы проблем
- Логирование ошибок в консоль

## Архитектура данных

### Структура ответа Edge Function
```typescript
{
  data: {
    steps: [
      { progress: 10, message: "Шаг 1..." },
      { progress: 50, message: "Шаг 2..." },
      { progress: 100, message: "Завершено", result: {...} }
    ],
    finalResult: {
      // Основной результат демонстрации
    }
  }
}
```

### Структура скачиваемых файлов
- **Markdown**: С диаграммами, метаданными и инструкциями
- **JSON**: Полные данные с результатами и шагами
- **Код**: Исходный код 1С с комментариями

## Производительность

- **Время отклика**: 2-5 секунд на демонстрацию
- **Размер загрузки**: Зависит от типа результата (1-50 KB)
- **Параллельные запросы**: Поддерживаются
- **Кэширование**: Результаты не кэширутся для актуальности

## Безопасность

- CORS настроен для всех Edge Functions
- Валидация входных данных
- Обработка ошибок без утечки данных
- Fallback без доступа к внешним ресурсам

## Поддержка и отладка

### Логи
Все API вызовы логируются в консоль браузера:
```
Calling Edge Function: architect-demo {demoType: "design"}
Edge Function architect-demo success: {...}
```

### Отладка
1. Откройте Developer Tools (F12)
2. Перейдите в Console
3. Запустите демо и наблюдайте за логами
4. Проверьте Network tab для анализа запросов

## Следующие шаги

1. ✅ **Готово**: Обновлены UI компоненты
2. ✅ **Готово**: Интеграция с Live API
3. ✅ **Готово**: Мониторинг статуса
4. ✅ **Готово**: Скачивание результатов
5. ⏳ **Ожидается**: Получение Supabase credentials
6. ⏳ **Ожидается**: Развертывание Edge Functions
7. ⏳ **Ожидается**: Тестирование в продакшн

## Время выполнения

- **Настройка**: ~10 минут после получения credentials
- **Деплой Edge Functions**: ~5 минут
- **Тестирование**: ~15 минут
- **Общее время**: ~30 минут до полной готовности