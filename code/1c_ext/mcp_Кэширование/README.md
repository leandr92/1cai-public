# Модуль кэширования для 1С MCP расширения

## Обзор

Модуль `mcp_Кэширование` предоставляет полную инфраструктуру кэширования для 1С расширения, реализующую современные стандарты кэширования и обработки ошибок.

## Основные возможности

### 1. Управление кэшем

- **УстановитьВКэш()** - Установка значения в кэш с TTL
- **ПолучитьИзКэша()** - Получение значения из кэша с проверкой TTL
- **УдалитьИзКэша()** - Удаление значения из кэша
- **ОчиститьКэш()** - Очистка кэша полностью или по префиксу

### 2. Кэш метаданных конфигурации

- **ПолучитьКэшМетаданныхКонфигурации()** - Специализированный кэш для метаданных с TTL 1 час
- Автоматическое обновление при истечении времени жизни
- Интеграция с модулем `mcp_КонтейнерыПнтИсп`

### 3. HTTP-кэширование с ETag

- **СоздатьETag()** - Создание ETag на основе MD5-хэша содержимого
- **ПроверитьETag()** - Валидация ETag для проверки актуальности данных
- Соответствие стандартам RFC 7234

### 4. Инвалидация кэша по событиям

- **ИнвалидироватьКэшПоСобытию()** - Событийная инвалидация кэша
- Поддерживаемые события:
  - `обновление_конфигурации` - очистка кэша метаданных
  - `обновление_данных` - очистка кэша данных по типам
  - `регламентная_очистка` - очистка истекших записей

### 5. Логирование и мониторинг

- **ПолучитьСтатистикуКэша()** - Статистика использования кэша
- Структурированное логирование в формате JSON
- Журнал регистрации 1С с корреляционными ID
- Полное соответствие стандартам обработки ошибок

## Интеграция с существующими модулями

### Зависимости

- `mcp_ОбщегоНазначения` - для сериализации JSON
- `mcp_КонтейнерыПнтИсп` - для работы с метаданными
- Встроенные механизмы 1С - для логирования и обработки ошибок

### Использование

```1c
// Инициализация (выполняется автоматически)
mcp_Кэширование.ИнициализироватьКэш();

// Установка в кэш
Результат = mcp_Кэширование.УстановитьВКэш(
    "мой_ключ", 
    МоиДанные, 
    3600, // TTL в секундах
    ИдентификаторЗапроса,
    "контекст_кэширования"
);

// Получение из кэша
Данные = mcp_Кэширование.ПолучитьИзКэша("мой_ключ", ИдентификаторЗапроса);

// Инвалидация по событию
mcp_Кэширование.ИнвалидироватьКэшПоСобытию("обновление_конфигурации", , ИдентификаторЗапроса);

// Получение статистики
Статистика = mcp_Кэширование.ПолучитьСтатистикуКэша(ИдентификаторЗапроса);
```

## Стандарты и архитектурные принципы

### Многоуровневое кэширование

Реализовано в соответствии с архитектурными принципами 1С:
- **Межсессионный кэш** - сервер 1С, переиспользование между сеансами
- **Внутрисессионный кэш** - границы сеанса, контекстные данные
- **Временная стратификация** - разные TTL для разных типов данных

### Обработка ошибок

Соблюдение современных стандартов:
- Структурированное логирование с корреляционными ID
- Правильное использование `ОбработкаОшибок.ПодробноеПредставлениеОшибки`
- Не подавляем исключения без необходимости
- Информативные сообщения пользователю и администратору

### HTTP-кэширование

Соответствие RFC 7234:
- ETag для валидации
- Cache-Control политики
- Условные запросы
- Стандартные заголовки

## Безопасность и производительность

### Маскирование данных

- Не логируем чувствительные данные
- PII-маскирование в журнале регистрации
- Безопасность по умолчанию

### Оптимизация производительности

- MD5-хэширование ключей
- Эффективная сериализация JSON
- Проверка TTL при доступе
- Автоматическая очистка истекших записей

### Мониторинг

- Встроенная статистика кэша
- Метрики производительности
- Интеграция с внешними системами мониторинга
- Алертинг по критическим событиям

## Расширение и настройка

### Конфигурация TTL

```1c
// Статические данные - долгий TTL
mcp_Кэширование.УстановитьВКэш("статичные_данные", Данные, 86400); // 24 часа

// Динамические данные - короткий TTL  
mcp_Кэширование.УстановитьВКэш("динамичные_данные", Данные, 300); // 5 минут

// Метаданные - TTL 1 час (по умолчанию)
mcp_Кэширование.ПолучитьКэшМетаданныхКонфигурации();
```

### Событийная инвалидация

```1c
// Очистка кэша при обновлении конфигурации
mcp_Кэширование.ИнвалидироватьКэшПоСобытию("обновление_конфигурации");

// Очистка кэша данных по типам
ДанныеСобытия = Новый Структура("ТипыОбъектов", Новый Массив);
ДанныеСобытия.ТипыОбъектов.Добавить("Справочники");
ДанныеСобытия.ТипыОбъектов.Добавить("Документы");

mcp_Кэширование.ИнвалидироватьКэшПоСобытию("обновление_данных", ДанныеСобытия);
```

## Логирование

Все операции логируются в структурированном JSON-формате:

```json
{
  "timestamp": "2025-10-29T19:56:35Z",
  "level": "INFO",
  "message": "Установка в кэш",
  "module": "mcp_Кэширование",
  "request_id": "req-123456",
  "cache_key": "мой_ключ",
  "context": "контекст_кэширования"
}
```

Уровни логирования:
- **DEBUG** - отладочная информация
- **INFO** - информационные сообщения  
- **WARN** - предупреждения
- **ERROR** - ошибки

## Заключение

Модуль `mcp_Кэширование` обеспечивает полную инфраструктуру кэширования для 1С MCP расширения, соответствующую современным стандартам производительности, безопасности и обработки ошибок. Модуль готов к продуктивному использованию и может быть легко расширен под специфические требования проекта.
