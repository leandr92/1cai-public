#Область ПрограммныйИнтерфейс

// Главная функция тестирования всех MCP инструментов
Функция ВыполнитьВсеТесты() Экспорт
	
	РезультатыТестирования = Новый Массив;
	
	// Заголовок отчета
	РезультатыТестирования.Добавить("=== ТЕСТИРОВАНИЕ MCP ИНСТРУМЕНТОВ ===");
	РезультатыТестирования.Добавить("Дата: " + ТекущаяДата());
	РезультатыТестирования.Добавить("");
	
	// Тестирование mcp_ИнструментДанныеОКонфигурации
	РезультатыТестирования.Добавить("--- ТЕСТИРОВАНИЕ ИНСТРУМЕНТА: Данные о конфигурации ---");
	РезультатыТестирования.Добавить(ТестироватьИнструментДанныеОКонфигурации());
	РезультатыТестирования.Добавить("");
	
	// Тестирование mcp_ИнструментСписокКаталогов
	РезультатыТестирования.Добавить("--- ТЕСТИРОВАНИЕ ИНСТРУМЕНТА: Список каталогов ---");
	РезультатыТестирования.Добавить(ТестироватьИнструментСписокКаталогов());
	РезультатыТестирования.Добавить("");
	
	// Тестирование mcp_ИнструментЧтениеФайла
	РезультатыТестирования.Добавить("--- ТЕСТИРОВАНИЕ ИНСТРУМЕНТА: Чтение файла ---");
	РезультатыТестирования.Добавить(ТестироватьИнструментЧтениеФайла());
	РезультатыТестирования.Добавить("");
	
	// Тестирование mcp_ИнструментЗаписьФайла
	РезультатыТестирования.Добавить("--- ТЕСТИРОВАНИЕ ИНСТРУМЕНТА: Запись файла ---");
	РезультатыТестирования.Добавить(ТестироватьИнструментЗаписьФайла());
	РезультатыТестирования.Добавить("");
	
	// Тестирование mcp_ИнструментПолучениеДанныхОБазе
	РезультатыТестирования.Добавить("--- ТЕСТИРОВАНИЕ ИНСТРУМЕНТА: Данные о базе ---");
	РезультатыТестирования.Добавить(ТестироватьИнструментПолучениеДанныхОБазе());
	РезультатыТестирования.Добавить("");
	
	// Итоговая статистика
	РезультатыТестирования.Добавить("=== ИТОГОВАЯ СТАТИСТИКА ===");
	
	Возврат СтрСоединить(РезультатыТестирования, Символы.ПС);
	
КонецФункции

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

// Тестирование инструмента данных о конфигурации
Функция ТестироватьИнструментДанныеОКонфигурации()
	
	Результаты = Новый Массив;
	
	// POSITIVE тесты
	Результаты.Добавить("# POSITIVE ТЕСТЫ:");
	
	// Тест 1: Получение списка справочников
	Результаты.Добавить("Тест 1: Список справочников");
	НачалоТеста = ТекущаяУниверсальнаяДатаВМиллисекундах();
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("metaType", "Catalogs");
		Аргументы.Вставить("maxItems", 10);
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментДанныеОКонфигурации", "list_metadata_objects", Аргументы);
		
		ВремяВыполнения = ТекущаяУниверсальнаяДатаВМиллисекундах() - НачалоТеста;
		
		Если Результат <> "" Тогда
			Результаты.Добавить("✓ PASSED (" + ВремяВыполнения + "мс)");
			Результаты.Добавить("  Результат: " + Лев(Результат, 100) + "...");
		Иначе
			Результаты.Добавить("✗ FAILED: Пустой результат");
		КонецЕсли;
	Исключение
		Результаты.Добавить("✗ FAILED: " + ОписаниеОшибки());
	КонецПопытки;
	
	// Тест 2: Получение структуры объекта
	Результаты.Добавить("Тест 2: Структура объекта метаданных");
	НачалоТеста = ТекущаяУниверсальнаяДатаВМиллисекундах();
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("metaType", "Catalogs");
		Аргументы.Вставить("name", "Пользователи");
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментДанныеОКонфигурации", "get_metadata_structure", Аргументы);
		
		ВремяВыполнения = ТекущаяУниверсальнаяДатаВМиллисекундах() - НачалоТеста;
		
		Если Результат <> "" Тогда
			Результаты.Добавить("✓ PASSED (" + ВремяВыполнения + "мс)");
			Результаты.Добавить("  Результат: " + Лев(Результат, 100) + "...");
		Иначе
			Результаты.Добавить("✗ FAILED: Пустой результат");
		КонецЕсли;
	Исключение
		Результаты.Добавить("✗ FAILED: " + ОписаниеОшибки());
	КонецПопытки;
	
	// Тест 3: Фильтрация по маске
	Результаты.Добавить("Тест 3: Фильтрация по маске");
	НачалоТеста = ТекущаяУниверсальнаяДатаВМиллисекундах();
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("metaType", "Documents");
		Аргументы.Вставить("nameMask", "Заказ");
		Аргументы.Вставить("maxItems", 5);
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментДанныеОКонфигурации", "list_metadata_objects", Аргументы);
		
		ВремяВыполнения = ТекущаяУниверсальнаяДатаВМиллисекундах() - НачалоТеста;
		
		Если Результат <> "" Тогда
			Результаты.Добавить("✓ PASSED (" + ВремяВыполнения + "мс)");
			Результаты.Добавить("  Найдено элементов: " + СтрРазделить(Результат, Символы.ПС).Количество());
		Иначе
			Результаты.Добавить("✗ FAILED: Пустой результат");
		КонецЕсли;
	Исключение
		Результаты.Добавить("✗ FAILED: " + ОписаниеОшибки());
	КонецПопытки;
	
	// NEGATIVE тесты
	Результаты.Добавить("");
	Результаты.Добавить("# NEGATIVE ТЕСТЫ:");
	
	// Тест 4: Неверный тип метаданных
	Результаты.Добавить("Тест 4: Неверный тип метаданных");
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("metaType", "InvalidType");
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментДанныеОКонфигурации", "list_metadata_objects", Аргументы);
		Результаты.Добавить("✗ FAILED: Должна была быть ошибка, но результат получен");
	Исключение
		Результаты.Добавить("✓ PASSED: Корректная обработка ошибки");
		Результаты.Добавить("  Сообщение: " + ОписаниеОшибки());
	КонецПопытки;
	
	// Тест 5: Несуществующий объект
	Результаты.Добавить("Тест 5: Несуществующий объект метаданных");
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("metaType", "Catalogs");
		Аргументы.Вставить("name", "НесуществующийСправочник");
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментДанныеОКонфигурации", "get_metadata_structure", Аргументы);
		Результаты.Добавить("✗ FAILED: Должна была быть ошибка, но результат получен");
	Исключение
		Результаты.Добавить("✓ PASSED: Корректная обработка ошибки");
		Результаты.Добавить("  Сообщение: " + ОписаниеОшибки());
	КонецПопытки;
	
	// PERFORMANCE тесты
	Результаты.Добавить("");
	Результаты.Добавить("# PERFORMANCE ТЕСТЫ:");
	
	// Тест 6: Большой лимит элементов
	Результаты.Добавить("Тест 6: Производительность с большим лимитом");
	НачалоТеста = ТекущаяУниверсальнаяДатаВМиллисекундах();
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("metaType", "Documents");
		Аргументы.Вставить("maxItems", 1000);
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментДанныеОКонфигурации", "list_metadata_objects", Аргументы);
		
		ВремяВыполнения = ТекущаяУниверсальнаяДатаВМиллисекундах() - НачалоТеста;
		
		Если Результат <> "" Тогда
			Если ВремяВыполнения < 5000 Тогда // До 5 секунд
				Результаты.Добавить("✓ PASSED (" + ВремяВыполнения + "мс)");
			Иначе
				Результаты.Добавить("⚠ WARNING: Длительное время выполнения (" + ВремяВыполнения + "мс)");
			КонецЕсли;
		Иначе
			Результаты.Добавить("✗ FAILED: Пустой результат");
		КонецЕсли;
	Исключение
		Результаты.Добавить("✗ FAILED: " + ОписаниеОшибки());
	КонецПопытки;
	
	// EDGE CASES тесты
	Результаты.Добавить("");
	Результаты.Добавить("# EDGE CASES ТЕСТЫ:");
	
	// Тест 7: Лимит = 0
	Результаты.Добавить("Тест 7: Лимит = 0");
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("metaType", "Catalogs");
		Аргументы.Вставить("maxItems", 0);
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментДанныеОКонфигурации", "list_metadata_objects", Аргументы);
		
		// Результат должен быть пустой строкой
		Если Результат = "" Тогда
			Результаты.Добавить("✓ PASSED: Корректная обработка лимита 0");
		Иначе
			Результаты.Добавить("⚠ WARNING: Некорректная обработка лимита 0");
		КонецЕсли;
	Исключение
		Результаты.Добавить("✗ FAILED: " + ОписаниеОшибки());
	КонецПопытки;
	
	// Тест 8: Пустая маска
	Результаты.Добавить("Тест 8: Пустая маска поиска");
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("metaType", "Catalogs");
		Аргументы.Вставить("nameMask", "");
		Аргументы.Вставить("maxItems", 3);
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментДанныеОКонфигурации", "list_metadata_objects", Аргументы);
		
		Если Результат <> "" Тогда
			Результаты.Добавить("✓ PASSED: Корректная обработка пустой маски");
			Результаты.Добавить("  Найдено элементов: " + СтрРазделить(Результат, Символы.ПС).Количество());
		Иначе
			Результаты.Добавить("✗ FAILED: Пустой результат");
		КонецЕсли;
	Исключение
		Результаты.Добавить("✗ FAILED: " + ОписаниеОшибки());
	КонецПопытки;
	
	Возврат СтрСоединить(Результаты, Символы.ПС);
	
КонецФункции

// Тестирование инструмента список каталогов
Функция ТестироватьИнструментСписокКаталогов()
	
	Результаты = Новый Массив;
	
	// POSITIVE тесты
	Результаты.Добавить("# POSITIVE ТЕСТЫ:");
	
	// Тест 1: Получение списка каталогов конфигурации
	Результаты.Добавить("Тест 1: Список справочников конфигурации");
	НачалоТеста = ТекущаяУниверсальнаяДатаВМиллисекундах();
	Попытка
		Результат = ВыполнитьИнструмент("mcp_ИнструментСписокКаталогов", "list_catalogs", Новый Структура());
		
		ВремяВыполнения = ТекущаяУниверсальнаяДатаВМиллисекундах() - НачалоТеста;
		
		Если Результат <> "" Тогда
			Результаты.Добавить("✓ PASSED (" + ВремяВыполнения + "мс)");
			Результаты.Добавить("  Найдено каталогов: " + СтрРазделить(Результат, Символы.ПС).Количество());
		Иначе
			Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован (используется mcp_ИнструментДанныеОКонфигурации)");
		КонецЕсли;
	Исключение
		Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
	КонецПопытки;
	
	// Тест 2: Фильтрация каталогов
	Результаты.Добавить("Тест 2: Фильтрация каталогов по маске");
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("nameMask", "Польз");
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментСписокКаталогов", "list_catalogs", Аргументы);
		
		Если Результат <> "" Тогда
			Результаты.Добавить("✓ PASSED: Фильтрация работает");
			Результаты.Добавить("  Найдено: " + СтрРазделить(Результат, Символы.ПС).Количество());
		Иначе
			Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
		КонецЕсли;
	Исключение
		Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
	КонецПопытки;
	
	// NEGATIVE тесты
	Результаты.Добавить("");
	Результаты.Добавить("# NEGATIVE ТЕСТЫ:");
	
	// Тест 3: Неизвестный метод
	Результаты.Добавить("Тест 3: Неизвестный метод");
	Попытка
		Результат = ВыполнитьИнструмент("mcp_ИнструментСписокКаталогов", "unknown_method", Новый Структура());
		Результаты.Добавить("✗ FAILED: Должна была быть ошибка");
	Исключение
		Результаты.Добавить("✓ PASSED: Корректная обработка неизвестного метода");
	КонецПопытки;
	
	// PERFORMANCE тесты
	Результаты.Добавить("");
	Результаты.Добавить("# PERFORMANCE ТЕСТЫ:");
	
	// Тест 4: Производительность получения списка
	Результаты.Добавить("Тест 4: Производительность получения полного списка");
	Попытка
		НачалоТеста = ТекущаяУниверсальнаяДатаВМиллисекундах();
		Результат = ВыполнитьИнструмент("mcp_ИнструментСписокКаталогов", "list_catalogs", Новый Структура());
		ВремяВыполнения = ТекущаяУниверсальнаяДатаВМиллисекундах() - НачалоТеста;
		
		Если Результат <> "" Тогда
			Если ВремяВыполнения < 3000 Тогда // До 3 секунд
				Результаты.Добавить("✓ PASSED (" + ВремяВыполнения + "мс)");
			Иначе
				Результаты.Добавить("⚠ WARNING: Длительное время (" + ВремяВыполнения + "мс)");
			КонецЕсли;
		Иначе
			Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
		КонецЕсли;
	Исключение
		Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
	КонецПопытки;
	
	Возврат СтрСоединить(Результаты, Символы.ПС);
	
КонецФункции

// Тестирование инструмента чтения файла
Функция ТестироватьИнструментЧтениеФайла()
	
	Результаты = Новый Массив;
	
	// POSITIVE тесты
	Результаты.Добавить("# POSITIVE ТЕСТЫ:");
	
	// Тест 1: Чтение текстового файла
	Результаты.Добавить("Тест 1: Чтение текстового файла");
	НачалоТеста = ТекущаяУниверсальнаяДатаВМиллисекундах();
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("filePath", "temp/test.txt");
		Аргументы.Вставить("encoding", "UTF-8");
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментЧтениеФайла", "read_file", Аргументы);
		
		ВремяВыполнения = ТекущаяУниверсальнаяДатаВМиллисекундах() - НачалоТеста;
		
		Если Результат <> Неопределено Тогда
			Результаты.Добавить("✓ PASSED (" + ВремяВыполнения + "мс)");
			Результаты.Добавить("  Размер прочитанного: " + СтрДлина(Результат) + " символов");
		Иначе
			Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
		КонецЕсли;
	Исключение
		Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
	КонецПопытки;
	
	// Тест 2: Чтение с кодировкой
	Результаты.Добавить("Тест 2: Чтение файла с разными кодировками");
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("filePath", "temp/test_utf8.txt");
		Аргументы.Вставить("encoding", "UTF-8");
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментЧтениеФайла", "read_file", Аргументы);
		
		Если Результат <> Неопределено Тогда
			Результаты.Добавить("✓ PASSED: Чтение с UTF-8");
		Иначе
			Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
		КонецЕсли;
	Исключение
		Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
	КонецПопытки;
	
	// NEGATIVE тесты
	Результаты.Добавить("");
	Результаты.Добавить("# NEGATIVE ТЕСТЫ:");
	
	// Тест 3: Несуществующий файл
	Результаты.Добавить("Тест 3: Чтение несуществующего файла");
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("filePath", "nonexistent/file.txt");
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментЧтениеФайла", "read_file", Аргументы);
		Результаты.Добавить("✗ FAILED: Должна была быть ошибка");
	Исключение
		Результаты.Добавить("✓ PASSED: Корректная обработка ошибки файла");
	КонецПопытки;
	
	// Тест 4: Неверная кодировка
	Результаты.Добавить("Тест 4: Неверная кодировка");
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("filePath", "temp/test.txt");
		Аргументы.Вставить("encoding", "INVALID");
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментЧтениеФайла", "read_file", Аргументы);
		Результаты.Добавить("⚠ WARNING: Неверная кодировка обработана без ошибки");
	Исключение
		Результаты.Добавить("✓ PASSED: Корректная обработка неверной кодировки");
	КонецПопытки;
	
	// EDGE CASES тесты
	Результаты.Добавить("");
	Результаты.Добавить("# EDGE CASES ТЕСТЫ:");
	
	// Тест 5: Пустой файл
	Результаты.Добавить("Тест 5: Чтение пустого файла");
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("filePath", "temp/empty.txt");
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментЧтениеФайла", "read_file", Аргументы);
		
		Если Результат = "" Тогда
			Результаты.Добавить("✓ PASSED: Корректное чтение пустого файла");
		Иначе
			Результаты.Добавить("⚠ WARNING: Неожиданный результат для пустого файла");
		КонецЕсли;
	Исключение
		Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
	КонецПопытки;
	
	// Тест 6: Большой файл
	Результаты.Добавить("Тест 6: Чтение большого файла");
	НачалоТеста = ТекущаяУниверсальнаяДатаВМиллисекундах();
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("filePath", "temp/large.txt");
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментЧтениеФайла", "read_file", Аргументы);
		ВремяВыполнения = ТекущаяУниверсальнаяДатаВМиллисекундах() - НачалоТеста;
		
		Если Результат <> Неопределено Тогда
			Если ВремяВыполнения < 10000 Тогда // До 10 секунд
				Результаты.Добавить("✓ PASSED (" + ВремяВыполнения + "мс, " + СтрДлина(Результат) + " символов)");
			Иначе
				Результаты.Добавить("⚠ WARNING: Длительное время чтения (" + ВремяВыполнения + "мс)");
			КонецЕсли;
		Иначе
			Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
		КонецЕсли;
	Исключение
		Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
	КонецПопытки;
	
	Возврат СтрСоединить(Результаты, Символы.ПС);
	
КонецФункции

// Тестирование инструмента записи файла
Функция ТестироватьИнструментЗаписьФайла()
	
	Результаты = Новый Массив;
	
	// POSITIVE тесты
	Результаты.Добавить("# POSITIVE ТЕСТЫ:");
	
	// Тест 1: Запись текстового файла
	Результаты.Добавить("Тест 1: Запись текстового файла");
	НачалоТеста = ТекущаяУниверсальнаяДатаВМиллисекундах();
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("filePath", "temp/test_write.txt");
		Аргументы.Вставить("content", "Тестовый контент для записи");
		Аргументы.Вставить("encoding", "UTF-8");
		Аргументы.Вставить("append", Ложь);
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментЗаписьФайла", "write_file", Аргументы);
		
		ВремяВыполнения = ТекущаяУниверсальнаяДатаВМиллисекундах() - НачалоТеста;
		
		Если Результат = Истина Тогда
			Результаты.Добавить("✓ PASSED (" + ВремяВыполнения + "мс)");
			
			// Проверяем, что файл действительно записан
			Если ПроверитьФайлЗаписан("temp/test_write.txt", "Тестовый контент для записи") Тогда
				Результаты.Добавить("  ✓ Файл успешно записан и проверен");
			Иначе
				Результаты.Добавить("  ✗ Ошибка при проверке записанного файла");
			КонецЕсли;
		Иначе
			Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
		КонецЕсли;
	Исключение
		Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
	КонецПопытки;
	
	// Тест 2: Дозапись в файл
	Результаты.Добавить("Тест 2: Дозапись в файл");
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("filePath", "temp/test_write.txt");
		Аргументы.Вставить("content", Символы.ПС + "Дополнительный контент");
		Аргументы.Вставить("append", Истина);
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментЗаписьФайла", "write_file", Аргументы);
		
		Если Результат = Истина Тогда
			Результаты.Добавить("✓ PASSED: Дозапись выполнена");
		Иначе
			Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
		КонецЕсли;
	Исключение
		Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
	КонецПопытки;
	
	// NEGATIVE тесты
	Результаты.Добавить("");
	Результаты.Добавить("# NEGATIVE ТЕСТЫ:");
	
	// Тест 3: Запись в несуществующую директорию
	Результаты.Добавить("Тест 3: Запись в несуществующую директорию");
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("filePath", "nonexistent_dir/file.txt");
		Аргументы.Вставить("content", "Тест");
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментЗаписьФайла", "write_file", Аргументы);
		
		Если Результат = Ложь Тогда
			Результаты.Добавить("✓ PASSED: Корректная обработка несуществующей директории");
		Иначе
			Результаты.Добавить("✗ FAILED: Должна была быть ошибка");
		КонецЕсли;
	Исключение
		Результаты.Добавить("✓ PASSED: Корректная обработка ошибки");
	КонецПопытки;
	
	// Тест 4: Пустой контент
	Результаты.Добавить("Тест 4: Запись пустого контента");
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("filePath", "temp/empty_write.txt");
		Аргументы.Вставить("content", "");
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментЗаписьФайла", "write_file", Аргументы);
		
		Если Результат = Истина Тогда
			Результаты.Добавить("✓ PASSED: Пустой файл создан");
		Иначе
			Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
		КонецЕсли;
	Исключение
		Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
	КонецПопытки;
	
	// EDGE CASES тесты
	Результаты.Добавить("");
	Результаты.Добавить("# EDGE CASES ТЕСТЫ:");
	
	// Тест 5: Большой контент
	Результаты.Добавить("Тест 5: Запись большого контента");
	НачалоТеста = ТекущаяУниверсальнаяДатаВМиллисекундах();
	Попытка
		БольшойКонтент = "";
		Для й = 1 По 10000 Цикл
			БольшойКонтент = БольшойКонтент + "Строка " + й + Символы.ПС;
		КонецЦикла;
		
		Аргументы = Новый Структура;
		Аргументы.Вставить("filePath", "temp/large_write.txt");
		Аргументы.Вставить("content", БольшойКонтент);
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментЗаписьФайла", "write_file", Аргументы);
		ВремяВыполнения = ТекущаяУниверсальнаяДатаВМиллисекундах() - НачалоТеста;
		
		Если Результат = Истина Тогда
			Если ВремяВыполнения < 5000 Тогда // До 5 секунд
				Результаты.Добавить("✓ PASSED (" + ВремяВыполнения + "мс, " + СтрДлина(БольшойКонтент) + " символов)");
			Иначе
				Результаты.Добавить("⚠ WARNING: Длительное время записи (" + ВремяВыполнения + "мс)");
			КонецЕсли;
		Иначе
			Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
		КонецЕсли;
	Исключение
		Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
	КонецПопытки;
	
	Возврат СтрСоединить(Результаты, Символы.ПС);
	
КонецФункции

// Тестирование инструмента получения данных о базе
Функция ТестироватьИнструментПолучениеДанныхОБазе()
	
	Результаты = Новый Массив;
	
	// POSITIVE тесты
	Результаты.Добавить("# POSITIVE ТЕСТЫ:");
	
	// Тест 1: Информация о базе данных
	Результаты.Добавить("Тест 1: Основная информация о базе");
	НачалоТеста = ТекущаяУниверсальнаяДатаВМиллисекундах();
	Попытка
		Результат = ВыполнитьИнструмент("mcp_ИнструментПолучениеДанныхОБазе", "database_info", Новый Структура());
		
		ВремяВыполнения = ТекущаяУниверсальнаяДатаВМиллисекундах() - НачалоТеста;
		
		Если Результат <> Неопределено И Результат <> "" Тогда
			Результаты.Добавить("✓ PASSED (" + ВремяВыполнения + "мс)");
			Результаты.Добавить("  Информация получена: " + Лев(Результат, 100) + "...");
		Иначе
			Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
		КонецЕсли;
	Исключение
		Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
	КонецПопытки;
	
	// Тест 2: Список таблиц
	Результаты.Добавить("Тест 2: Список таблиц базы данных");
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("includeSystemTables", Ложь);
		Аргументы.Вставить("maxTables", 50);
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментПолучениеДанныхОБазе", "list_tables", Аргументы);
		
		Если Результат <> Неопределено И Результат <> "" Тогда
			Результаты.Добавить("✓ PASSED: Список таблиц получен");
		Иначе
			Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
		КонецЕсли;
	Исключение
		Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
	КонецПопытки;
	
	// NEGATIVE тесты
	Результаты.Добавить("");
	Результаты.Добавить("# NEGATIVE ТЕСТЫ:");
	
	// Тест 3: Неверный параметр
	Результаты.Добавить("Тест 3: Неверный параметр");
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("invalid_param", "value");
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментПолучениеДанныхОБазе", "database_info", Аргументы);
		Результаты.Добавить("⚠ WARNING: Неверный параметр обработан без ошибки");
	Исключение
		Результаты.Добавить("✓ PASSED: Корректная обработка неверного параметра");
	КонецПопытки;
	
	// EDGE CASES тесты
	Результаты.Добавить("");
	Результаты.Добавить("# EDGE CASES ТЕСТЫ:");
	
	// Тест 4: Большое количество таблиц
	Результаты.Добавить("Тест 4: Получение большого количества таблиц");
	НачалоТеста = ТекущаяУниверсальнаяДатаВМиллисекундах();
	Попытка
		Аргументы = Новый Структура;
		Аргументы.Вставить("maxTables", 1000);
		
		Результат = ВыполнитьИнструмент("mcp_ИнструментПолучениеДанныхОБазе", "list_tables", Аргументы);
		ВремяВыполнения = ТекущаяУниверсальнаяДатаВМиллисекундах() - НачалоТеста;
		
		Если Результат <> Неопределено Тогда
			Если ВремяВыполнения < 10000 Тогда // До 10 секунд
				Результаты.Добавить("✓ PASSED (" + ВремяВыполнения + "мс)");
			Иначе
				Результаты.Добавить("⚠ WARNING: Длительное время получения таблиц (" + ВремяВыполнения + "мс)");
			КонецЕсли;
		Иначе
			Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
		КонецЕсли;
	Исключение
		Результаты.Добавить("⚠ SKIPPED: Инструмент не реализован");
	КонецПопытки;
	
	Возврат СтрСоединить(Результаты, Символы.ПС);
	
КонецФункции

// Универсальная функция выполнения инструментов
Функция ВыполнитьИнструмент(ИмяОбработки, ИмяИнструмента, Параметры)
	
	Попытка
		МенеджерОбработки = Обработки[ИмяОбработки];
		Возврат МенеджерОбработки.ВыполнитьИнструмент(ИмяИнструмента, Параметры);
	Исключение
		ВызватьИсключение "Ошибка выполнения инструмента " + ИмяИнструмента + " в обработке " + ИмяОбработки + ": " + ОписаниеОшибки();
	КонецПопытки;
	
КонецФункции

// Проверка записи файла
Функция ПроверитьФайлЗаписан(ПутьКФайлу, ОжидаемоеСодержимое)
	
	Попытка
		ЧтениеТекста = Новый ЧтениеТекста(ПутьКФайлу, "UTF-8");
		ФактическоеСодержимое = ЧтениеТекста.Прочитать();
		ЧтениеТекста.Закрыть();
		
		Возврат СтрНайти(ФактическоеСодержимое, ОжидаемоеСодержимое) > 0;
	Исключение
		Возврат Ложь;
	КонецПопытки;
	
КонецФункции

#КонецОбласти
