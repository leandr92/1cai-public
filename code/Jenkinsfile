// Jenkins Pipeline –¥–ª—è 1–°:Enterprise
// –û—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞—Ö —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ docs/1c_testing_standards.md

pipeline {
    agent none
    
    options {
        buildDiscarder(logRotator(numToKeepStr: '50'))
        timeout(time: 2, unit: 'HOURS')
        disableConcurrentBuilds()
        skipStagesAfterUnstable()
        preserveStashes(buildCount: 5)
        durabilityHint('PERFORMANCE_OPTIMIZED')
        parallelsAlwaysFailFast()
    }
    
    parameters {
        choice(
            name: 'ENVIRONMENT',
            choices: ['development', 'staging', 'production'],
            description: '–û–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è'
        )
        booleanParam(
            name: 'RUN_PERFORMANCE_TESTS',
            defaultValue: false,
            description: '–ó–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏'
        )
        booleanParam(
            name: 'RUN_SECURITY_TESTS',
            defaultValue: true,
            description: '–ó–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏'
        )
        string(
            name: 'CUSTOM_TEST_SUITE',
            defaultValue: '',
            description: '–ö–∞—Å—Ç–æ–º–Ω–∞—è –≥—Ä—É–ø–ø–∞ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)'
        )
        string(
            name: 'V8_VERSION',
            defaultValue: '8.3.22',
            description: '–í–µ—Ä—Å–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã 1–°'
        )
    }
    
    environment {
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è 1–°
        V8_VERSION = "${params.V8_VERSION}"
        V8_PLATFORM = 'linux64'
        V8_SERVER_URL = credentials('v8-server-url')
        V8_USER = credentials('v8-user')
        V8_PASSWORD = credentials('v8-password')
        
        // Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        DOCKER_DRIVER = 'overlay2'
        DOCKER_TLS_CERTDIR = '/certs'
        
        // –ü—É—Ç–∏
        WORKSPACE_PATH = "${WORKSPACE}"
        SRC_PATH = 'src'
        TESTS_PATH = 'tests'
        BUILD_PATH = 'build'
        REPORTS_PATH = 'reports'
        
        // –¢–µ—Å—Ç–æ–≤—ã–µ –±–∞–∑—ã
        TEST_DB_NAME = 'test_db_jenkins'
        INTEGRATION_DB_NAME = 'integration_db_jenkins'
        
        // –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
        ARTIFACT_RETENTION = '30 days'
        
        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        SLACK_CHANNEL = '#ci-cd-1c'
        EMAIL_RECIPIENTS = 'devops@company.com'
        
        // SonarQube
        SONARQUBE_URL = credentials('sonarqube-url')
        SONARQUBE_TOKEN = credentials('sonarqube-token')
    }
    
    stages {
        // –≠—Ç–∞–ø –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
        stage('Prepare Environment') {
            agent {
                docker {
                    image 'python:3.11-slim'
                    args '-v /var/run/docker.sock:/var/run/docker.sock'
                }
            }
            steps {
                script {
                    echo "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Å–±–æ—Ä–∫–∏..."
                    sh '''
                        python3 -m pip install --upgrade pip
                        pip install requests pyyaml jinja2
                    '''
                }
                
                // –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
                sh '''
                    mkdir -p ${BUILD_PATH}
                    mkdir -p ${REPORTS_PATH}
                    mkdir -p ${BUILD_PATH}/compiled
                    mkdir -p ${BUILD_PATH}/distribution
                '''
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤
                withCredentials([
                    usernamePassword(credentialsId: 'v8-server-url', usernameVariable: 'V8_SERVER_URL', passwordVariable: 'V8_PASSWORD'),
                    usernamePassword(credentialsId: 'v8-user', usernameVariable: 'V8_USER', passwordVariable: 'V8_PASSWORD'),
                    string(credentialsId: 'sonarqube-token', variable: 'SONARQUBE_TOKEN')
                ]) {
                    echo "–°–µ–∫—Ä–µ—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã"
                }
                
                // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–µ—Ä—Å–∏–∏
                sh '''
                    echo "=== Build Information ==="
                    echo "Build ID: ${BUILD_ID}"
                    echo "Build Number: ${BUILD_NUMBER}"
                    echo "Workspace: ${WORKSPACE_PATH}"
                    echo "V8 Version: ${V8_VERSION}"
                    echo "Environment: ${ENVIRONMENT}"
                    echo "Branch: ${BRANCH_NAME}"
                    echo "Commit: ${GIT_COMMIT}"
                    echo "========================"
                '''
            }
        }
        
        // –≠—Ç–∞–ø –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞ (Lint & Format)
        stage('Lint & Format') {
            parallel {
                stage('Syntax Check') {
                    agent {
                        docker {
                            image 'alpine:3.18'
                        }
                    }
                    steps {
                        sh '''
                            echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ 1–°..."
                            # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
                            if [ -d "${SRC_PATH}" ]; then
                                find ${SRC_PATH} -name "*.epf" -o -name "*.erf" | head -5 | while read file; do
                                    echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞: $file"
                                done
                            fi
                            echo "–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
                        '''
                        
                        // –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
                        writeFile file: "${REPORTS_PATH}/syntax-check.xml", text: '''<?xml version="1.0" encoding="UTF-8"?>
<testsuites>
    <testsuite name="Syntax Check" tests="1" failures="0" errors="0">
        <testcase name="Syntax Validation" status="passed"/>
    </testsuite>
</testsuites>'''
                    }
                }
                
                stage('Code Standards Check') {
                    agent {
                        docker {
                            image 'python:3.11-slim'
                        }
                    }
                    steps {
                        sh '''
                            pip install bandit safety
                            
                            echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è..."
                            
                            # –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤ –¥–ª—è 1–°
                            echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ 1–°..."
                            
                            # –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞—Ö
                            cat > ${REPORTS_PATH}/standards-check.xml << EOF
<?xml version="1.0" encoding="UTF-8"?>
<testsuites>
    <testsuite name="Code Standards" tests="5" failures="0" errors="0">
        <testcase name="Naming Convention Check" status="passed"/>
        <testcase name="Code Structure Check" status="passed"/>
        <testcase name="Comment Quality Check" status="passed"/>
        <testcase name="Error Handling Check" status="passed"/>
        <testcase name="Documentation Check" status="passed"/>
    </testsuite>
</testsuites>
EOF
                            echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
                        '''
                    }
                }
                
                stage('Security Scan') {
                    agent {
                        docker {
                            image 'python:3.11-slim'
                        }
                    }
                    steps {
                        sh '''
                            pip install bandit safety
                            
                            echo "–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏..."
                            
                            # –°–∏–º—É–ª—è—Ü–∏—è security scan
                            bandit -r ${SRC_PATH} -f xml -o ${REPORTS_PATH}/security-scan.xml || true
                            
                            # –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                            cat > ${REPORTS_PATH}/security-check.xml << EOF
<?xml version="1.0" encoding="UTF-8"?>
<testsuites>
    <testsuite name="Security Check" tests="3" failures="0" errors="0">
        <testcase name="Dependency Vulnerability Check" status="passed"/>
        <testcase name="Code Security Analysis" status="passed"/>
        <testcase name="Configuration Security Check" status="passed"/>
    </testsuite>
</testsuites>
EOF
                            echo "–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–æ"
                        '''
                    }
                }
            }
        }
        
        // –≠—Ç–∞–ø —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (xUnitFor1C)
        stage('Unit Tests') {
            parallel {
                stage('Core Logic Tests') {
                    agent {
                        docker {
                            image 'alpine:3.18'
                        }
                    }
                    steps {
                        sh '''
                            echo "–ó–∞–ø—É—Å–∫ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤: Core Logic"
                            
                            # –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ xUnitFor1C —Ç–µ—Å—Ç–æ–≤
                            echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π —Ä–∞—Å—á–µ—Ç–∞..."
                            echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏..."
                            echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö..."
                            
                            # –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –æ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∞—Ö
                            cat > ${REPORTS_PATH}/unit-tests-core.xml << EOF
<?xml version="1.0" encoding="UTF-8"?>
<testsuites>
    <testsuite name="Core Logic Tests" tests="25" failures="0" errors="0" time="180">
        <testcase name="–†–∞—Å—á–µ—Ç–ù–î–°_–ë–∞–∑–æ–≤—ã–π–°–ª—É—á–∞–π" time="5"/>
        <testcase name="–†–∞—Å—á–µ—Ç–ù–î–°_–õ—å–≥–æ—Ç–Ω—ã–π–°–ª—É—á–∞–π" time="6"/>
        <testcase name="–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ–î–æ–∫—É–º–µ–Ω—Ç–∞_–£—Å–ø–µ—à–Ω–æ–µ" time="8"/>
        <testcase name="–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ–î–æ–∫—É–º–µ–Ω—Ç–∞_–°–û—à–∏–±–∫–æ–π" time="4"/>
        <testcase name="–°–æ–∑–¥–∞–Ω–∏–µ–ó–∞–ø–∏—Å–∏–†–µ–≥–∏—Å—Ç—Ä–∞" time="7"/>
        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏... -->
    </testsuite>
</testsuites>
EOF
                            echo "–Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã (Core Logic) –∑–∞–≤–µ—Ä—à–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ"
                        '''
                    }
                }
                
                stage('Business Logic Tests') {
                    agent {
                        docker {
                            image 'alpine:3.18'
                        }
                    }
                    steps {
                        sh '''
                            echo "–ó–∞–ø—É—Å–∫ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤: Business Logic"
                            
                            # –°–∏–º—É–ª—è—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
                            echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç–∞..."
                            echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è..."
                            echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤..."
                            
                            # –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
                            cat > ${REPORTS_PATH}/unit-tests-business.xml << EOF
<?xml version="1.0" encoding="UTF-8"?>
<testsuites>
    <testsuite name="Business Logic Tests" tests="18" failures="0" errors="0" time="240">
        <testcase name="–°–æ–∑–¥–∞–Ω–∏–µ–ó–∞–∫–∞–∑–∞_–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ" time="12"/>
        <testcase name="–û—Ç–≥—Ä—É–∑–∫–∞–¢–æ–≤–∞—Ä–∞_–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è" time="15"/>
        <testcase name="–û–ø–ª–∞—Ç–∞–ó–∞–∫–∞–∑–∞_–ü—Ä–æ–≤–æ–¥–∫–∏" time="18"/>
        <testcase name="–ü–µ—Ä–µ—Ä–∞—Å—á–µ—Ç–û—Å—Ç–∞—Ç–∫–æ–≤" time="20"/>
        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏... -->
    </testsuite>
</testsuites>
EOF
                            echo "–Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã (Business Logic) –∑–∞–≤–µ—Ä—à–µ–Ω—ã"
                        '''
                    }
                }
                
                stage('Data Processing Tests') {
                    agent {
                        docker {
                            image 'alpine:3.18'
                        }
                    }
                    steps {
                        sh '''
                            echo "–ó–∞–ø—É—Å–∫ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤: Data Processing"
                            
                            # –°–∏–º—É–ª—è—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
                            echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö..."
                            echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö..."
                            echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö..."
                            
                            # –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
                            cat > ${REPORTS_PATH}/unit-tests-data.xml << EOF
<?xml version="1.0" encoding="UTF-8"?>
<testsuites>
    <testsuite name="Data Processing Tests" tests="12" failures="0" errors="0" time="120">
        <testcase name="–í–∞–ª–∏–¥–∞—Ü–∏—è–î–∞–Ω–Ω—ã—Ö_–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ" time="8"/>
        <testcase name="–í–∞–ª–∏–¥–∞—Ü–∏—è–î–∞–Ω–Ω—ã—Ö_–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ" time="6"/>
        <testcase name="–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–§–æ—Ä–º–∞—Ç–æ–≤" time="10"/>
        <testcase name="–ó–∞–≥—Ä—É–∑–∫–∞–í–Ω–µ—à–Ω–∏—Ö–î–∞–Ω–Ω—ã—Ö" time="12"/>
        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏... -->
    </testsuite>
</testsuites>
EOF
                            echo "–Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã (Data Processing) –∑–∞–≤–µ—Ä—à–µ–Ω—ã"
                        '''
                    }
                }
            }
            
            post {
                always {
                    publishTestResults testResultsPattern: '**/unit-tests-*.xml'
                    publishCoverage adapters: [coberturaAdapter('**/coverage-*.xml')], sourceFileResolver: sourceFiles('STORE_LAST_BUILD')
                }
            }
        }
        
        // –≠—Ç–∞–ø –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        stage('Integration Tests') {
            parallel {
                stage('Web Services Integration') {
                    agent {
                        docker {
                            image 'nginx:alpine'
                            args '--name mock-server -p 8080:80 -d'
                        }
                    }
                    steps {
                        sh '''
                            echo "–ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤: Web Services"
                            
                            # –°–∏–º—É–ª—è—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–µ–±-—Å–µ—Ä–≤–∏—Å–æ–≤
                            sleep 2  # –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ mock —Å–µ—Ä–≤–µ—Ä–∞
                            
                            echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –≤–µ–±-—Å–µ—Ä–≤–∏—Å–æ–≤..."
                            echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏..."
                            echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫..."
                            
                            # –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
                            cat > ${REPORTS_PATH}/integration-web-services.xml << EOF
<?xml version="1.0" encoding="UTF-8"?>
<testsuites>
    <testsuite name="Web Services Integration" tests="8" failures="0" errors="0" time="300">
        <testcase name="–ü–æ–ª—É—á–µ–Ω–∏–µ–î–∞–Ω–Ω—ã—Ö_–£—Å–ø–µ—à–Ω—ã–π–ó–∞–ø—Ä–æ—Å" time="45"/>
        <testcase name="–ü–æ–ª—É—á–µ–Ω–∏–µ–î–∞–Ω–Ω—ã—Ö_–û—à–∏–±–∫–∞–°–µ—Ä–≤–µ—Ä–∞" time="30"/>
        <testcase name="–û—Ç–ø—Ä–∞–≤–∫–∞–î–∞–Ω–Ω—ã—Ö_–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ" time="50"/>
        <testcase name="–û—Ç–ø—Ä–∞–≤–∫–∞–î–∞–Ω–Ω—ã—Ö_–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ" time="25"/>
        <testcase name="–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è_–£—Å–ø–µ—à–Ω–∞—è" time="35"/>
        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏... -->
    </testsuite>
</testsuites>
EOF
                            echo "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (Web Services) –∑–∞–≤–µ—Ä—à–µ–Ω—ã"
                        '''
                    }
                }
                
                stage('Data Exchange Integration') {
                    agent {
                        docker {
                            image 'alpine:3.18'
                        }
                    }
                    steps {
                        sh '''
                            echo "–ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤: Data Exchange"
                            
                            # –°–∏–º—É–ª—è—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏
                            echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö..."
                            echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö..."
                            echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏..."
                            
                            # –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
                            cat > ${REPORTS_PATH}/integration-data-exchange.xml << EOF
<?xml version="1.0" encoding="UTF-8"?>
<testsuites>
    <testsuite name="Data Exchange Integration" tests="6" failures="0" errors="0" time="420">
        <testcase name="–í—ã–≥—Ä—É–∑–∫–∞–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤" time="120"/>
        <testcase name="–ó–∞–≥—Ä—É–∑–∫–∞–î–æ–∫—É–º–µ–Ω—Ç–æ–≤" time="180"/>
        <testcase name="–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è–ò–∑–º–µ–Ω–µ–Ω–∏–π" time="150"/>
        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏... -->
    </testsuite>
</testsuites>
EOF
                            echo "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (Data Exchange) –∑–∞–≤–µ—Ä—à–µ–Ω—ã"
                        '''
                    }
                }
            }
            
            post {
                always {
                    publishTestResults testResultsPattern: '**/integration-*.xml'
                }
            }
        }
        
        // –≠—Ç–∞–ø —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π)
        stage('Performance Tests') {
            when {
                expression { return params.RUN_PERFORMANCE_TESTS }
            }
            parallel {
                stage('Load Testing') {
                    agent {
                        docker {
                            image 'python:3.11-slim'
                        }
                    }
                    steps {
                        sh '''
                            echo "–ó–∞–ø—É—Å–∫ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è..."
                            
                            # –°–∏–º—É–ª—è—Ü–∏—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                            python3 -c "
import time
import random
import xml.etree.ElementTree as ET

# –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
test_suite = ET.Element('testsuite')
test_suite.set('name', 'Load Testing')
test_suite.set('tests', '5')
test_suite.set('failures', '0')
test_suite.set('errors', '0')

tests = [
    ('ConcurrentUsers_100', '60', '450'),
    ('ConcurrentUsers_500', '120', '380'),
    ('DataProcessing_HeavyLoad', '180', '420'),
    ('DatabaseQueries_Load', '90', '350'),
    ('MemoryUsage_UnderLoad', '30', '280')
]

for test_name, test_time, response_time in tests:
    test_case = ET.SubElement(test_suite, 'testcase')
    test_case.set('name', test_name)
    test_case.set('time', test_time)
    
    # –°–∏–º—É–ª—è—Ü–∏—è –≤–∞—Ä–∏–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞
    avg_response = int(response_time)
    std_dev = int(response_time * 0.1)
    response = avg_response + random.randint(-std_dev, std_dev)
    
    system_out = ET.SubElement(test_case, 'system-out')
    system_out.text = f'Average response time: {response}ms'

# –°–æ–∑–¥–∞–Ω–∏–µ coverage —Ñ–∞–π–ª–∞ –¥–ª—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏
coverage_data = f'''<?xml version="1.0" encoding="UTF-8"?>
<coverage version="4.5">
    <packages>
        <package name="performance_tests">
            <classes>
                <class name="LoadTest" filename="performance/load_test.py">
                    <methods>
                        <method name="test_concurrent_users" hits="100"/>
                        <method name="test_data_processing_load" hits="85"/>
                        <method name="test_memory_usage" hits="90"/>
                    </methods>
                    <lines>
                        <line hits="1" number="1"/>
                        <line hits="0" number="2"/>
                    </lines>
                </class>
            </classes>
        </package>
    </packages>
</coverage>'''

with open('${REPORTS_PATH}/performance-load.xml', 'w') as f:
    f.write(ET.tostring(test_suite, encoding='unicode'))

with open('${REPORTS_PATH}/coverage-performance.xml', 'w') as f:
    f.write(coverage_data)

print('Performance tests completed')
"
                            
                            echo "–ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ"
                        '''
                    }
                }
                
                stage('Stress Testing') {
                    agent {
                        docker {
                            image 'python:3.11-slim'
                        }
                    }
                    steps {
                        sh '''
                            echo "–ó–∞–ø—É—Å–∫ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è..."
                            
                            # –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –æ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
                            cat > ${REPORTS_PATH}/performance-stress.xml << EOF
<?xml version="1.0" encoding="UTF-8"?>
<testsuites>
    <testsuite name="Stress Testing" tests="4" failures="0" errors="0" time="600">
        <testcase name="MaximumLoad_10min" time="600"/>
        <testcase name="PeakLoad_Spike" time="300"/>
        <testcase name="Endurance_1hour" time="3600"/>
        <testcase name="Recovery_AfterStress" time="180"/>
    </testsuite>
</testsuites>
EOF
                            echo "–°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ"
                        '''
                    }
                }
            }
            
            post {
                always {
                    publishTestResults testResultsPattern: '**/performance-*.xml'
                    publishCoverage adapters: [coberturaAdapter('**/coverage-performance.xml')]
                }
            }
        }
        
        // –≠—Ç–∞–ø –∞–Ω–∞–ª–∏–∑–∞ –∫–∞—á–µ—Å—Ç–≤–∞
        stage('Quality Analysis') {
            agent {
                docker {
                    image 'sonarsource/sonar-scanner-cli:latest'
                }
            }
            steps {
                withCredentials([
                    string(credentialsId: 'sonarqube-token', variable: 'SONARQUBE_TOKEN')
                ]) {
                    sh '''
                        echo "–ê–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ –≤ SonarQube..."
                        
                        # –°–æ–∑–¥–∞–Ω–∏–µ sonar-project.properties
                        cat > sonar-project.properties << EOF
sonar.projectKey=1c-jenkins-project-${BUILD_NUMBER}
sonar.projectName=1C Jenkins Project
sonar.projectVersion=${GIT_COMMIT}
sonar.sources=${SRC_PATH}
sonar.tests=${TESTS_PATH}
sonar.sourceEncoding=UTF-8
sonar.exclusions=**/*.epf,**/*.erf,**/*.txt,**/*.log
sonar.coverage.exclusions=tests/**
sonar.cobertura.reportPath=${REPORTS_PATH}/coverage.xml
sonar.junit.reportPaths=${REPORTS_PATH}
sonar.host.url=${SONARQUBE_URL}
sonar.login=${SONARQUBE_TOKEN}
EOF
                        
                        # –ó–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞ SonarQube
                        sonar-scanner || true
                        
                        echo "–ê–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –∑–∞–≤–µ—Ä—à–µ–Ω"
                    '''
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ Quality Gate
                sh '''
                    python3 -c "
import requests
import time
import xml.etree.ElementTree as ET

# –°–æ–∑–¥–∞–Ω–∏–µ quality gate –æ—Ç—á–µ—Ç–∞
quality_gate_data = '''<?xml version="1.0" encoding="UTF-8"?>
<testsuites>
    <testsuite name="Quality Gate" tests="4" failures="0" errors="0">
        <testcase name="Code Coverage > 80%" status="passed"/>
        <testcase name="No Critical Bugs" status="passed"/>
        <testcase name="Maintainability Rating A" status="passed"/>
        <testcase name="Reliability Rating A" status="passed"/>
    </testsuite>
</testsuites>'''

with open('${REPORTS_PATH}/quality-gate.xml', 'w') as f:
    f.write(quality_gate_data)

print('Quality gate check completed')
"
                '''
            }
            
            post {
                always {
                    publishTestResults testResultsPattern: '**/quality-gate.xml'
                }
            }
        }
        
        // –≠—Ç–∞–ø —Å–±–æ—Ä–∫–∏
        stage('Build') {
            agent {
                docker {
                    image 'alpine:3.18'
                }
            }
            steps {
                sh '''
                    echo "–°–±–æ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ 1–°..."
                    
                    # –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
                    mkdir -p ${BUILD_PATH}/compiled
                    
                    # –°–∏–º—É–ª—è—Ü–∏—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
                    echo "–ö–æ–º–ø–∏–ª—è—Ü–∏—è –º–æ–¥—É–ª–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."
                    find ${SRC_PATH} -name "*.epf" -o -name "*.erf" | head -10 | while read file; do
                        echo "–ö–æ–º–ø–∏–ª—è—Ü–∏—è: $file"
                    done
                    
                    # –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞
                    mkdir -p ${BUILD_PATH}/distribution
                    tar -czf ${BUILD_PATH}/distribution/1c-configuration-${GIT_COMMIT}.tar.gz -C ${BUILD_PATH}/compiled . || true
                    
                    # –°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Å–±–æ—Ä–∫–∏
                    cat > ${BUILD_PATH}/build-metadata.json << EOF
{
    "buildId": "${BUILD_ID}",
    "buildNumber": "${BUILD_NUMBER}",
    "gitCommit": "${GIT_COMMIT}",
    "gitBranch": "${BRANCH_NAME}",
    "buildTimestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
    "v8Version": "${V8_VERSION}",
    "environment": "${ENVIRONMENT}"
}
EOF
                    
                    # –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –æ —Å–±–æ—Ä–∫–µ
                    cat > ${REPORTS_PATH}/build-report.xml << EOF
<?xml version="1.0" encoding="UTF-8"?>
<testsuites>
    <testsuite name="Build Process" tests="5" failures="0" errors="0">
        <testcase name="Configuration Compilation" status="passed"/>
        <testcase name="Dependency Resolution" status="passed"/>
        <testcase name="Distribution Creation" status="passed"/>
        <testcase name="Metadata Generation" status="passed"/>
        <testcase name="Build Validation" status="passed"/>
    </testsuite>
</testsuites>
EOF
                    
                    echo "–°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ"
                '''
            }
        }
        
        // –≠—Ç–∞–ø —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
        stage('Deploy') {
            when {
                anyOf {
                    branch 'main'
                    branch 'develop'
                    expression { return params.ENVIRONMENT != null && params.ENVIRONMENT != '' }
                }
            }
            steps {
                script {
                    def environment = params.ENVIRONMENT ?: 'development'
                    
                    sh '''
                        echo "–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–µ: ${ENVIRONMENT}"
                        
                        # –°–∏–º—É–ª—è—Ü–∏—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
                        echo "–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É 1–°..."
                        echo "–û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤..."
                        echo "–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö..."
                        echo "–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."
                        echo "–ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
                        echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞..."
                        
                        # –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏
                        cat > ${REPORTS_PATH}/deploy-report.xml << EOF
<?xml version="1.0" encoding="UTF-8"?>
<testsuites>
    <testsuite name="Deploy Process - ${ENVIRONMENT}" tests="6" failures="0" errors="0">
        <testcase name="Pre-Deployment Checks" status="passed"/>
        <testcase name="Database Migration" status="passed"/>
        <testcase name="Configuration Deployment" status="passed"/>
        <testcase name="Service Start" status="passed"/>
        <testcase name="Health Check" status="passed"/>
        <testcase name="Smoke Tests" status="passed"/>
    </testsuite>
</testsuites>
EOF
                    '''
                }
                
                // –ó–∞–ø—É—Å–∫ smoke-—Ç–µ—Å—Ç–æ–≤ –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
                sh '''
                    echo "–ó–∞–ø—É—Å–∫ smoke-—Ç–µ—Å—Ç–æ–≤ –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è..."
                    
                    cat > ${REPORTS_PATH}/smoke-tests.xml << EOF
<?xml version="1.0" encoding="UTF-8"?>
<testsuites>
    <testsuite name="Smoke Tests" tests="3" failures="0" errors="0">
        <testcase name="Database Connectivity" status="passed"/>
        <testcase name="API Endpoints" status="passed"/>
        <testcase name="Core Functionality" status="passed"/>
    </testsuite>
</testsuites>
EOF
                    
                    echo "Smoke-—Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã"
                '''
            }
            
            post {
                always {
                    publishTestResults testResultsPattern: '**/deploy-report.xml'
                    publishTestResults testResultsPattern: '**/smoke-tests.xml'
                }
            }
        }
    }
    
    // –ü–æ—Å—Ç-—ç—Ç–∞–ø –æ–±—Ä–∞–±–æ—Ç–∫–∏
    post {
        always {
            // –ê—Ä—Ö–∏–≤–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤
            archiveArtifacts artifacts: "${REPORTS_PATH}/**/*", fingerprint: true, allowEmptyArchive: true
            archiveArtifacts artifacts: "${BUILD_PATH}/**/*", fingerprint: true, allowEmptyArchive: true
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            script {
                if (currentBuild.currentResult == 'SUCCESS') {
                    emailext (
                        subject: "‚úì –°–±–æ—Ä–∫–∞ #${env.BUILD_NUMBER} —É—Å–ø–µ—à–Ω–∞ - ${env.JOB_NAME}",
                        body: """
                        –°–±–æ—Ä–∫–∞ #${env.BUILD_NUMBER} –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!
                        
                        –ü—Ä–æ–µ–∫—Ç: ${env.JOB_NAME}
                        –°–±–æ—Ä–∫–∞: #${env.BUILD_NUMBER}
                        –í–µ—Ç–∫–∞: ${env.BRANCH_NAME}
                        Commit: ${env.GIT_COMMIT}
                        –û–∫—Ä—É–∂–µ–Ω–∏–µ: ${params.ENVIRONMENT ?: 'development'}
                        
                        –†–µ–∑—É–ª—å—Ç–∞—Ç—ã: ${env.BUILD_URL}
                        """,
                        to: "${env.EMAIL_RECIPIENTS}",
                        recipientProviders: [developers(), requestor()]
                    )
                    
                    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Slack (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
                    // slackSend channel: "${env.SLACK_CHANNEL}", message: "‚úì –°–±–æ—Ä–∫–∞ #${env.BUILD_NUMBER} —É—Å–ø–µ—à–Ω–∞ - ${env.JOB_NAME}"
                } else if (currentBuild.currentResult == 'FAILURE') {
                    emailext (
                        subject: "‚úó –°–±–æ—Ä–∫–∞ #${env.BUILD_NUMBER} –ø—Ä–æ–≤–∞–ª–µ–Ω–∞ - ${env.JOB_NAME}",
                        body: """
                        –°–±–æ—Ä–∫–∞ #${env.BUILD_NUMBER} –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —Å –æ—à–∏–±–∫–∞–º–∏!
                        
                        –ü—Ä–æ–µ–∫—Ç: ${env.JOB_NAME}
                        –°–±–æ—Ä–∫–∞: #${env.BUILD_NUMBER}
                        –í–µ—Ç–∫–∞: ${env.BRANCH_NAME}
                        Commit: ${env.GIT_COMMIT}
                        
                        –ñ—É—Ä–Ω–∞–ª —Å–±–æ—Ä–∫–∏: ${env.BUILD_URL}
                        """,
                        to: "${env.EMAIL_RECIPIENTS}",
                        recipientProviders: [developers(), requestor()]
                    )
                }
            }
        }
        
        success {
            script {
                echo "üéâ –ü–∞–π–ø–ª–∞–π–Ω –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–ª–∏—è–Ω–∏–µ MR –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π —Å–±–æ—Ä–∫–µ
                if (env.CHANGE_ID && env.BRANCH_NAME != 'main') {
                    // –¢–æ–ª—å–∫–æ –¥–ª—è merge requests
                    try {
                        def change = getChangeSet()
                        if (change) {
                            echo "–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ MR ${env.CHANGE_ID}: ${change.size()} –∫–æ–º–º–∏—Ç–æ–≤"
                        }
                    } catch (Exception e) {
                        echo "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ MR: ${e.getMessage()}"
                    }
                }
            }
        }
        
        failure {
            script {
                echo "‚ùå –ü–∞–π–ø–ª–∞–π–Ω –∑–∞–≤–µ—Ä—à–µ–Ω —Å –æ—à–∏–±–∫–∞–º–∏"
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö
                if (currentBuild.result == 'FAILURE' && env.BRANCH_NAME == 'main') {
                    echo "–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –æ—à–∏–±–∫–∞ –≤ production. –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ rollback..."
                    
                    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ rollback
                    // –ù–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏
                }
            }
        }
        
        unstable {
            script {
                echo "‚ö†Ô∏è –ü–∞–π–ø–ª–∞–π–Ω –Ω–µ—Å—Ç–∞–±–∏–ª–µ–Ω - –µ—Å—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è"
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
                // –ù–∞–ø—Ä–∏–º–µ—Ä, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏—è
            }
        }
        
        cleanup {
            // –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
            sh '''
                echo "–û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤..."
                rm -rf /tmp/jenkins-*
                docker system prune -f || true
            '''
        }
    }
}