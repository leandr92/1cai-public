# Makefile –¥–ª—è API –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∫—ç—à–∞

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏
PYTHON := python3
PIP := pip3
PROJECT_NAME := cache-admin-api
DOCKER_IMAGE := cache_admin_api

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
BLUE := \033[36m
GREEN := \033[32m
YELLOW := \033[33m
RED := \033[31m
RESET := \033[0m

.PHONY: help install dev prod test clean docker-build docker-run lint format security-check health-check docs
.PHONY: test-ratelimit test-ratelimit-unit test-ratelimit-integration test-ratelimit-performance test-ratelimit-stress test-ratelimit-security test-ratelimit-load test-ratelimit-benchmark test-ratelimit-coverage

# –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å
help:
	@echo "$(BLUE)API –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∫—ç—à–∞ - –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:$(RESET)"
	@echo ""
	@echo "$(GREEN)–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:$(RESET)"
	@echo "  install          –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏"
	@echo "  install-dev      –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"
	@echo ""
	@echo "$(GREEN)–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞:$(RESET)"
	@echo "  dev              –ó–∞–ø—É—Å–∫ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"
	@echo "  prod             –ó–∞–ø—É—Å–∫ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞"
	@echo "  test             –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞"
	@echo "  health           –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–µ—Ä–∞"
	@echo ""
	@echo "$(GREEN)Docker:$(RESET)"
	@echo "  docker-build     –°–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑"
	@echo "  docker-run       –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ Docker"
	@echo "  docker-compose   –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Å—Ç–µ–∫–∞"
	@echo "  docker-stop      –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã"
	@echo ""
	@echo "$(GREEN)–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:$(RESET)"
	@echo "  test             –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã"
	@echo "  test-unit        –ó–∞–ø—É—Å—Ç–∏—Ç—å unit —Ç–µ—Å—Ç—ã"
	@echo "  test-coverage    –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º"
	@echo ""
	@echo "$(GREEN)Rate Limiting —Ç–µ—Å—Ç—ã:$(RESET)"
	@echo "  test-ratelimit   –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ rate limiting —Ç–µ—Å—Ç—ã"
	@echo "  test-ratelimit-unit      –ó–∞–ø—É—Å—Ç–∏—Ç—å unit —Ç–µ—Å—Ç—ã rate limiting"
	@echo "  test-ratelimit-integration   –ó–∞–ø—É—Å—Ç–∏—Ç—å integration —Ç–µ—Å—Ç—ã"
	@echo "  test-ratelimit-performance   –ó–∞–ø—É—Å—Ç–∏—Ç—å performance —Ç–µ—Å—Ç—ã"
	@echo "  test-ratelimit-stress        –ó–∞–ø—É—Å—Ç–∏—Ç—å stress —Ç–µ—Å—Ç—ã"
	@echo "  test-ratelimit-security      –ó–∞–ø—É—Å—Ç–∏—Ç—å security —Ç–µ—Å—Ç—ã"
	@echo "  test-ratelimit-load          –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"
	@echo "  test-ratelimit-benchmark     –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–µ–Ω—á–º–∞—Ä–∫–∏"
	@echo ""
	@echo "$(GREEN)–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:$(RESET)"
	@echo "  lint             –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –ª–∏–Ω—Ç–µ—Ä–æ–º"
	@echo "  format           –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞"
	@echo "  security-check   –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"
	@echo ""
	@echo "$(GREEN)–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:$(RESET)"
	@echo "  docs             –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é"
	@echo "  open-docs        –û—Ç–∫—Ä—ã—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ –±—Ä–∞—É–∑–µ—Ä–µ"
	@echo ""
	@echo "$(GREEN)–£—Ç–∏–ª–∏—Ç—ã:$(RESET)"
	@echo "  clean            –û—á–∏—Å—Ç–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã"
	@echo "  check-deps       –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏"
	@echo "  info             –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–µ–∫—Ç–µ"

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
install:
	@echo "$(BLUE)–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...$(RESET)"
	$(PIP) install -r requirements.txt
	@echo "$(GREEN)‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã$(RESET)"

install-dev:
	@echo "$(BLUE)–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏...$(RESET)"
	$(PIP) install -r requirements.txt
	$(PIP) install -r requirements-dev.txt 2>/dev/null || echo "requirements-dev.txt –Ω–µ –Ω–∞–π–¥–µ–Ω"
	@echo "$(GREEN)‚úÖ Dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã$(RESET)"

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
dev:
	@echo "$(BLUE)üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏...$(RESET)"
	$(PYTHON) run.py dev

prod:
	@echo "$(BLUE)üè≠ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞...$(RESET)"
	$(PYTHON) run.py prod

test:
	@echo "$(BLUE)üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞...$(RESET)"
	$(PYTHON) run.py test

# –ü—Ä–æ–≤–µ—Ä–∫–∏
health:
	@echo "$(BLUE)üè• –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–µ—Ä–∞...$(RESET)"
	$(PYTHON) run.py health

check-deps:
	@echo "$(BLUE)üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...$(RESET)"
	$(PYTHON) run.py check

info:
	@echo "$(BLUE)‚ÑπÔ∏è  –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ:$(RESET)"
	$(PYTHON) run.py info

# Docker –∫–æ–º–∞–Ω–¥—ã
docker-build:
	@echo "$(BLUE)üê≥ –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞...$(RESET)"
	docker build -t $(DOCKER_IMAGE) .
	@echo "$(GREEN)‚úÖ Docker –æ–±—Ä–∞–∑ —Å–æ–±—Ä–∞–Ω: $(DOCKER_IMAGE)$(RESET)"

docker-run:
	@echo "$(BLUE)üê≥ –ó–∞–ø—É—Å–∫ –≤ Docker...$(RESET)"
	docker run -p 8000:8000 --env-file .env $(DOCKER_IMAGE)

docker-compose:
	@echo "$(BLUE)üê≥ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Å—Ç–µ–∫–∞ —Å Docker Compose...$(RESET)"
	docker-compose up -d
	@echo "$(GREEN)‚úÖ –°—Ç–µ–∫ –∑–∞–ø—É—â–µ–Ω$(RESET)"
	@echo "$(YELLOW)üìä –°–µ—Ä–≤–∏—Å—ã:$(RESET)"
	@echo "  API: http://localhost:8000"
	@echo "  Redis: localhost:6379"
	@echo "  Prometheus: http://localhost:9090"
	@echo "  Grafana: http://localhost:3000"

docker-stop:
	@echo "$(BLUE)üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤...$(RESET)"
	docker-compose down
	@echo "$(GREEN)‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã$(RESET)"

docker-logs:
	docker-compose logs -f cache-admin-api

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
test: test-unit

test-unit:
	@echo "$(BLUE)üß™ –ó–∞–ø—É—Å–∫ unit —Ç–µ—Å—Ç–æ–≤...$(RESET)"
	pytest test_cache_admin.py -v --tb=short
	@echo "$(GREEN)‚úÖ –¢–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã$(RESET)"

test-coverage:
	@echo "$(BLUE)üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –∞–Ω–∞–ª–∏–∑–æ–º –ø–æ–∫—Ä—ã—Ç–∏—è...$(RESET)"
	pytest test_cache_admin.py --cov=api --cov-report=html --cov-report=term
	@echo "$(GREEN)‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ$(RESET)"
	@echo "üìä –û—Ç—á–µ—Ç: htmlcov/index.html"

test-integration:
	@echo "$(BLUE)üß™ –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤...$(RESET)"
	pytest test_cache_admin.py::TestCacheAdminAPI -v

# –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
lint:
	@echo "$(BLUE)üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –ª–∏–Ω—Ç–µ—Ä–æ–º...$(RESET)"
	@if command -v flake8 >/dev/null 2>&1; then \
		flake8 api/ --max-line-length=100 --ignore=E203,W503; \
		echo "$(GREEN)‚úÖ Lint –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–π–¥–µ–Ω–∞$(RESET)"; \
	else \
		echo "$(RED)‚ùå flake8 –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install flake8$(RESET)"; \
	fi

format:
	@echo "$(BLUE)üìù –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞...$(RESET)"
	@if command -v black >/dev/null 2>&1; then \
		black api/ --line-length=100; \
		echo "$(GREEN)‚úÖ –ö–æ–¥ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω$(RESET)"; \
	else \
		echo "$(RED)‚ùå black –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install black$(RESET)"; \
	fi

security-check:
	@echo "$(BLUE)üîí –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏...$(RESET)"
	@if command -v safety >/dev/null 2>&1; then \
		safety check; \
		echo "$(GREEN)‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–π–¥–µ–Ω–∞$(RESET)"; \
	else \
		echo "$(YELLOW)‚ö†Ô∏è safety –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install safety$(RESET)"; \
	fi

# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
docs:
	@echo "$(BLUE)üìö –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏...$(RESET)"
	@mkdir -p docs
	@echo "$(GREEN)‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ /docs –∏ /redoc$(RESET)"

open-docs:
	@echo "$(BLUE)üåê –û—Ç–∫—Ä—ã—Ç–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏...$(RESET)"
	@if command -v xdg-open >/dev/null 2>&1; then \
		xdg-open http://localhost:8000/docs; \
	elif command -v open >/dev/null 2>&1; then \
		open http://localhost:8000/docs; \
	else \
		echo "$(YELLOW)–û—Ç–∫—Ä–æ–π—Ç–µ –≤—Ä—É—á–Ω—É—é: http://localhost:8000/docs$(RESET)"; \
	fi

# –£—Ç–∏–ª–∏—Ç—ã
clean:
	@echo "$(BLUE)üßπ –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤...$(RESET)"
	find . -type f -name "*.pyc" -delete
	find . -type d -name "__pycache__" -delete
	find . -type d -name "*.egg-info" -exec rm -rf {} +
	rm -rf .pytest_cache
	rm -rf .coverage
	rm -rf htmlcov
	rm -rf dist
	rm -rf build
	rm -rf logs/*.log
	@echo "$(GREEN)‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞$(RESET)"

clean-all: clean
	@echo "$(BLUE)üßπ –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤–∫–ª—é—á–∞—è Docker...$(RESET)"
	docker system prune -f
	docker volume prune -f
	@echo "$(GREEN)‚úÖ Docker –æ—á–∏—â–µ–Ω$(RESET)"

# –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
setup-dev: install-dev
	@echo "$(BLUE)üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏...$(RESET)"
	@if [ ! -f .env ]; then \
		cp .env.example .env; \
		echo "$(YELLOW)‚ö†Ô∏è  –°–æ–∑–¥–∞–Ω .env —Ñ–∞–π–ª. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –µ–≥–æ –¥–ª—è –≤–∞—à–µ–π —Å—Ä–µ–¥—ã.$(RESET)"; \
	fi
	@echo "$(GREEN)‚úÖ –°—Ä–µ–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞$(RESET)"

watch:
	@echo "$(BLUE)üëÄ –ó–∞–ø—É—Å–∫ —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π...$(RESET)"
	@if command -m watchdog >/dev/null 2>&1; then \
		watchmedo auto-restart --patterns="*.py" --ignore-patterns="test_*" --recursive -- $(PYTHON) run.py dev; \
	else \
		echo "$(YELLOW)‚ö†Ô∏è watchdog –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install watchdog$(RESET)"; \
		$(MAKE) dev; \
	fi

# –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
profile:
	@echo "$(BLUE)‚ö° –ó–∞–ø—É—Å–∫ —Å –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º...$(RESET)"
	@echo "$(YELLOW)‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏: pip install py-spy$(RESET)"
	$(PYTHON) -m cProfile -o profile_output.prof run.py dev

benchmark:
	@echo "$(BLUE)üìä –ó–∞–ø—É—Å–∫ –±–µ–Ω—á–º–∞—Ä–∫–æ–≤...$(RESET)"
	@echo "$(YELLOW)‚ö†Ô∏è –ë–µ–Ω—á–º–∞—Ä–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–∑–∂–µ$(RESET)"

# CI/CD
ci-test: lint security-check test-coverage
	@echo "$(GREEN)‚úÖ CI —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã$(RESET)"

deploy-check: ci-test
	@echo "$(BLUE)üöÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –¥–µ–ø–ª–æ—é...$(RESET)"
	@echo "$(GREEN)‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –¥–µ–ø–ª–æ—é$(RESET)"

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
logs:
	docker-compose logs -f cache-admin-api

monitor:
	@echo "$(BLUE)üìä –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞...$(RESET)"
	@echo "$(YELLOW)–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:$(RESET)"
	@echo "  üìà Grafana: http://localhost:3000 (admin/admin123)"
	@echo "  üìä Prometheus: http://localhost:9090"

# –ü–æ–º–æ—â–Ω–∏–∫–∏
.PHONY: deps-check deps-install
deps-check:
	@echo "$(BLUE)üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:$(RESET)"
	@echo "Python: $(shell $(PYTHON) --version 2>/dev/null || echo 'not found')"
	@echo "Pip: $(shell $(PIP) --version 2>/dev/null || echo 'not found')"
	@echo "Docker: $(shell docker --version 2>/dev/null || echo 'not found')"
	@echo "Docker Compose: $(shell docker-compose --version 2>/dev/null || echo 'not found')"

deps-install:
	@echo "$(BLUE)üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...$(RESET)"
	@echo "$(YELLOW)–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Ä—É—á–Ω—É—é –¥–ª—è –≤–∞—à–µ–π –û–°:$(RESET)"
	@echo "- Python 3.9+"
	@echo "- Docker –∏ Docker Compose"
	@echo "- Git"

# –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞
status:
	@echo "$(BLUE)üìä –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞:$(RESET)"
	@echo "$(GREEN)API –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∫—ç—à–∞$(RESET)"
	@echo "–í–µ—Ä—Å–∏—è: 1.0.0"
	@echo "–°—Ç–∞—Ç—É—Å: –ì–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é"
	@echo ""
	@echo "$(YELLOW)–î–æ—Å—Ç—É–ø–Ω—ã–µ endpoints:$(RESET)"
	@echo "  GET  /cache/stats"
	@echo "  GET  /cache/keys"
	@echo "  GET  /cache/health"
	@echo "  GET  /cache/list"
	@echo "  GET  /cache/key/{key}"
	@echo "  DELETE /cache/clear"
	@echo "  DELETE /cache/invalidate/{key}"
	@echo ""
	@echo "$(YELLOW)–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:$(RESET)"
	@echo "  /docs - Swagger UI"
	@echo "  /redoc - ReDoc"
	@echo ""
	@if [ -f .env ]; then \
		echo "$(GREEN)‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞$(RESET)"; \
	else \
		echo "$(RED)‚ùå –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç .env —Ñ–∞–π–ª$(RESET)"; \
		echo "–°–æ–∑–¥–∞–π—Ç–µ: cp .env.example .env"; \
	fi

# =============================================================================
# RATE LIMITING TESTS
# =============================================================================

test-ratelimit:
	@echo "$(BLUE)üß™ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö rate limiting —Ç–µ—Å—Ç–æ–≤...$(RESET)"
	pytest tests/test_ratelimit.py -v --tb=short
	@echo "$(GREEN)‚úÖ Rate limiting —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã$(RESET)"

test-ratelimit-unit:
	@echo "$(BLUE)üß™ –ó–∞–ø—É—Å–∫ unit —Ç–µ—Å—Ç–æ–≤ rate limiting...$(RESET)"
	pytest tests/test_ratelimit.py -v -m "unit"
	@echo "$(GREEN)‚úÖ Unit —Ç–µ—Å—Ç—ã rate limiting –∑–∞–≤–µ—Ä—à–µ–Ω—ã$(RESET)"

test-ratelimit-integration:
	@echo "$(BLUE)üß™ –ó–∞–ø—É—Å–∫ integration —Ç–µ—Å—Ç–æ–≤ rate limiting...$(RESET)"
	pytest tests/test_ratelimit.py -v -m "integration"
	@echo "$(GREEN)‚úÖ Integration —Ç–µ—Å—Ç—ã rate limiting –∑–∞–≤–µ—Ä—à–µ–Ω—ã$(RESET)"

test-ratelimit-performance:
	@echo "$(BLUE)‚ö° –ó–∞–ø—É—Å–∫ performance —Ç–µ—Å—Ç–æ–≤ rate limiting...$(RESET)"
	pytest tests/test_ratelimit.py -v -m "performance" --benchmark-only
	@echo "$(GREEN)‚úÖ Performance —Ç–µ—Å—Ç—ã rate limiting –∑–∞–≤–µ—Ä—à–µ–Ω—ã$(RESET)"

test-ratelimit-stress:
	@echo "$(BLUE)üí™ –ó–∞–ø—É—Å–∫ stress —Ç–µ—Å—Ç–æ–≤ rate limiting...$(RESET)"
	pytest tests/test_ratelimit.py -v -m "stress"
	@echo "$(GREEN)‚úÖ Stress —Ç–µ—Å—Ç—ã rate limiting –∑–∞–≤–µ—Ä—à–µ–Ω—ã$(RESET)"

test-ratelimit-security:
	@echo "$(BLUE)üîí –ó–∞–ø—É—Å–∫ security —Ç–µ—Å—Ç–æ–≤ rate limiting...$(RESET)"
	pytest tests/test_ratelimit.py -v -m "security"
	@echo "$(GREEN)‚úÖ Security —Ç–µ—Å—Ç—ã rate limiting –∑–∞–≤–µ—Ä—à–µ–Ω—ã$(RESET)"

test-ratelimit-load:
	@echo "$(BLUE)üöÄ –ó–∞–ø—É—Å–∫ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...$(RESET)"
	@echo "$(YELLOW)–î–ª—è –∑–∞–ø—É—Å–∫–∞ Locust GUI:$(RESET)"
	@echo "  locust -f tests/loadtest_ratelimit.py --host=http://localhost:8000"
	@echo "$(YELLOW)–î–ª—è headless —Ä–µ–∂–∏–º–∞:$(RESET)"
	@echo "  locust -f tests/loadtest_ratelimit.py --headless -u 100 -r 5 -t 300s"

test-ratelimit-benchmark:
	@echo "$(BLUE)üìä –ó–∞–ø—É—Å–∫ –±–µ–Ω—á–º–∞—Ä–∫–æ–≤ rate limiting...$(RESET)"
	python tests/benchmark_ratelimit.py
	@echo "$(GREEN)‚úÖ –ë–µ–Ω—á–º–∞—Ä–∫–∏ rate limiting –∑–∞–≤–µ—Ä—à–µ–Ω—ã$(RESET)"

test-ratelimit-benchmark-quick:
	@echo "$(BLUE)‚ö° –ó–∞–ø—É—Å–∫ –±—ã—Å—Ç—Ä—ã—Ö –±–µ–Ω—á–º–∞—Ä–∫–æ–≤...$(RESET)"
	python tests/benchmark_ratelimit.py --quick
	@echo "$(GREEN)‚úÖ –ë—ã—Å—Ç—Ä—ã–µ –±–µ–Ω—á–º–∞—Ä–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã$(RESET)"

test-ratelimit-coverage:
	@echo "$(BLUE)üìà –ê–Ω–∞–ª–∏–∑ –ø–æ–∫—Ä—ã—Ç–∏—è rate limiting —Ç–µ—Å—Ç–æ–≤...$(RESET)"
	pytest tests/test_ratelimit.py --cov=ratelimit --cov-report=html --cov-report=term --cov-fail-under=90
	@echo "$(GREEN)‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ rate limiting –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ$(RESET)"
	@echo "–û—Ç—á–µ—Ç –æ –ø–æ–∫—Ä—ã—Ç–∏–∏: htmlcov/index.html"

test-ratelimit-thread-safety:
	@echo "$(BLUE)üîí –ó–∞–ø—É—Å–∫ thread safety —Ç–µ—Å—Ç–æ–≤...$(RESET)"
	pytest tests/test_ratelimit.py -v -m "thread_safety"
	@echo "$(GREEN)‚úÖ Thread safety —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã$(RESET)"

test-ratelimit-all:
	@echo "$(BLUE)üß™ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ rate limiting —Ç–µ—Å—Ç–æ–≤...$(RESET)"
	@make test-ratelimit-unit
	@make test-ratelimit-integration
	@make test-ratelimit-performance
	@make test-ratelimit-stress
	@make test-ratelimit-security
	@make test-ratelimit-benchmark-quick
	@make test-ratelimit-coverage
	@echo "$(GREEN)‚úÖ –í—Å–µ rate limiting —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã$(RESET)"

# CI/CD –¥–ª—è rate limiting
ci-ratelimit: lint security-check test-ratelimit-coverage
	@echo "$(GREEN)‚úÖ CI rate limiting —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã$(RESET)"
