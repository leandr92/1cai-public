# MCP Tools Cache

–ú–æ–¥—É–ª—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ MCP tools –¥–ª—è 1C MCP —Å–µ—Ä–≤–µ—Ä–∞, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞—Ö –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
- [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
- [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- [–ü—Ä–∏–º–µ—Ä—ã](#–ø—Ä–∏–º–µ—Ä—ã)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å](#–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- **TTL —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏**: 30 –º–∏–Ω—É—Ç –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, 5 –º–∏–Ω—É—Ç –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä**: 100MB (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**
- **–ú–µ—Ç—Ä–∏–∫–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–π/–ø—Ä–æ–º–∞—Ö–æ–≤**
- **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ø–∞–º—è—Ç—å + persistent cache –Ω–∞ –¥–∏—Å–∫–µ
- **–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è**: LRU –∏ TTL-based
- **–ú–µ—Ö–∞–Ω–∏–∑–º—ã –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏**: –ø–æ —à–∞–±–ª–æ–Ω–∞–º, —Å—É—â–Ω–æ—Å—Ç—è–º, —Å–æ–±—ã—Ç–∏—è–º

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
- **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ 1–°**: —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤, –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤
- **–ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**: –æ—Ç—á—ë—Ç—ã, –∏—Ç–æ–≥–∏, –æ–±–æ—Ä–æ—Ç—ã
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤**: —Å—Ö–µ–º—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã MCP tools
- **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã API**: –æ—Ç–≤–µ—Ç—ã –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –∫ 1–°
- **–°—Ç–∞–±–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**: —Ä–µ–¥–∫–æ –∏–∑–º–µ–Ω—è—é—â–∏–µ—Å—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ**: —á–∞—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º—ã–µ –∑–∞–ø–∏—Å–∏

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π
cp -r cache/ /path/to/your/project/
cp tests/test_mcp_cache.py /path/to/your/project/tests/
```

### –ë–∞–∑–æ–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
```python
from cache import init_cache, cached, cache_tool_result

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫—ç—à–∞
cache = init_cache(
    max_size_mb=100,
    default_ttl_stable=30 * 60,  # 30 –º–∏–Ω—É—Ç
    default_ttl_dynamic=5 * 60,   # 5 –º–∏–Ω—É—Ç
    persistent_cache_dir="./cache_data"
)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞
@cached(ttl=300, data_type='stable')
def get_catalog_structure(catalog_name):
    # –î–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
    return fetch_from_1c(catalog_name)

# –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ MCP tool
result = execute_tool("get_nomenclature", {"id": 123})
cache_tool_result("get_nomenclature", {"id": 123}, result)
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
cache/
‚îú‚îÄ‚îÄ __init__.py              # –≠–∫—Å–ø–æ—Ä—Ç API
‚îú‚îÄ‚îÄ mcp_cache.py            # –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å (MCPToolsCache –∏ –¥—Ä.)
‚îú‚îÄ‚îÄ integration_examples.py # –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### –ö–ª–∞—Å—Å—ã –º–æ–¥—É–ª—è

1. **MCPToolsCache** - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
2. **CacheStrategy** - –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
3. **LRUStrategy** - —Å—Ç—Ä–∞—Ç–µ–≥–∏—è Least Recently Used
4. **TTLCacheStrategy** - —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ TTL
5. **CacheInvalidation** - –º–µ—Ö–∞–Ω–∏–∑–º—ã –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏
6. **PersistentCache** - –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫–µ
7. **CacheEntry** - –∑–∞–ø–∏—Å—å –∫—ç—à–∞ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
8. **CacheMetrics** - –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –°–ª–æ–π –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Application Layer           ‚îÇ
‚îÇ  (mcp_server.py, onec_client.py)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         MCPToolsCache               ‚îÇ
‚îÇ  - In-Memory Cache (LRU/TTL)       ‚îÇ
‚îÇ  - Persistent Cache (disk)         ‚îÇ
‚îÇ  - Metrics & Monitoring            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        Storage Layer                ‚îÇ
‚îÇ  - Memory (OrderedDict)            ‚îÇ
‚îÇ  - Disk (pickle + index.json)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

```python
cache = init_cache(
    max_size_mb=100,              # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞
    default_ttl_stable=1800,      # TTL —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Å–µ–∫—É–Ω–¥—ã)
    default_ttl_dynamic=300,      # TTL –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö (—Å–µ–∫—É–Ω–¥—ã)
    persistent_cache_dir="./cache",  # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è persistent cache
    strategy=None                 # –°—Ç—Ä–∞—Ç–µ–≥–∏—è –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è
)
```

### –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –∏ –∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø–∞–º
data_type_configs = {
    'metadata': {
        'ttl': default_ttl_stable,  # 30 –º–∏–Ω—É—Ç
        'persistent': True          # –°–æ—Ö—Ä–∞–Ω—è—Ç—å –Ω–∞ –¥–∏—Å–∫
    },
    'aggregates': {
        'ttl': default_ttl_dynamic, # 5 –º–∏–Ω—É—Ç
        'persistent': False         # –¢–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏
    },
    'tool_config': {
        'ttl': default_ttl_stable,
        'persistent': True
    },
    'api_response': {
        'ttl': default_ttl_dynamic,
        'persistent': False
    }
}
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è

```python
from cache import LRU, TTLCacheStrategy

# LRU —Å—Ç—Ä–∞—Ç–µ–≥–∏—è (–≤—ã—Ç–µ—Å–Ω—è–µ—Ç –¥–∞–≤–Ω–æ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ)
lru_strategy = LRU()

# TTL —Å—Ç—Ä–∞—Ç–µ–≥–∏—è (–≤—ã—Ç–µ—Å–Ω—è–µ—Ç –∏—Å—Ç—ë–∫—à–∏–µ)
ttl_strategy = TTLCacheStrategy()

cache = init_cache(strategy=ttl_strategy)
```

## üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

```python
from cache import get_cache

cache = get_cache()

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
success = cache.set("key", "value", ttl=300, data_type='stable')

# –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
value = cache.get("key", data_type='stable')

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è
exists = cache.has("key")

# –£–¥–∞–ª–µ–Ω–∏–µ
deleted = cache.delete("key")

# –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ –∫—ç—à–∞
cache.clear()
```

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

```python
async def async_example():
    cache = get_cache()
    
    # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    await cache.set_async("async_key", "async_value")
    
    # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ
    value = await cache.get_async("async_key")
    
    # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    exists = await cache.has_async("async_key")
```

### –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

```python
from cache import cached, cached_async

# –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
@cached(ttl=600, data_type='stable')
def get_user_info(user_id):
    # –î–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
    return fetch_user_from_1c(user_id)

# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
@cached_async(ttl=300, data_type='dynamic')
async def get_report_data(report_id):
    # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
    return await fetch_report_from_1c(report_id)

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–ª—é—á–µ–π
def user_cache_key(user_id, include_inactive=False):
    return f"user:{user_id}:inactive={include_inactive}"

@cached(key_func=user_cache_key, ttl=1800)
def get_user_profile(user_id, include_inactive=False):
    return fetch_profile(user_id, include_inactive)
```

### –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

```python
from cache import (
    cache_tool_result, get_cached_tool_result,
    cache_metadata_1c, get_cached_metadata_1c,
    cache_aggregates, get_cached_aggregates
)

# –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ MCP tools
tool_result = execute_tool("get_catalog_info", {"catalog": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"})
cache_tool_result("get_catalog_info", {"catalog": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"}, tool_result)

# –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö 1–°
metadata = get_catalog_metadata("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏")
cache_metadata_1c("catalog", "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏", metadata)

# –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
aggregates = calculate_sales_report("2024-01", {"region": "Moscow"})
cache_aggregates("sales_report", "2024-01", {"region": "Moscow"}, aggregates)
```

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å mcp_server.py

```python
from cache.integration_examples import setup_cache_integration

# –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞
cache_integrations = setup_cache_integration()
mcp_integration = cache_integrations['mcp_integration']

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
async def handle_tool_with_cache(tool_name, arguments):
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
    cached_result = await mcp_integration.get_cached_tool_execution(
        tool_name, arguments
    )
    
    if cached_result:
        return cached_result['result']
    
    # –í—ã–ø–æ–ª–Ω—è–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
    result = await execute_1c_tool(tool_name, arguments)
    
    # –ö—ç—à–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    await mcp_integration.cache_tool_execution(tool_name, arguments, result)
    
    return result
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å onec_client.py

```python
from cache.integration_examples import execute_1c_query_with_cache

# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
async def get_user_list(active_only=True):
    query = "SELECT * FROM –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫.–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ WHERE –ê–∫—Ç–∏–≤–µ–Ω = &–ê–∫—Ç–∏–≤–µ–Ω"
    params = {"–ê–∫—Ç–∏–≤–µ–Ω": active_only}
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à, –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
    return await execute_1c_query_with_cache(query, params)
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

```python
# –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è
def expensive_calculation(param1, param2):
    # –î–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
    return complex_result

# –î–æ–±–∞–≤–ª—è–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
@cached(ttl=1800, data_type='aggregates')
def expensive_calculation(param1, param2):
    # –î–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
    return complex_result
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```python
from cache import get_cache_stats
from cache.integration_examples import CacheManager

# –ë–∞–∑–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
stats = get_cache_stats()
print(f"–ó–∞–ø–∏—Å–µ–π –≤ –∫—ç—à–µ: {stats['total_entries']}")
print(f"–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: {stats['memory_usage_mb']:.2f} MB")
print(f"Hit ratio: {stats['hit_ratio']:.2%}")
print(f"–ü–æ–ø–∞–¥–∞–Ω–∏—è: {stats['hits']}, –ü—Ä–æ–º–∞—Ö–∏: {stats['misses']}")

# –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
cache_manager = CacheManager()
detailed_stats = cache_manager.get_detailed_stats()
print(f"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º: {detailed_stats['cache_distribution']}")
print(f"–¢–æ–ø –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤: {detailed_stats['top_cached_tools']}")
```

### –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```python
cache = get_cache()
metrics = cache.get_metrics()

# –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
print(f"Hit Ratio: {metrics.hit_ratio:.2%}")
print(f"–ü–æ–ø–∞–¥–∞–Ω–∏—è: {metrics.hits}")
print(f"–ü—Ä–æ–º–∞—Ö–∏: {metrics.misses}")
print(f"–í—ã—Ç–µ—Å–Ω–µ–Ω–∏—è: {metrics.evictions}")
print(f"–û—à–∏–±–∫–∏: {metrics.errors}")
```

### –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

```python
import asyncio
from cache.integration_examples import periodic_cache_maintenance

# –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ (–∫–∞–∂–¥—ã–π —á–∞—Å)
async def maintenance_task():
    while True:
        await periodic_cache_maintenance()
        await asyncio.sleep(3600)  # 1 —á–∞—Å

# –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–µ
asyncio.create_task(maintenance_task())
```

## üìù –ü—Ä–∏–º–µ—Ä—ã

### –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
import asyncio
import time
from cache import init_cache, cached, cache_tool_result, get_cache_stats

async def main():
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    cache = init_cache(
        max_size_mb=100,
        default_ttl_stable=30 * 60,
        default_ttl_dynamic=5 * 60,
        persistent_cache_dir="./cache_data"
    )
    
    # –ü—Ä–∏–º–µ—Ä 1: –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏
    @cached(ttl=300, data_type='stable')
    def get_catalog_structure(catalog_name):
        print(f"–ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ {catalog_name}...")
        time.sleep(1)  # –ò–º–∏—Ç–∞—Ü–∏—è –¥–æ–ª–≥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
        return {"fields": ["id", "name", "date"], "count": 1000}
    
    # –ü–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤ - –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è
    structure1 = get_catalog_structure("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏")
    print(f"–†–µ–∑—É–ª—å—Ç–∞—Ç 1: {structure1}")
    
    # –í—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤ - –∏–∑ –∫—ç—à–∞
    structure2 = get_catalog_structure("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏")
    print(f"–†–µ–∑—É–ª—å—Ç–∞—Ç 2: {structure2}")
    
    # –ü—Ä–∏–º–µ—Ä 2: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ MCP tool
    tool_name = "get_nomenclature"
    args = {"id": 123, "include_properties": True}
    result = {"nomenclature": "–¢–æ–≤–∞—Ä 1", "properties": {"weight": 1.5}}
    
    cache_tool_result(tool_name, args, result)
    cached_result = get_cached_tool_result(tool_name, args)
    print(f"–ó–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {cached_result}")
    
    # –ü—Ä–∏–º–µ—Ä 3: –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ 1–°
    metadata = {
        "type": "—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫",
        "hierarchical": True,
        "has_owners": False,
        "fields": ["–ö–æ–¥", "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ", "–î–∞—Ç–∞–°–æ–∑–¥–∞–Ω–∏—è"]
    }
    
    cache_metadata_1c("catalog", "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏", metadata)
    cached_metadata = get_cached_metadata_1c("catalog", "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏")
    print(f"–ó–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: {cached_metadata}")
    
    # –ü—Ä–∏–º–µ—Ä 4: –ê–≥—Ä–µ–≥–∞—Ç—ã
    aggregates = [
        {"period": "2024-01", "sales": 100000, "count": 100},
        {"period": "2024-02", "sales": 120000, "count": 120}
    ]
    
    cache_aggregates("monthly_sales", "2024-Q1", {"region": "Moscow"}, aggregates)
    cached_aggregates = get_cached_aggregates("monthly_sales", "2024-Q1", {"region": "Moscow"})
    print(f"–ó–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã: {cached_aggregates}")
    
    # –ü—Ä–∏–º–µ—Ä 5: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    stats = get_cache_stats()
    print(f"\n–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞:")
    for key, value in stats.items():
        print(f"  {key}: {value}")

if __name__ == "__main__":
    asyncio.run(main())
```

### –ü—Ä–∏–º–µ—Ä —Å –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

```python
from cache import get_cache, init_cache

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
cache = init_cache(max_size_mb=10)

# –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
cache.set("metadata:catalog:users", {"type": "—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫"})
cache.set("metadata:catalog:organizations", {"type": "—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫"})
cache.set("aggregates:sales:2024-01", [{"value": 1000}])

print(f"–ó–∞–ø–∏—Å–µ–π –¥–æ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏: {cache.size()}")  # 3

# –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–æ —à–∞–±–ª–æ–Ω—É
invalidation = cache.invalidation
count = invalidation.invalidate_by_pattern(cache, "metadata:*")

print(f"–ò–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–æ –∑–∞–ø–∏—Å–µ–π: {count}")  # 2
print(f"–ó–∞–ø–∏—Å–µ–π –ø–æ—Å–ª–µ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏: {cache.size()}")  # 1

# –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –≤—Å—ë
invalidation.invalidate_all(cache)
print(f"–ó–∞–ø–∏—Å–µ–π –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏: {cache.size()}")  # 0
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
python -m unittest tests.test_mcp_cache -v

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
python -m unittest tests.test_mcp_cache.TestMCPToolsCache.test_basic_operations -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
python -m pytest tests/test_mcp_cache.py -v --cov=cache.mcp_cache
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

- **TestCacheEntry** - —Ç–µ—Å—Ç—ã –∑–∞–ø–∏—Å–µ–π –∫—ç—à–∞
- **TestCacheMetrics** - —Ç–µ—Å—Ç—ã –º–µ—Ç—Ä–∏–∫
- **TestCacheStrategy** - —Ç–µ—Å—Ç—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è
- **TestCacheInvalidation** - —Ç–µ—Å—Ç—ã –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏
- **TestPersistentCache** - —Ç–µ—Å—Ç—ã persistent cache
- **TestMCPToolsCache** - –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã –∫—ç—à–∞
- **TestAsyncOperations** - —Ç–µ—Å—Ç—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **TestDecorator** - —Ç–µ—Å—Ç—ã –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤
- **TestSpecializedCacheFunctions** - —Ç–µ—Å—Ç—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- **TestCacheStatistics** - —Ç–µ—Å—Ç—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- **TestEdgeCases** - —Ç–µ—Å—Ç—ã –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤

### –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

```python
import unittest
from cache import init_cache, get_cache

class TestMyIntegration(unittest.TestCase):
    def setUp(self):
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º
        init_cache(max_size_mb=10)
    
    def test_my_cache_usage(self):
        cache = get_cache()
        
        # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
        result = cache.set("test", "value")
        self.assertTrue(result)
        
        value = cache.get("test")
        self.assertEqual(value, "value")
```

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–∂–∏–¥–∞–µ–º—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ë–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ | –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ |
|---------|------------------|-------------------|
| Hit Ratio | 0% | 80-95% |
| –°—Ä–µ–¥–Ω—è—è –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å | 100-500ms | 5-20ms |
| –°—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–æ–≤ | 100% | 60-80% (—Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π JSON) |
| –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î | 100% | 20-40% |
| –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å | 1x | 3-5x |

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```python
# –î–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
cache = init_cache(
    max_size_mb=500,                    # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä
    default_ttl_stable=60 * 60,         # 1 —á–∞—Å –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    default_ttl_dynamic=10 * 60,        # 10 –º–∏–Ω—É—Ç –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö
    persistent_cache_dir="/fast_ssd/cache",  # –ë—ã—Å—Ç—Ä–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
    strategy=TTLCacheStrategy()         # TTL —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
)

# –î–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏
cache = init_cache(
    max_size_mb=50,                     # –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä
    default_ttl_stable=15 * 60,         # 15 –º–∏–Ω—É—Ç
    default_ttl_dynamic=2 * 60,         # 2 –º–∏–Ω—É—Ç—ã
    persistent_cache_dir=None,          # –¢–æ–ª—å–∫–æ –ø–∞–º—è—Ç—å
    strategy=LRUStrategy()              # LRU —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
)
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```python
import time
from cache import get_cache

def benchmark_cache_operations():
    cache = get_cache()
    
    # –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏
    start_time = time.time()
    for i in range(1000):
        cache.set(f"key_{i}", f"value_{i}")
    write_time = time.time() - start_time
    
    # –¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è
    start_time = time.time()
    for i in range(1000):
        cache.get(f"key_{i}")
    read_time = time.time() - start_time
    
    print(f"–í—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ 1000 –∑–∞–ø–∏—Å–µ–π: {write_time:.3f}s")
    print(f"–í—Ä–µ–º—è —á—Ç–µ–Ω–∏—è 1000 –∑–∞–ø–∏—Å–µ–π: {read_time:.3f}s")
    print(f"–í—Ä–µ–º—è –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é –∑–∞–ø–∏—Å–∏: {write_time*1000/1000:.3f}ms")
    print(f"–í—Ä–µ–º—è –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é —á—Ç–µ–Ω–∏—è: {read_time*1000/1000:.3f}ms")
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –í–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```python
import logging

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—ç—à–∞
cache_logger = logging.getLogger('cache.mcp_cache')
cache_logger.setLevel(logging.DEBUG)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫—ç—à–∞

```python
from cache.integration_examples import CacheManager

def debug_cache_state():
    cache_manager = CacheManager()
    stats = cache_manager.get_detailed_stats()
    
    print("=== –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫—ç—à–∞ ===")
    print(f"–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: {stats['total_entries']}")
    print(f"–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: {stats['memory_usage_mb']:.2f} MB")
    print(f"Hit ratio: {stats['hit_ratio']:.2%}")
    
    print("\n=== –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º ===")
    for data_type, count in stats['cache_distribution'].items():
        print(f"{data_type}: {count}")
    
    print("\n=== –ò—Å—Ç—ë–∫—à–∏–µ –∑–∞–ø–∏—Å–∏ ===")
    print(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {stats['expired_entries_count']}")
    
    print("\n=== –¢–æ–ø –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ ===")
    for tool in stats['top_cached_tools'][:5]:
        print(f"{tool['tool_name']}: {tool['access_count']} –¥–æ—Å—Ç—É–ø–æ–≤")
```

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—ç—à–∞

```python
# –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
def get_versioned_cache_key(key, version="v1"):
    return f"{version}:{key}"

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
cache_key = get_versioned_cache_key("user_data", "v2")
cache.set(cache_key, new_format_data)
```

### –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –∫—ç—à–∞

```python
async def migrate_cache():
    """–ú–∏–≥—Ä–∞—Ü–∏—è –∫—ç—à–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏"""
    old_cache = get_cache()
    
    # –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π –∫—ç—à —Å –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π
    new_cache = init_cache(persistent_cache_dir="./cache_v2")
    
    # –ü–µ—Ä–µ–Ω–æ—Å–∏–º —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ
    for key, entry in old_cache._cache.items():
        if not entry.is_expired:
            new_key = f"v2:{key}"
            new_cache.set(new_key, entry.data, ttl=entry.ttl, 
                         data_type=determine_data_type(key))
    
    print("–ú–∏–≥—Ä–∞—Ü–∏—è –∫—ç—à–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞")
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [–°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è 1–°](docs/1c_caching_standards.md)
- [–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ MCP](docs/1c_mcp_performance/1c_mcp_performance_bottlenecks.md)

### –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å mcp_server.py](cache/integration_examples.py)
- [–¢–µ—Å—Ç—ã –º–æ–¥—É–ª—è](tests/test_mcp_cache.py)

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ë–∞–∑–æ–≤–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: < 1ms –¥–ª—è –∫—ç—à-–ø–æ–ø–∞–¥–∞–Ω–∏–π
- –ü–∞–º—è—Ç—å: ~1KB –Ω–∞ –∑–∞–ø–∏—Å—å (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö)
- –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: 10,000+ –æ–ø–µ—Ä–∞—Ü–∏–π/—Å–µ–∫

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ú–æ–¥—É–ª—å —Å–æ–∑–¥–∞–Ω –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ 1C MCP Server.
–í–µ—Ä—Å–∏—è: 1.0.0
