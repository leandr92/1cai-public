# Makefile –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è 1–°:Enterprise
# –û—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞—Ö —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ docs/1c_testing_standards.md
#
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
#   make help              - –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É –ø–æ –∫–æ–º–∞–Ω–¥–∞–º
#   make test              - –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
#   make test-unit         - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã
#   make test-integration  - –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
#   make lint              - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
#   make build             - –°–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
#   make deploy            - –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

# ===============================
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
# ===============================

# –ü—Ä–æ–µ–∫—Ç –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
PROJECT_NAME := 1c-enterprise-tests
PYTHON_VERSION := 3.11
PIP := python3.11 -m pip
PYTEST := python3.11 -m pytest
BLACK := python3.11 -m black
FLAKE8 := python3.11 -m flake8
ISORT := python3.11 -m isort
BANDIT := python3.11 -m bandit

# –ü—É—Ç–∏ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
SRC_DIR := src
TESTS_DIR := tests
BUILD_DIR := build
REPORTS_DIR := reports
SCRIPTS_DIR := scripts
DOCKER_DIR := docker
DOCS_DIR := docs

# 1–° –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
V8_VERSION := 8.3.22
V8_PLATFORM := linux64
V8_SERVER_URL ?= http://localhost
V8_USER ?= test_user
V8_PASSWORD ?= test_password

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
TEST_TIMEOUT := 1800
MAX_WORKERS := 4
COVERAGE_THRESHOLD := 80
PARALLEL_TESTS := true

# Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
DOCKER_IMAGE := $(PROJECT_NAME):latest
DOCKER_REGISTRY ?= ghcr.io
DOCKER_TAG ?= $(shell git rev-parse --short HEAD)

# –°–±–æ—Ä–∫–∞
BUILD_NUMBER ?= $(shell date +%Y%m%d-%H%M%S)
COMMIT_HASH := $(shell git rev-parse --short HEAD 2>/dev/null || echo "unknown")
BRANCH_NAME := $(shell git branch --show-current 2>/dev/null || echo "unknown")

# –û—Ç—á–µ—Ç—ã
REPORT_FORMAT := html
COVERAGE_FORMAT := html
TEST_REPORT_NAME := test-results-$(BUILD_NUMBER)
COVERAGE_REPORT_NAME := coverage-report-$(BUILD_NUMBER)

# ===============================
# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
# ===============================

BOLD := \033[1m
RED := \033[31m
GREEN := \033[32m
YELLOW := \033[33m
BLUE := \033[34m
MAGENTA := \033[35m
CYAN := \033[36m
RESET := \033[0m

# ===============================
# –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–ª–∏
# ===============================

# –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º
.PHONY: help
help: ## –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É –ø–æ –∫–æ–º–∞–Ω–¥–∞–º Makefile
	@echo "$(BOLD)–°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è 1–°:Enterprise$(RESET)"
	@echo "$(CYAN)–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:$(RESET)"
	@echo ""
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | \
		awk 'BEGIN {FS = ":.*?## "}; {printf "$(GREEN)%-20s$(RESET) %s\n", $$1, $$2}'
	@echo ""
	@echo "$(YELLOW)–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:$(RESET)"
	@echo "  make test                    # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã"
	@echo "  make test-unit               # –¢–æ–ª—å–∫–æ —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã"
	@echo "  make lint                    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞"
	@echo "  make build                   # –°–±–æ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"
	@echo "  make docker-build           # –°–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑"
	@echo "  make deploy-dev             # –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤ development"

# ===============================
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
# ===============================

.PHONY: setup
setup: ## –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
	@echo "$(BOLD)üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è$(RESET)"
	@make create-dirs
	@make install-deps
	@make setup-git-hooks
	@make create-test-configs
	@echo "$(GREEN)‚úÖ –û–∫—Ä—É–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ$(RESET)"

.PHONY: create-dirs
create-dirs: ## –°–æ–∑–¥–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
	@echo "$(BLUE)üìÅ –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π...$(RESET)"
	@mkdir -p $(BUILD_DIR)/compiled
	@mkdir -p $(BUILD_DIR)/distribution
	@mkdir -p $(BUILD_DIR)/updates
	@mkdir -p $(REPORTS_DIR)/test-results
	@mkdir -p $(REPORTS_DIR)/coverage
	@mkdir -p $(REPORTS_DIR)/quality
	@mkdir -p $(REPORTS_DIR)/performance
	@mkdir -p $(REPORTS_DIR)/security
	@mkdir -p logs/
	@mkdir -p tmp/
	@echo "$(GREEN)‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ–∑–¥–∞–Ω—ã$(RESET)"

.PHONY: install-deps
install-deps: ## –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
	@echo "$(BLUE)üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...$(RESET)"
	@$(PIP) install --upgrade pip
	@$(PIP) install -r requirements.txt
	@echo "$(GREEN)‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã$(RESET)"

.PHONY: setup-git-hooks
setup-git-hooks: ## –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Git hooks –¥–ª—è –ø—Ä–µ–¥–∫–æ–º–º–∏—Ç–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
	@echo "$(BLUE)ü™ù –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Git hooks...$(RESET)"
	@cp .git-hooks/pre-commit .git/hooks/pre-commit 2>/dev/null || true
	@chmod +x .git/hooks/pre-commit 2>/dev/null || true
	@echo "$(GREEN)‚úÖ Git hooks –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã$(RESET)"

.PHONY: create-test-configs
create-test-configs: ## –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤
	@echo "$(BLUE)‚öôÔ∏è –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π...$(RESET)"
	@python3 $(SCRIPTS_DIR)/create_test_configs.py
	@echo "$(GREEN)‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã$(RESET)"

# ===============================
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
# ===============================

.PHONY: test
test: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã (–ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª)
	@echo "$(BOLD)üß™ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è$(RESET)"
	@make test-unit
	@make test-integration
	@make test-performance
	@make test-security
	@make generate-reports
	@echo "$(GREEN)üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã$(RESET)"

.PHONY: test-unit
test-unit: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã (xUnitFor1C)
	@echo "$(BOLD)üß™ –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (xUnitFor1C)$(RESET)"
	@make create-dirs
	@$(PYTEST) $(TESTS_DIR)/unit/ \
		-v \
		--timeout=$(TEST_TIMEOUT) \
		--maxfail=5 \
		--cov=$(SRC_DIR) \
		--cov-report=$(COVERAGE_FORMAT):$(REPORTS_DIR)/coverage/$(COVERAGE_REPORT_NAME) \
		--cov-report=xml:$(REPORTS_DIR)/coverage/coverage.xml \
		--html=$(REPORTS_DIR)/test-results/$(TEST_REPORT_NAME)-unit.html \
		--json-report --json-report-file=$(REPORTS_DIR)/test-results/unit-tests.json \
		--junitxml=$(REPORTS_DIR)/test-results/unit-tests.xml \
		$(if $(PARALLEL_TESTS),-n $(MAX_WORKERS),) \
		|| echo "$(RED)‚ùå –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã —Å –æ—à–∏–±–∫–∞–º–∏$(RESET)"

.PHONY: test-integration
test-integration: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
	@echo "$(BOLD)üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ$(RESET)"
	@make create-dirs
	@$(PYTEST) $(TESTS_DIR)/integration/ \
		-v \
		--timeout=$(TEST_TIMEOUT) \
		--maxfail=3 \
		--html=$(REPORTS_DIR)/test-results/$(TEST_REPORT_NAME)-integration.html \
		--json-report --json-report-file=$(REPORTS_DIR)/test-results/integration-tests.json \
		--junitxml=$(REPORTS_DIR)/test-results/integration-tests.xml \
		$(if $(PARALLEL_TESTS),-n $(MAX_WORKERS),) \
		|| echo "$(YELLOW)‚ö†Ô∏è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è$(RESET)"

.PHONY: test-performance
test-performance: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
	@echo "$(BOLD)‚ö° –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏$(RESET)"
	@make create-dirs
	@$(PYTEST) $(TESTS_DIR)/performance/ \
		-v \
		--timeout=3600 \
		--html=$(REPORTS_DIR)/test-results/$(TEST_REPORT_NAME)-performance.html \
		--json-report --json-report-file=$(REPORTS_DIR)/test-results/performance-tests.json \
		--junitxml=$(REPORTS_DIR)/test-results/performance-tests.xml \
		|| echo "$(YELLOW)‚ö†Ô∏è –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–µ –ø—Ä–æ–π–¥–µ–Ω—ã$(RESET)"

.PHONY: test-security
test-security: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
	@echo "$(BOLD)üîí –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏$(RESET)"
	@make create-dirs
	@$(PYTEST) $(TESTS_DIR)/security/ \
		-v \
		--timeout=$(TEST_TIMEOUT) \
		--html=$(REPORTS_DIR)/test-results/$(TEST_REPORT_NAME)-security.html \
		--json-report --json-report-file=$(REPORTS_DIR)/test-results/security-tests.json \
		--junitxml=$(REPORTS_DIR)/test-results/security-tests.xml \
		|| echo "$(YELLOW)‚ö†Ô∏è –ù–∞–π–¥–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏$(RESET)"

.PHONY: test-e2e
test-e2e: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å End-to-End —Ç–µ—Å—Ç—ã (Vanessa-automation)
	@echo "$(BOLD)üé≠ End-to-End —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ$(RESET)"
	@make create-dirs
	@python3 $(SCRIPTS_DIR)/run_vanessa_tests.py \
		--features=$(TESTS_DIR)/e2e/ \
		--output=$(REPORTS_DIR)/test-results/e2e-tests.html \
		--format=html || echo "$(YELLOW)‚ö†Ô∏è E2E —Ç–µ—Å—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è$(RESET)"

.PHONY: test-smoke
test-smoke: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å smoke-—Ç–µ—Å—Ç—ã (–±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)
	@echo "$(BOLD)üí® Smoke-—Ç–µ—Å—Ç—ã (–±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)$(RESET)"
	@$(PYTEST) $(TESTS_DIR)/smoke/ \
		-v \
		--timeout=300 \
		--html=$(REPORTS_DIR)/test-results/smoke-tests.html \
		--junitxml=$(REPORTS_DIR)/test-results/smoke-tests.xml \
		|| echo "$(RED)‚ùå Smoke-—Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ–π–¥–µ–Ω—ã$(RESET)"

.PHONY: test-specific
test-specific: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: make test-specific TEST=tests/unit/test_calc.py::test_calculate)
	@echo "$(BOLD)üéØ –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞: $(TEST)$(RESET)"
	@$(PYTEST) $(TEST) -v --timeout=$(TEST_TIMEOUT) || echo "$(RED)‚ùå –¢–µ—Å—Ç –Ω–µ –ø—Ä–æ–π–¥–µ–Ω$(RESET)"

# ===============================
# –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ –∏ –∞–Ω–∞–ª–∏–∑
# ===============================

.PHONY: lint
lint: lint-flake8 lint-black lint-isort lint-bandit lint-security ## –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞

.PHONY: lint-flake8
lint-flake8: ## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ —Å –ø–æ–º–æ—â—å—é flake8
	@echo "$(BLUE)üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ —Å flake8...$(RESET)"
	@$(FLAKE8) $(SRC_DIR) $(TESTS_DIR) \
		--max-line-length=120 \
		--ignore=E501,W503,E203 \
		--exclude=__pycache__,*.pyc \
		--output-file=$(REPORTS_DIR)/quality/flake8-report.txt || true
	@echo "$(GREEN)‚úÖ Flake8 –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞$(RESET)"

.PHONY: lint-black
lint-black: ## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å –ø–æ–º–æ—â—å—é black
	@echo "$(BLUE)‚ú® –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å black...$(RESET)"
	@$(BLACK) --check --diff $(SRC_DIR) $(TESTS_DIR) \
		--line-length=120 || echo "$(YELLOW)‚ö†Ô∏è –ö–æ–¥ –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏$(RESET)"
	@echo "$(GREEN)‚úÖ Black –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞$(RESET)"

.PHONY: lint-isort
lint-isort: ## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é isort
	@echo "$(BLUE)üì¶ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ —Å isort...$(RESET)"
	@$(ISORT) --check-only --diff $(SRC_DIR) $(TESTS_DIR) || echo "$(YELLOW)‚ö†Ô∏è –ò–º–ø–æ—Ä—Ç—ã –Ω—É–∂–¥–∞—é—Ç—Å—è –≤ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ$(RESET)"
	@echo "$(GREEN)‚úÖ Isort –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞$(RESET)"

.PHONY: lint-bandit
lint-bandit: ## –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å –ø–æ–º–æ—â—å—é bandit
	@echo "$(BLUE)üîí –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å bandit...$(RESET)"
	@$(BANDIT) -r $(SRC_DIR) \
		-f json \
		-o $(REPORTS_DIR)/quality/bandit-report.json \
		|| echo "$(YELLOW)‚ö†Ô∏è –ù–∞–π–¥–µ–Ω—ã –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏$(RESET)"
	@echo "$(GREEN)‚úÖ Bandit –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω$(RESET)"

.PHONY: lint-security
lint-security: ## –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
	@echo "$(BLUE)üîí –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏...$(RESET)"
	@$(PIP) install safety 2>/dev/null || true
	@safety check --json --output $(REPORTS_DIR)/quality/safety-report.json || echo "$(YELLOW)‚ö†Ô∏è –ù–∞–π–¥–µ–Ω—ã —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö$(RESET)"
	@echo "$(GREEN)‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∞$(RESET)"

.PHONY: lint-mypy
lint-mypy: ## –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å –ø–æ–º–æ—â—å—é mypy
	@echo "$(BLUE)üîç –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å mypy...$(RESET)"
	@python3.11 -m mypy $(SRC_DIR) \
		--ignore-missing-imports \
		--no-error-summary \
		--output-text $(REPORTS_DIR)/quality/mypy-report.txt || echo "$(YELLOW)‚ö†Ô∏è –ù–∞–π–¥–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Ç–∏–ø–∏–∑–∞—Ü–∏–∏$(RESET)"
	@echo "$(GREEN)‚úÖ Mypy –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω$(RESET)"

.PHONY: lint-complexity
lint-complexity: ## –ê–Ω–∞–ª–∏–∑ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞
	@echo "$(BLUE)üß† –ê–Ω–∞–ª–∏–∑ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞...$(RESET)"
	@$(PIP) install radon xenon 2>/dev/null || true
	@radon cc $(SRC_DIR) --min B \
		--show-complexity \
		--average \
		> $(REPORTS_DIR)/quality/complexity-report.txt || true
	@xenon $(SRC_DIR) --max-absolute B \
		--max-modules B \
		--max-average A \
		--exclude tests/ \
		> $(REPORTS_DIR)/quality/xenon-report.txt || true
	@echo "$(GREEN)‚úÖ –ê–Ω–∞–ª–∏–∑ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω$(RESET)"

# ===============================
# –°–±–æ—Ä–∫–∞ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
# ===============================

.PHONY: build
build: build-configuration build-package ## –°–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ –ø–∞–∫–µ—Ç

.PHONY: build-configuration
build-configuration: ## –°–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é 1–°
	@echo "$(BOLD)üèóÔ∏è –°–±–æ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ 1–°$(RESET)"
	@make create-dirs
	@python3 $(SCRIPTS_DIR)/build_1c_configuration.py \
		--source $(SRC_DIR) \
		--output $(BUILD_DIR)/compiled/ \
		--version $(V8_VERSION) \
		--platform $(V8_PLATFORM) || echo "$(RED)‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏$(RESET)"
	@echo "$(GREEN)‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ–±—Ä–∞–Ω–∞$(RESET)"

.PHONY: build-package
build-package: ## –°–æ–∑–¥–∞—Ç—å –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–Ω—ã–π –ø–∞–∫–µ—Ç
	@echo "$(BOLD)üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞$(RESET)"
	@python3 $(SCRIPTS_DIR)/create_distribution.py \
		--source $(BUILD_DIR)/compiled/ \
		--output $(BUILD_DIR)/distribution/ \
		--build-number $(BUILD_NUMBER) \
		--commit-hash $(COMMIT_HASH) || echo "$(RED)‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–∞–∫–µ—Ç–∞$(RESET)"
	@echo "$(GREEN)‚úÖ –ü–∞–∫–µ—Ç —Å–æ–∑–¥–∞–Ω$(RESET)"

.PHONY: build-update
build-update: ## –°–æ–∑–¥–∞—Ç—å –ø–∞–∫–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
	@echo "$(BOLD)üîÑ –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è$(RESET)"
	@python3 $(SCRIPTS_DIR)/create_update.py \
		--previous-version $(shell git describe --tags --abbrev=0 2>/dev/null || echo "") \
		--current-version $(COMMIT_HASH) \
		--output $(BUILD_DIR)/updates/ || echo "$(YELLOW)‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø–∞–∫–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è$(RESET)"
	@echo "$(GREEN)‚úÖ –ü–∞–∫–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω$(RESET)"

# ===============================
# Docker –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
# ===============================

.PHONY: docker-build
docker-build: ## –°–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
	@echo "$(BOLD)üê≥ –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞$(RESET)"
	@docker build \
		-f Dockerfile.test \
		--target base \
		-t $(DOCKER_IMAGE) \
		--build-arg V8_VERSION=$(V8_VERSION) \
		. || echo "$(RED)‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ Docker –æ–±—Ä–∞–∑–∞$(RESET)"
	@echo "$(GREEN)‚úÖ Docker –æ–±—Ä–∞–∑ —Å–æ–±—Ä–∞–Ω: $(DOCKER_IMAGE)$(RESET)"

.PHONY: docker-build-dev
docker-build-dev: ## –°–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
	@echo "$(BOLD)üê≥ –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏$(RESET)"
	@docker build \
		-f Dockerfile.test \
		--target development \
		-t $(PROJECT_NAME):dev \
		. || echo "$(RED)‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ Docker –æ–±—Ä–∞–∑–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏$(RESET)"
	@echo "$(GREEN)‚úÖ Docker –æ–±—Ä–∞–∑ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—Ä–∞–Ω$(RESET)"

.PHONY: docker-test
docker-test: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
	@echo "$(BOLD)üê≥ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ Docker$(RESET)"
	@docker run --rm \
		-v $(PWD):/workspace \
		-v $(REPORTS_DIR):/workspace/reports \
		-e V8_SERVER_URL=$(V8_SERVER_URL) \
		-e V8_USER=$(V8_USER) \
		-e V8_PASSWORD=$(V8_PASSWORD) \
		$(DOCKER_IMAGE) \
		make test || echo "$(RED)‚ùå –¢–µ—Å—Ç—ã –≤ Docker –∑–∞–≤–µ—Ä—à–µ–Ω—ã —Å –æ—à–∏–±–∫–∞–º–∏$(RESET)"

.PHONY: docker-push
docker-push: ## –û—Ç–ø—Ä–∞–≤–∏—Ç—å Docker –æ–±—Ä–∞–∑ –≤ —Ä–µ–≥–∏—Å—Ç—Ä
	@echo "$(BOLD)üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ Docker –æ–±—Ä–∞–∑–∞ –≤ —Ä–µ–≥–∏—Å—Ç—Ä$(RESET)"
	@docker tag $(DOCKER_IMAGE) $(DOCKER_REGISTRY)/$(DOCKER_IMAGE):$(DOCKER_TAG)
	@docker push $(DOCKER_REGISTRY)/$(DOCKER_IMAGE):$(DOCKER_TAG) || echo "$(RED)‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ–±—Ä–∞–∑–∞$(RESET)"
	@echo "$(GREEN)‚úÖ Docker –æ–±—Ä–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω$(RESET)"

# ===============================
# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
# ===============================

.PHONY: deploy
deploy: deploy-dev ## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤–æ –≤—Å–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

.PHONY: deploy-dev
deploy-dev: ## –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–µ Development
	@echo "$(BOLD)üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Development$(RESET)"
	@python3 $(SCRIPTS_DIR)/deploy.py \
		--environment development \
		--source $(BUILD_DIR)/distribution/ \
		--server-url $(V8_SERVER_URL) \
		--user $(V8_USER) \
		--password $(V8_PASSWORD) \
		--timeout 300 || echo "$(RED)‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏ –≤ Development$(RESET)"
	@make test-smoke
	@echo "$(GREEN)‚úÖ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Development –∑–∞–≤–µ—Ä—à–µ–Ω–æ$(RESET)"

.PHONY: deploy-staging
deploy-staging: ## –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–µ Staging
	@echo "$(BOLD)üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Staging$(RESET)"
	@python3 $(SCRIPTS_DIR)/deploy.py \
		--environment staging \
		--source $(BUILD_DIR)/distribution/ \
		--server-url $(V8_SERVER_URL) \
		--user $(V8_USER) \
		--password $(V8_PASSWORD) \
		--timeout 600 || echo "$(RED)‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏ –≤ Staging$(RESET)"
	@make test
	@echo "$(GREEN)‚úÖ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Staging –∑–∞–≤–µ—Ä—à–µ–Ω–æ$(RESET)"

.PHONY: deploy-prod
deploy-prod: ## –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤ Production (–í–ù–ò–ú–ê–ù–ò–ï!)
	@echo "$(RED)üö® –í–ù–ò–ú–ê–ù–ò–ï: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Production!$(RESET)"
	@read -p "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Production (yes/no): " confirm && \
	[ "$$confirm" = "yes" ] || (echo "$(RED)–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ$(RESET)" && exit 1)
	@python3 $(SCRIPTS_DIR)/deploy.py \
		--environment production \
		--source $(BUILD_DIR)/distribution/ \
		--server-url $(V8_SERVER_URL) \
		--user $(V8_USER) \
		--password $(V8_PASSWORD) \
		--timeout 900 || echo "$(RED)‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏ –≤ Production$(RESET)"
	@make test-smoke
	@echo "$(GREEN)‚úÖ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Production –∑–∞–≤–µ—Ä—à–µ–Ω–æ$(RESET)"

# ===============================
# –û—Ç—á–µ—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
# ===============================

.PHONY: generate-reports
generate-reports: ## –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤
	@echo "$(BOLD)üìä –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤$(RESET)"
	@python3 $(SCRIPTS_DIR)/generate_reports.py \
		--input $(REPORTS_DIR) \
		--output $(REPORTS_DIR)/final \
		--format $(REPORT_FORMAT) \
		--coverage-threshold $(COVERAGE_THRESHOLD) || echo "$(YELLOW)‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –æ—Ç—á–µ—Ç—ã –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã$(RESET)"
	@echo "$(GREEN)‚úÖ –û—Ç—á–µ—Ç—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã$(RESET)"

.PHONY: report-coverage
report-coverage: ## –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –æ –ø–æ–∫—Ä—ã—Ç–∏–∏
	@echo "$(BOLD)üìà –û—Ç—á–µ—Ç –æ –ø–æ–∫—Ä—ã—Ç–∏–∏ –∫–æ–¥–∞$(RESET)"
	@$(PYTEST) --cov=$(SRC_DIR) --cov-report=html:$(REPORTS_DIR)/coverage/html \
		--cov-report=xml:$(REPORTS_DIR)/coverage/coverage.xml \
		--cov-report=term $(TESTS_DIR)/unit/ --no-header -q
	@echo "$(GREEN)‚úÖ –û—Ç—á–µ—Ç –æ –ø–æ–∫—Ä—ã—Ç–∏–∏ —Å–æ–∑–¥–∞–Ω: $(REPORTS_DIR)/coverage/html/index.html$(RESET)"

.PHONY: report-performance
report-performance: ## –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
	@echo "$(BOLD)‚ö° –û—Ç—á–µ—Ç –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏$(RESET)"
	@python3 $(SCRIPTS_DIR)/performance_analyzer.py \
		--input $(REPORTS_DIR)/test-results/performance-tests.json \
		--output $(REPORTS_DIR)/performance/performance-analysis.html \
		--format html || echo "$(YELLOW)‚ö†Ô∏è –û—Ç—á–µ—Ç –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–µ —Å–æ–∑–¥–∞–Ω$(RESET)"
	@echo "$(GREEN)‚úÖ –û—Ç—á–µ—Ç –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–Ω$(RESET)"

.PHONY: report-quality
report-quality: ## –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –æ –∫–∞—á–µ—Å—Ç–≤–µ –∫–æ–¥–∞
	@echo "$(BOLD)üîç –û—Ç—á–µ—Ç –æ –∫–∞—á–µ—Å—Ç–≤–µ –∫–æ–¥–∞$(RESET)"
	@python3 $(SCRIPTS_DIR)/quality_analyzer.py \
		--input $(REPORTS_DIR)/quality/ \
		--output $(REPORTS_DIR)/quality/quality-report.html \
		--format html || echo "$(YELLOW)‚ö†Ô∏è –û—Ç—á–µ—Ç –æ –∫–∞—á–µ—Å—Ç–≤–µ –Ω–µ —Å–æ–∑–¥–∞–Ω$(RESET)"
	@echo "$(GREEN)‚úÖ –û—Ç—á–µ—Ç –æ –∫–∞—á–µ—Å—Ç–≤–µ —Å–æ–∑–¥–∞–Ω$(RESET)"

# ===============================
# –û—á–∏—Å—Ç–∫–∞ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
# ===============================

.PHONY: clean
clean: clean-reports clean-builds clean-cache ## –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

.PHONY: clean-reports
clean-reports: ## –û—á–∏—Å—Ç–∏—Ç—å –æ—Ç—á–µ—Ç—ã
	@echo "$(BLUE)üßπ –û—á–∏—Å—Ç–∫–∞ –æ—Ç—á–µ—Ç–æ–≤...$(RESET)"
	@rm -rf $(REPORTS_DIR)/*
	@rm -rf logs/*
	@rm -rf tmp/*
	@echo "$(GREEN)‚úÖ –û—Ç—á–µ—Ç—ã –æ—á–∏—â–µ–Ω—ã$(RESET)"

.PHONY: clean-builds
clean-builds: ## –û—á–∏—Å—Ç–∏—Ç—å —Å–±–æ—Ä–∫–∏
	@echo "$(BLUE)üßπ –û—á–∏—Å—Ç–∫–∞ —Å–±–æ—Ä–æ–∫...$(RESET)"
	@rm -rf $(BUILD_DIR)/*
	@rm -rf __pycache__/ 2>/dev/null || true
	@find . -name "*.pyc" -delete 2>/dev/null || true
	@find . -name "__pycache__" -type d -exec rm -rf {} + 2>/dev/null || true
	@echo "$(GREEN)‚úÖ –°–±–æ—Ä–∫–∏ –æ—á–∏—â–µ–Ω—ã$(RESET)"

.PHONY: clean-cache
clean-cache: ## –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à–∏
	@echo "$(BLUE)üßπ –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–µ–π...$(RESET)"
	@rm -rf .pytest_cache/ 2>/dev/null || true
	@rm -rf .coverage 2>/dev/null || true
	@rm -rf htmlcov/ 2>/dev/null || true
	@rm -rf .mypy_cache/ 2>/dev/null || true
	@docker system prune -f 2>/dev/null || true
	@echo "$(GREEN)‚úÖ –ö—ç—à–∏ –æ—á–∏—â–µ–Ω—ã$(RESET)"

.PHONY: clean-all
clean-all: clean ## –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–≤–∫–ª—é—á–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
	@echo "$(BLUE)üßπ –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞...$(RESET)"
	@$(PIP) freeze | xargs $(PIP) uninstall -y 2>/dev/null || true
	@docker rmi $(DOCKER_IMAGE) 2>/dev/null || true
	@docker rmi $(PROJECT_NAME):dev 2>/dev/null || true
	@echo "$(GREEN)‚úÖ –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞$(RESET)"

# ===============================
# CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
# ===============================

.PHONY: ci
ci: lint test-unit build ## –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è CI/CD —Å–∏—Å—Ç–µ–º
	@echo "$(GREEN)‚úÖ CI/CD –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã$(RESET)"

.PHONY: ci-full
ci-full: lint test build-quality ## –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è CI/CD
	@echo "$(GREEN)‚úÖ –ü–æ–ª–Ω—ã–µ CI/CD –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã$(RESET)"

.PHONY: build-quality
build-quality: ## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–±–æ—Ä–∫–∏
	@echo "$(BOLD)üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–±–æ—Ä–∫–∏$(RESET)"
	@python3 $(SCRIPTS_DIR)/quality_gate_check.py \
		--build-dir $(BUILD_DIR) \
		--coverage-threshold $(COVERAGE_THRESHOLD) || echo "$(RED)‚ùå Quality Gate –Ω–µ –ø—Ä–æ–π–¥–µ–Ω$(RESET)"

# ===============================
# –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
# ===============================

.PHONY: watch-tests
watch-tests: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –≤ —Ä–µ–∂–∏–º–µ watch (–∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö)
	@echo "$(BOLD)üëÄ –†–µ–∂–∏–º watch –¥–ª—è —Ç–µ—Å—Ç–æ–≤$(RESET)"
	@$(PIP) install pytest-watch 2>/dev/null || true
	@ptw $(TESTS_DIR) --runner="$(PYTEST) -v" || echo "$(YELLOW)‚ö†Ô∏è Watch —Ç–µ—Å—Ç—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã$(RESET)"

.PHONY: debug-test
debug-test: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
	@echo "$(BOLD)üêõ –û—Ç–ª–∞–¥–æ—á–Ω—ã–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞$(RESET)"
	@$(PIP) install ipdb 2>/dev/null || true
	@$(PYTEST) $(TEST) -v -s --pdb || echo "$(RED)‚ùå –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω —Å –æ—à–∏–±–∫–∞–º–∏$(RESET)"

.PHONY: benchmark
benchmark: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–µ–Ω—á–º–∞—Ä–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
	@echo "$(BOLD)üèÅ –ó–∞–ø—É—Å–∫ –±–µ–Ω—á–º–∞—Ä–∫–æ–≤$(RESET)"
	@$(PIP) install pytest-benchmark 2>/dev/null || true
	@$(PYTEST) $(TESTS_DIR)/benchmarks/ --benchmark-only || echo "$(YELLOW)‚ö†Ô∏è –ë–µ–Ω—á–º–∞—Ä–∫–∏ –Ω–µ –ø—Ä–æ–π–¥–µ–Ω—ã$(RESET)"

.PHONY: profile
profile: ## –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
	@echo "$(BOLD)üìä –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞$(RESET)"
	@$(PIP) install line-profiler memory-profiler 2>/dev/null || true
	@python3 -m memory_profiler $(SCRIPT) || echo "$(YELLOW)‚ö†Ô∏è –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ$(RESET)"

# ===============================
# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
# ===============================

.PHONY: info
info: ## –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–µ–∫—Ç–µ
	@echo "$(BOLD)üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ$(RESET)"
	@echo "$(CYAN)–ü—Ä–æ–µ–∫—Ç:$(RESET) $(PROJECT_NAME)"
	@echo "$(CYAN)–í–µ—Ä—Å–∏—è 1–°:$(RESET) $(V8_VERSION)"
	@echo "$(CYAN)Branch:$(RESET) $(BRANCH_NAME)"
	@echo "$(CYAN)Commit:$(RESET) $(COMMIT_HASH)"
	@echo "$(CYAN)Build:$(RESET) $(BUILD_NUMBER)"
	@echo "$(CYAN)Python:$(RESET) $(shell python3 --version)"
	@echo "$(CYAN)–°–∏—Å—Ç–µ–º–∞:$(RESET) $(shell uname -a)"

.PHONY: status
status: ## –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–æ–≤ –∏ —Å–±–æ—Ä–æ–∫
	@echo "$(BOLD)üìä –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞$(RESET)"
	@echo "$(CYAN)–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤:$(RESET)"
	@ls -la $(REPORTS_DIR)/test-results/ 2>/dev/null | tail -5 || echo "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö"
	@echo "$(CYAN)–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–±–æ—Ä–∫–∏:$(RESET)"
	@ls -la $(BUILD_DIR)/distribution/ 2>/dev/null | tail -5 || echo "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö"
	@echo "$(CYAN)Docker –æ–±—Ä–∞–∑—ã:$(RESET)"
	@docker images | grep $(PROJECT_NAME) || echo "–ù–µ—Ç –æ–±—Ä–∞–∑–æ–≤"

.PHONY: validate
validate: ## –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
	@echo "$(BOLD)‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏$(RESET)"
	@python3 $(SCRIPTS_DIR)/validate_config.py \
		--project-dir $(PWD) \
		--verbose || echo "$(RED)‚ùå –ù–∞–π–¥–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏$(RESET)"
	@echo "$(GREEN)‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω–∞$(RESET)"

# ===============================
# –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
# ===============================

.PHONY: version
version: ## –ü–æ–∫–∞–∑–∞—Ç—å –≤–µ—Ä—Å–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
	@echo "$(BOLD)üìã –í–µ—Ä—Å–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤$(RESET)"
	@echo "$(CYAN)1–° –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:$(RESET) $(V8_VERSION)"
	@echo "$(CYAN)Python:$(RESET) $(shell python3 --version)"
	@echo "$(CYAN)Pytest:$(RESET) $(shell $(PYTEST) --version 2>/dev/null || echo '–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω')"
	@echo "$(CYAN)Docker:$(RESET) $(shell docker --version 2>/dev/null || echo '–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω')"
	@echo "$(CYAN)Git:$(RESET) $(shell git --version 2>/dev/null || echo '–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω')"

# ===============================
# –ê–ª–∏–∞—Å—ã –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
# ===============================

test-all: test
lint-all: lint
build-all: build
clean-all: clean-all

# ===============================
# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
# ===============================

# –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ Makefile
# export MAKEFLAGS := --debug=b
# .PHONY: debug
# debug:
# 	@echo "PROJECT_NAME: $(PROJECT_NAME)"
# 	@echo "SRC_DIR: $(SRC_DIR)"
# 	@echo "TESTS_DIR: $(TESTS_DIR)"
# 	@echo "BUILD_DIR: $(BUILD_DIR)"
# 	@echo "REPORTS_DIR: $(REPORTS_DIR)"
# 	@echo "PYTHON_VERSION: $(PYTHON_VERSION)"
# 	@echo "V8_VERSION: $(V8_VERSION)"
# 	@echo "MAX_WORKERS: $(MAX_WORKERS)"
# 	@echo "TEST_TIMEOUT: $(TEST_TIMEOUT)"
# 	@echo "COVERAGE_THRESHOLD: $(COVERAGE_THRESHOLD)"